import*as e from"react";import t,{useState as r,useMemo as n,useEffect as a,useCallback as o,cloneElement as l,Children as i}from"react";import{useRecordContext as c,ReferenceArrayField as u,ReferenceField as s,useTranslate as m,useDataProvider as f,getResources as d,useGetResourceLabel as p,linkToRecord as b,useRefresh as y,useNotify as g,Button as h,usePermissionsOptimized as v,ImageField as E,useListContext as w,Link as k}from"react-admin";import{makeStyles as O,Box as x,Avatar as j,Chip as T,List as C,ListItem as P,ListItemAvatar as A,ListItemText as L,ListItemSecondaryAction as N,IconButton as S,CircularProgress as F,Dialog as I,DialogTitle as R,DialogContent as M,TextField as z,DialogActions as W,LinearProgress as B}from"@material-ui/core";import D from"@material-ui/icons/Launch";import{Form as U,Field as _}from"react-final-form";import q from"@material-ui/icons/Add";import{useSelector as G,shallowEqual as H}from"react-redux";import V from"lodash.debounce";import Y from"@material-ui/icons/Visibility";import $ from"@material-ui/icons/Error";import{useDataServers as J,useDataModel as K}from"@semapps/semantic-data-provider";import Q from"@material-ui/icons/Language";import X from"@material-ui/icons/Facebook";import Z from"@material-ui/icons/GitHub";import ee from"@material-ui/icons/Twitter";import te from"@material-ui/icons/Instagram";import re from"@material-ui/icons/YouTube";function ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function ie(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){le(o,n,a,l,i,"next",e)}function i(e){le(o,n,a,l,i,"throw",e)}l(void 0)}))}}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function se(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}(e,t)||de(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(e){return function(e){if(Array.isArray(e))return pe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||de(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function de(e,t){if(e){if("string"==typeof e)return pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pe(e,t):void 0}}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var be=["label","defaultLabel","image","fallback","externalLink","labelColor","classes"],ye=O((function(e){return{parent:function(e){return ae({position:"relative"},e.parent)},square:{width:"100%",paddingBottom:"100%",position:"relative"},avatar:{position:"absolute",top:0,bottom:0,width:"100%",height:"100%",borderRadius:"50%","& svg":{width:"55%",height:"55%"}},chip:{position:"absolute",bottom:-10,left:0,right:0,paddingTop:3,paddingBottom:3,paddingLeft:6,paddingRight:6,marginBottom:10,cursor:"pointer"},launchIcon:{width:14}}})),ge=function(){},he=function(e){var r=e.label,n=e.defaultLabel,a=e.image,o=e.fallback,l=e.externalLink,i=e.labelColor,u=e.classes,s=se(e,be);u=ye(u);var m=c(),f=("function"==typeof r?r(m):m[r])||n,d="function"==typeof a?a(m):m[a],p="function"==typeof o?o(m):o;return t.createElement(x,{className:u.parent},t.createElement("div",{className:u.square},t.createElement(j,ue({src:d||p,alt:f,fallback:p},s,{className:u.avatar}))),f?l?t.createElement(T,{color:i,className:u.chip,size:"small",label:f,deleteIcon:t.createElement(D,{className:u.launchIcon}),onDelete:ge}):t.createElement(T,{color:i,className:u.chip,size:"small",label:f}):null)};he.defaultProps={labelColor:"secondary",externalLink:!1};var ve=["record","source"],Ee=function(e){var r=e.record,n=e.source,a=se(e,ve);return null!=r&&r[n]&&(Array.isArray(r[n])||(r[n]=[r[n]]),r[n]=r[n].map((function(e){return e["@id"]||e.id||e}))),t.createElement(u,ue({record:r,source:n},a))};Ee.defaultProps={addLabel:!0};var we=["record","source"],ke=function(e){var r=e.record,n=e.source,a=se(e,we);return r[n]&&"object"===oe(r[n])&&(r[n]=r[n]["@id"]||r[n].id),t.createElement(s,ue({record:r,source:n},a))};ke.defaultProps={addLabel:!0};var Oe=O((function(e){return{root:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper,paddingTop:0,paddingBottom:0},primaryText:{width:"30%"},secondaryText:{fontStyle:"italic",color:"grey"}}})),xe=function(e,t){var r=t&&Object.values(t).find((function(t){return e.startsWith(t.baseUrl)}));return r?r.name:"Inconnu"},je=function(e){var o,l=e.keyword,i=e.source,u=e.reference,s=e.appendLink,y=e.switchToCreate,g=Oe(),h=me(r(!1),2),v=h[0],E=h[1],w=me(r(!1),2),k=w[0],O=w[1],T=me(r([]),2),I=T[0],R=T[1],M=m(),z=f(),W=J(),B=c(),D=G(d,H),U=n((function(){return D.find((function(e){return e.name===u}))}),[D,u]),_=p(),Q=K(u);if(Q&&Object.keys(Q).length>0&&(null==Q||null===(o=Q.fieldsMapping)||void 0===o||!o.title))throw new Error("No fieldsMapping.title config found for ".concat(u," dataModel"));var X=n((function(){return V((function(e){var t;z.getList(u,{pagination:{page:1,perPage:100},sort:{field:null==Q||null===(t=Q.fieldsMapping)||void 0===t?void 0:t.title,order:"ASC"},filter:{q:e,_predicates:[Q.fieldsMapping.title],_servers:"@all"}}).then((function(e){var t=e.data,r=B[i]?Array.isArray(B[i])?B[i]:[B[i]]:[],n=t.filter((function(e){return!r.includes(e.id)}));R(n),O(!0),E(!1)})).catch((function(e){E(!1)}))}),700)}),[z,Q,B,i,u,R,E,O]);return a((function(){if(l)return E(!0),O(!1),X(l),function(){return X.cancel()}}),[l,X,E]),l?t.createElement(C,{dense:!0,className:g.root},k&&I.map((function(e){return t.createElement(P,{key:e.id,button:!0,onClick:function(){return s(e.id)}},t.createElement(A,null,t.createElement(j,null,t.createElement(U.icon))),t.createElement(L,{className:g.primaryText,primary:e[Q.fieldsMapping.title]}),t.createElement(L,{className:g.secondaryText,primary:xe(e.id,W)}),t.createElement(N,null,t.createElement("a",{href:b("/"+u,e.id,"show"),target:"_blank",rel:"noopener noreferrer"},t.createElement(S,{edge:"end"},t.createElement(Y,null)))))})),k&&0===I.length&&t.createElement(P,null,t.createElement(A,null,t.createElement(j,null,t.createElement($,null))),t.createElement(L,{className:g.primaryText,primary:M("ra.navigation.no_results")})),k&&U.hasCreate&&t.createElement(P,{button:!0,onClick:y},t.createElement(A,null,t.createElement(j,null,t.createElement(q,null))),t.createElement(L,{className:g.primaryText,primary:M("ra.page.create",{name:_(u,1)})})),v&&t.createElement(x,{display:"flex",alignItems:"center",justifyContent:"center",height:150},t.createElement(F,{size:60,thickness:6}))):null},Te=["meta","input"],Ce=O((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingLeft:8,paddingRight:8,paddingTop:0,paddingBottom:0,maxHeight:210}}})),Pe=function(e){var r=e.meta,n=r.touched,a=r.error,o=e.input,l=se(e,Te);return t.createElement(z,ue({error:!(!n||!a),helperText:n&&a},o,l,{fullWidth:!0}))},Ae=function(e){var n=e.open,a=e.onClose,l=e.subjectUri,i=e.resource,c=e.source,u=e.reference,s=Ce(),d=me(r(""),2),b=d[0],v=d[1],E=me(r("find"),2),w=E[0],k=E[1],O=f(),x=m(),j=y(),T=g(),C=p(),P=K(u),A=o(function(){var e=ie(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.getOne(i,{id:l});case 2:return r=e.sent,n=r.data,e.next=6,O.update(i,{id:l,data:ae(ae({},n),{},ce({},c,n[c]?Array.isArray(n[c])?[].concat(fe(n[c]),[t]):[n[c],t]:t)),previousData:n});case 6:j(),a();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[O,l,i,c,j,a]),L=o(function(){var e=ie(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.create(u,{data:ce({},P.fieldsMapping.title,t.title)});case 2:return r=e.sent,n=r.data,e.next=6,A(n.id);case 6:T('La resource "'.concat(t.title,'" a été créée'),"success");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[O,P,A,u,T]);return t.createElement(I,{fullWidth:!0,open:n,onClose:a},"find"===w?t.createElement(t.Fragment,null,t.createElement(R,{className:s.title},"Ajouter une relation"),t.createElement(M,{className:s.addForm},t.createElement(z,{autoFocus:!0,label:"Rechercher ou créer des "+C(u,2).toLowerCase(),variant:"filled",margin:"dense",value:b,onChange:function(e){return v(e.target.value)},fullWidth:!0})),t.createElement(M,{className:s.listForm},t.createElement(je,{keyword:b,source:c,reference:u,appendLink:A,switchToCreate:function(){return k("create")}})),t.createElement(W,{className:s.actions},t.createElement(h,{label:"ra.action.close",variant:"text",onClick:a}))):t.createElement(U,{onSubmit:L,initialValues:{title:b},render:function(e){var r=e.handleSubmit,n=e.submitting;return t.createElement("form",{onSubmit:r},t.createElement(R,{className:s.title},x("ra.page.create",{name:C(u,1)})),t.createElement(M,{className:s.addForm},t.createElement(_,{autoFocus:!0,id:"title",name:"title",component:Pe,label:"Titre",disabled:n,variant:"filled",margin:"dense"})),t.createElement(W,{className:s.actions},t.createElement(h,{label:"ra.action.create",variant:"contained",startIcon:t.createElement(q,null),type:"submit",disabled:n}),t.createElement(h,{label:"ra.action.close",variant:"text",onClick:a})))}}))},Le=["record","reference","source","resource"],Ne=function(e){var a=e.record,o=e.reference,l=e.source,i=e.resource,c=se(e,Le),s=me(r(!1),2),m=s[0],f=s[1],d=v(a.id).permissions,p=n((function(){return!!d&&d.some((function(e){return["acl:Append","acl:Write","acl:Control"].includes(e["acl:mode"])}))}),[d]);return null!=a&&a[l]&&(Array.isArray(a[l])||(a[l]=[a[l]]),a[l]=a[l].map((function(e){return e["@id"]||e.id||e}))),t.createElement(t.Fragment,null,t.createElement(u,ue({record:a,reference:o,source:l,resource:i,appendLink:p?function(){return f(!0)}:void 0},c)),p&&m&&t.createElement(Ae,{open:m,onClose:function(){return f(!1)},subjectUri:a.id,resource:i,source:l,reference:o}))};Ne.defaultProps={addLabel:!0};var Se=["record","source"],Fe=function(e){var r=e.record,n=e.source,a=se(e,Se);return"string"==typeof r&&(r=ce({},n,r)),t.createElement(E,ue({record:r,source:n},a))},Ie={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Re=t.createContext&&t.createContext(Ie),Me=function(){return(Me=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},ze=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};function We(e){return function(r){return t.createElement(Be,Me({attr:Me({},e.attr)},r),function e(r){return r&&r.map((function(r,n){return t.createElement(r.tag,Me({key:n},r.attr),e(r.child))}))}(e.child))}}function Be(e){var r=function(r){var n,a=e.attr,o=e.size,l=e.title,i=ze(e,["attr","size","title"]),c=o||r.size||"1em";return r.className&&(n=r.className),e.className&&(n=(n?n+" ":"")+e.className),t.createElement("svg",Me({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,a,i,{className:n,style:Me(Me({color:e.color||r.color},r.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),l&&t.createElement("title",null,l),e.children)};return void 0!==Re?t.createElement(Re.Consumer,null,(function(e){return r(e)})):r(Ie)}function De(e){return We({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"}}]})(e)}var Ue=["source","domainMapping"],_e={"github.com":{label:"GitHub",icon:t.createElement(Z,null),color:"black",contrastText:"white"},"gitlab.com":{label:"GitLab",icon:t.createElement(De,null),color:"orange",contrastText:"black"},"opencollective.com":{label:"Open Collective",icon:t.createElement(j,{src:"https://opencollective.com/static/images/opencollective-icon.svg"}),color:"white",contrastText:"#297EFF"},"facebook.com":{label:"Facebook",icon:t.createElement(X,null),color:"#4267B2",contrastText:"white"},"twitter.com":{label:"Twitter",icon:t.createElement(ee,null),color:"#00ACEE",contrastText:"white"},"instagram.com":{label:"Instagram",icon:t.createElement(te,null),color:"#8a3ab9",contrastText:"white"},"youtube.com":{label:"YouTube",icon:t.createElement(re,null),color:"#FF0000",contrastText:"white"}},qe=O((function(e){return{link:{textDecoration:"unset","& :hover":{cursor:"pointer"}},chip:{paddingLeft:5,paddingRight:5,marginRight:5},label:{marginTop:-1}}})),Ge=function(e){var r=e.source,n=e.domainMapping,a=se(e,Ue),o=ae(ae({},_e),n),l=c(),i=qe();return(l[r]?Array.isArray(l[r])?l[r]:[l[r]]:[]).map((function(e,r){e.startsWith("http")||(e="https://"+e);var n=new URL(e);if(!n)return null;var l=o[n.hostname]||{label:"Site web",icon:t.createElement(Q,null),color:"#ea",contrastText:"black"};return t.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:i.link},t.createElement(T,ue({},a,{icon:t.cloneElement(l.icon,{style:{color:l.contrastText}}),size:"small",label:l.label,classes:{root:i.chip,label:i.label},style:{color:l.contrastText,backgroundColor:l.color}})))}))};Ge.defaultProps={addLabel:!0};var He=function(e){return e.stopPropagation()},Ve=function(){},Ye=function(t){t.classes,t.className;var r=t.children,n=t.link,a=void 0===n?"edit":n,o=t.linkType,c=t.separator,u=void 0===c?", ":c,s=w(t),m=s.ids,f=s.data,d=s.loaded,p=s.resource,y=s.basePath;return void 0!==o&&(console.warn("The 'linkType' prop is deprecated and should be named to 'link' in <SeparatedListField />"),a=o),!1===d?e.createElement(B,null):e.createElement(e.Fragment,null,m.map((function(t,n){if(!f[t])return null;var o=!1!==a&&("function"==typeof a?a(f[t]):b(y,t,a));return o?e.createElement("span",{key:t},e.createElement(k,{to:o,onClick:He},l(i.only(r),{record:f[t],resource:p,basePath:y,onClick:Ve})),n<m.length-1&&u):e.createElement("span",{key:t},l(i.only(r),{record:f[t],resource:p,basePath:y}),n<m.length-1&&u)})))};export{he as AvatarWithLabelField,Fe as ImageField,Ge as MultiUrlField,Ne as QuickAppendReferenceArrayField,Ee as ReferenceArrayField,ke as ReferenceField,Ye as SeparatedListField};
//# sourceMappingURL=index.es.js.map
