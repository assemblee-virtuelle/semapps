{"version":3,"file":"index.cjs.js","sources":["../src/constants.js","../src/hooks/useOutbox.js","../src/components/CommentsField/CustomMention.js","../src/components/CommentsField/PostCommentForm.js","../src/components/CommentsField/CommentsList.js","../src/hooks/useCollection.js","../src/components/CommentsField/CommentsField.js","../src/components/CollectionList.js","../src/components/ReferenceCollectionField.js","../../../node_modules/@rdfjs/data-model/lib/BlankNode.js","../../../node_modules/@rdfjs/data-model/lib/DefaultGraph.js","../../../node_modules/@rdfjs/data-model/lib/fromTerm.js","../../../node_modules/@rdfjs/data-model/lib/NamedNode.js","../../../node_modules/@rdfjs/data-model/lib/Literal.js","../../../node_modules/@rdfjs/data-model/lib/Quad.js","../../../node_modules/@rdfjs/data-model/lib/Variable.js","../../../node_modules/@rdfjs/data-model/lib/DataFactory.js","../../../node_modules/@rdfjs/data-model/index.js","../src/hooks/useInbox.js","../src/hooks/useMentions/MentionsList.js","../src/hooks/useMentions/renderMentions.js","../src/hooks/useMentions/useMentions.js","../src/hooks/useWebfinger.js"],"sourcesContent":["export const ACTIVITY_TYPES = {\n  ACCEPT: 'Accept',\n  ADD: 'Add',\n  ANNOUNCE: 'Announce',\n  ARRIVE: 'Arrive',\n  BLOCK: 'Block',\n  CREATE: 'Create',\n  DELETE: 'Delete',\n  DISLIKE: 'Dislike',\n  FLAG: 'Flag',\n  FOLLOW: 'Follow',\n  IGNORE: 'Ignore',\n  INVITE: 'Invite',\n  JOIN: 'Join',\n  LEAVE: 'Leave',\n  LIKE: 'Like',\n  LISTEN: 'Listen',\n  MOVE: 'Move',\n  OFFER: 'Offer',\n  QUESTION: 'Question',\n  REJECT: 'Reject',\n  READ: 'Read',\n  REMOVE: 'Remove',\n  TENTATIVE_REJECT: 'TentativeReject',\n  TENTATIVE_ACCEPT: 'TentativeAccept',\n  TRAVAL: 'Travel',\n  UNDO: 'Undo',\n  UPDATE: 'Update',\n  VIEW: 'View'\n};\n\nexport const ACTOR_TYPES = {\n  APPLICATION: 'Application',\n  GROUP: 'Group',\n  ORGANIZATION: 'Organization',\n  PERSON: 'Person',\n  SERVICE: 'Service'\n};\n\nexport const OBJECT_TYPES = {\n  ARTICLE: 'Article',\n  AUDIO: 'Audio',\n  DOCUMENT: 'Document',\n  EVENT: 'Event',\n  IMAGE: 'Image',\n  NOTE: 'Note',\n  PAGE: 'Page',\n  PLACE: 'Place',\n  PROFILE: 'Profile',\n  RELATIONSHIP: 'Relationship',\n  TOMBSTONE: 'Tombstone',\n  VIDEO: 'Video'\n};\n\nexport const PUBLIC_URI = 'https://www.w3.org/ns/activitystreams#Public';\n","import { useCallback, useMemo } from 'react';\nimport { useGetIdentity, fetchUtils } from 'react-admin';\nimport { buildBlankNodesQuery } from '@semapps/semantic-data-provider';\n\nconst useOutbox = () => {\n  const { identity } = useGetIdentity();\n\n  const outboxUrl = useMemo(() => {\n    if (identity?.webIdData) {\n      return identity?.webIdData?.outbox;\n    }\n  }, [identity]);\n\n  const sparqlEndpoint = useMemo(() => {\n    if (identity?.webIdData) {\n      return identity?.webIdData?.endpoints?.['void:sparqlEndpoint'] || (identity?.id + '/sparql');\n    }\n  }, [identity]);\n\n  // Post an activity to the logged user's outbox and return its URI\n  const post = useCallback(\n    async activity => {\n      const token = localStorage.getItem('token');\n      const { headers } = await fetchUtils.fetchJson(outboxUrl, {\n        method: 'POST',\n        body: JSON.stringify({\n          '@context': 'https://www.w3.org/ns/activitystreams',\n          ...activity\n        }),\n        headers: new Headers({\n          'Content-Type': 'application/ld+json',\n          Authorization: `Bearer ${token}`\n        })\n      });\n      return headers.get('Location');\n    },\n    [outboxUrl]\n  );\n\n  const fetch = useCallback(async () => {\n    if (!sparqlEndpoint || !outboxUrl) return;\n\n    const token = localStorage.getItem('token');\n    const blankNodesQuery = buildBlankNodesQuery(['as:object']);\n\n    const query = `\n      PREFIX as: <https://www.w3.org/ns/activitystreams#>\n      CONSTRUCT {\n        ?s1 ?p1 ?o1 .\n        ${blankNodesQuery.construct}\n      }\n      WHERE {\n        <${outboxUrl}> as:items ?s1 .\n        ?s1 ?p1 ?o1 .\n        ${blankNodesQuery.where}\n      }\n    `;\n\n    const { json } = await fetchUtils.fetchJson(sparqlEndpoint, {\n      method: 'POST',\n      body: query,\n      headers: new Headers({\n        Accept: 'application/ld+json',\n        Authorization: token ? `Bearer ${token}` : undefined\n      })\n    });\n\n    if (json['@graph']) {\n      return json['@graph'];\n    } else {\n      return null;\n    }\n  }, [sparqlEndpoint, outboxUrl]);\n\n  return { post, fetch, url: outboxUrl, owner: identity?.id };\n};\n\nexport default useOutbox;\n","import { mergeAttributes } from '@tiptap/core';\nimport Mention from '@tiptap/extension-mention';\n\n// Fix a bug in the current version of the mention extension\n// (The { id, label } object is located inside the id property)\n// See https://github.com/ueberdosis/tiptap/pull/1322\nconst CustomMention = Mention.extend({\n  renderHTML({ node, HTMLAttributes }) {\n    return ['span', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), `@${node.attrs.id.label}`];\n  },\n  addAttributes() {\n    return {\n      label: {\n        default: null,\n        parseHTML: element => {\n          return {\n            label: element.getAttribute('data-mention-label')\n          };\n        },\n        renderHTML: attributes => {\n          if (!attributes.id.label) {\n            return {};\n          }\n          return {\n            'data-mention-label': attributes.id.label\n          };\n        }\n      },\n      id: {\n        default: null,\n        parseHTML: element => {\n          return {\n            id: element.getAttribute('data-mention-id')\n          };\n        },\n        renderHTML: attributes => {\n          if (!attributes.id.id) {\n            return {};\n          }\n          return {\n            'data-mention-id': attributes.id.id\n          };\n        }\n      }\n    };\n  }\n});\n\nexport default CustomMention;\n","import React, { useState, useCallback } from 'react';\nimport { useGetIdentity, useNotify, useRecordContext } from 'react-admin';\nimport { RichTextInput, DefaultEditorOptions } from 'ra-richtext-tiptap';\nimport { Form } from 'react-final-form';\nimport { Button, Box, makeStyles, Avatar } from '@material-ui/core';\nimport SendIcon from '@material-ui/icons/Send';\nimport { useDataModel } from '@semapps/semantic-data-provider';\nimport { AuthDialog } from '@semapps/auth-provider';\nimport { OBJECT_TYPES, PUBLIC_URI } from '../../constants';\nimport useOutbox from '../../hooks/useOutbox';\nimport CustomMention from './CustomMention';\n\nconst useStyles = makeStyles(theme => ({\n  form: {\n    marginTop: -12 // Negative margin to keep the form close to the label\n  },\n  container: {\n    paddingLeft: 80,\n    position: 'relative'\n  },\n  avatar: {\n    position: 'absolute',\n    top: 16,\n    left: 0,\n    bottom: 0,\n    width: 64,\n    height: 64\n  },\n  editorContent: {\n    '& > div': {\n      backgroundColor: 'rgba(0, 0, 0, 0.09)',\n      padding: '2px 12px',\n      borderWidth: '0px !important',\n      borderRadius: 0,\n      borderBottom: '1px solid #FFF',\n      minHeight: 60,\n      outline: 'unset !important'\n    },\n    '& > div > p': {\n      marginTop: 12,\n      marginBottom: 12,\n      fontFamily: theme.typography.body1.fontFamily,\n      marginBlockStart: '0.5em',\n      marginBlockEnd: '0.5em'\n    },\n    marginBottom: -19 // To hide helper text block\n  },\n  button: {\n    marginBottom: 15\n  }\n}));\n\nconst PostCommentForm = ({ context, helperText, mentions, userResource, addItem, removeItem }) => {\n  const record = useRecordContext();\n  const { identity } = useGetIdentity();\n  const userDataModel = useDataModel(userResource);\n  const classes = useStyles();\n  const notify = useNotify();\n  const outbox = useOutbox();\n  const [expanded, setExpanded] = useState(false);\n  const [openAuth, setOpenAuth] = useState(false);\n\n  const onSubmit = useCallback(\n    async (values, { reset }) => {\n      const document = new DOMParser().parseFromString(values.comment, 'text/html');\n      const mentions = Array.from(document.body.getElementsByClassName('mention'));\n      let mentionedUsersUris = [];\n\n      mentions.forEach(node => {\n        const userUri = node.attributes['data-mention-id'].value;\n        const userLabel = node.attributes['data-mention-label'].value;\n        const link = document.createElement('a');\n        link.setAttribute(\n          'href',\n          new URL(window.location.href).origin + '/' + userResource + '/' + encodeURIComponent(userUri) + '/show'\n        );\n        link.textContent = '@' + userLabel;\n        node.parentNode.replaceChild(link, node);\n        mentionedUsersUris.push(userUri);\n      });\n\n      if (document.body.innerHTML === 'undefined') {\n        notify('Votre commentaire est vide', 'error');\n      } else {\n        const tempId = Date.now();\n\n        const note = {\n          type: OBJECT_TYPES.NOTE,\n          attributedTo: outbox.owner,\n          content: document.body.innerHTML,\n          inReplyTo: record[context],\n          published: new Date().toISOString()\n        };\n\n        try {\n          addItem({ id: tempId, ...note });\n          reset();\n          setExpanded(false);\n          await outbox.post({ ...note, to: [...mentionedUsersUris, PUBLIC_URI] });\n          notify('Commentaire posté avec succès', 'success');\n        } catch (e) {\n          removeItem(tempId);\n          notify(e.message, 'error');\n        }\n      }\n    },\n    [outbox, notify, setExpanded, addItem, removeItem]\n  );\n\n  const openAuthIfDisconnected = useCallback(() => {\n    if (!identity.id) {\n      setOpenAuth(true);\n    }\n  }, [identity, setOpenAuth]);\n\n  // Don't init the editor options until mentions and identity are loaded, as they can only be initialized once\n  if ((mentions && !mentions.items) || !identity) return null;\n\n  return (\n    <>\n      <Form\n        onSubmit={onSubmit}\n        subscription={{ submitting: true, pristine: true }}\n        render={({ handleSubmit, submitting, pristine }) => {\n          // Hack to clear comment input when form is reset\n          // TODO When we update to React-Admin 4, check if the new RichTextInput solves this bug\n          if (pristine) {\n            const commentElement = document.getElementById('comment');\n            if (commentElement) commentElement.innerHTML = '';\n          }\n          return (\n            <form onSubmit={handleSubmit} className={classes.form}>\n              <Box className={classes.container} onClick={openAuthIfDisconnected}>\n                <Avatar src={identity?.webIdData?.[userDataModel?.fieldsMapping?.image]} className={classes.avatar} />\n                <RichTextInput\n                  source=\"comment\"\n                  label=\"\"\n                  toolbar={null}\n                  fullWidth\n                  classes={{ editorContent: classes.editorContent }}\n                  editorOptions={{\n                    ...DefaultEditorOptions,\n                    onFocus() {\n                      setExpanded(true);\n                    },\n                    extensions: [\n                      ...DefaultEditorOptions.extensions,\n                      mentions\n                        ? CustomMention.configure({\n                            HTMLAttributes: {\n                              class: 'mention'\n                            },\n                            suggestion: mentions\n                          })\n                        : null\n                    ],\n                    // Disable editor if user is not connected\n                    editable: !!identity.id\n                  }}\n                  helperText={helperText}\n                />\n                {expanded && (\n                  <Button\n                    type=\"submit\"\n                    size=\"small\"\n                    variant=\"contained\"\n                    color=\"primary\"\n                    endIcon={<SendIcon />}\n                    disabled={submitting}\n                    className={classes.button}\n                  >\n                    Envoyer\n                  </Button>\n                )}\n              </Box>\n            </form>\n          );\n        }}\n      />\n      <AuthDialog\n        open={openAuth}\n        onClose={() => setOpenAuth(false)}\n        message=\"Pour poster un commentaire, vous devez être connecté.\"\n      />\n    </>\n  );\n};\n\nexport default PostCommentForm;\n","import React from 'react';\nimport { TextField, RichTextField, DateField } from 'react-admin';\nimport { Box, Typography, CircularProgress, makeStyles } from '@material-ui/core';\nimport { useDataModel } from '@semapps/semantic-data-provider';\nimport { AvatarWithLabelField, ReferenceField } from '@semapps/field-components';\n\nconst useStyles = makeStyles(() => ({\n  container: {\n    paddingLeft: 80,\n    marginTop: 8,\n    minHeight: 80,\n    position: 'relative'\n  },\n  avatar: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    bottom: 0,\n    width: 64,\n    height: 64\n  },\n  text: {\n    paddingTop: 2,\n    paddingBottom: 8\n  },\n  label: {\n    fontWeight: 'bold'\n  },\n  content: {\n    '& p': {\n      marginBlockStart: '0.5em',\n      marginBlockEnd: '0.5em'\n    }\n  },\n  loading: {\n    zIndex: 1000,\n    backgroundColor: 'white',\n    opacity: 0.5,\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    minHeight: 200,\n    marginTop: 5\n  }\n}));\n\nconst CommentsList = ({ comments, userResource, loading }) => {\n  const classes = useStyles();\n  const userDataModel = useDataModel(userResource);\n  return (\n    <Box position=\"relative\">\n      {comments &&\n        comments\n          .sort((a, b) => new Date(b.published) - new Date(a.published))\n          .map(comment => (\n            <Box className={classes.container}>\n              <Box className={classes.avatar}>\n                <ReferenceField record={comment} reference=\"Person\" source=\"attributedTo\" linkType=\"show\">\n                  <AvatarWithLabelField image={userDataModel?.fieldsMapping?.image} />\n                </ReferenceField>\n              </Box>\n              <Box className={classes.text}>\n                <Typography variant=\"body2\">\n                  <ReferenceField record={comment} reference=\"Person\" source=\"attributedTo\" linkType=\"show\">\n                    <TextField variant=\"body2\" source={userDataModel?.fieldsMapping?.title} className={classes.label} />\n                  </ReferenceField>\n                  &nbsp;•&nbsp;\n                  <DateField record={comment} variant=\"body2\" source=\"published\" showTime />\n                </Typography>\n                <RichTextField record={comment} variant=\"body1\" source=\"content\" className={classes.content} />\n              </Box>\n            </Box>\n          ))}\n      {loading && (\n        <Box minHeight={200}>\n          <Box alignItems=\"center\" className={classes.loading}>\n            <CircularProgress size={60} thickness={6} />\n          </Box>\n        </Box>\n      )}\n    </Box>\n  );\n};\n\nexport default CommentsList;\n","import { useCallback, useMemo, useState, useEffect } from 'react';\nimport { useGetIdentity, fetchUtils } from 'react-admin';\n\nconst useCollection = predicateOrUrl => {\n  const { identity } = useGetIdentity();\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [loaded, setLoaded] = useState(false);\n  const [error, setError] = useState(false);\n\n  const collectionUrl = useMemo(() => {\n    if (predicateOrUrl) {\n      if (predicateOrUrl.startsWith('http')) {\n        return predicateOrUrl;\n      } else if (identity?.webIdData) {\n        return identity?.webIdData?.[predicateOrUrl];\n      }\n    }\n  }, [identity, predicateOrUrl]);\n\n  const fetch = useCallback(async () => {\n    if (!collectionUrl) return;\n\n    setLoading(true);\n    const token = localStorage.getItem('token');\n    const headers = new Headers({\n      Accept: 'application/ld+json',\n      Authorization: token ? `Bearer ${token}` : undefined\n    });\n\n    fetchUtils\n      .fetchJson(collectionUrl, { headers })\n      .then(({ json }) => {\n        if (json && json.items) {\n          setItems(json.items);\n        } else if (json && json.orderedItems) {\n          setItems(json.orderedItems);\n        } else {\n          setItems([]);\n        }\n        setError(false);\n        setLoaded(true);\n        setLoading(false);\n      })\n      .catch(() => {\n        setError(true);\n        setLoaded(true);\n        setLoading(false);\n      });\n  }, [setItems, setLoaded, setLoading, setError, collectionUrl]);\n\n  useEffect(() => {\n    if (!loading && !loaded && !error) {\n      fetch();\n    }\n  }, [fetch, loading, loaded, error]);\n\n  const addItem = useCallback(\n    item => {\n      setItems(oldItems => [...oldItems, item]);\n    },\n    [setItems]\n  );\n\n  const removeItem = useCallback(\n    itemId => {\n      setItems(oldItems => oldItems.filter(item => (typeof item === 'string' ? item !== itemId : item.id !== itemId)));\n    },\n    [setItems]\n  );\n\n  return { items, loading, loaded, error, refetch: fetch, addItem, removeItem, url: collectionUrl };\n};\n\nexport default useCollection;\n","import React from 'react';\nimport { useRecordContext } from 'react-admin';\nimport PostCommentForm from './PostCommentForm';\nimport CommentsList from './CommentsList';\nimport useCollection from '../../hooks/useCollection';\n\nconst CommentsField = ({ source, context, helperText, userResource, mentions }) => {\n  const record = useRecordContext();\n  const { items: comments, loading, addItem, removeItem } = useCollection(record.replies);\n  if (!userResource) throw new Error('No userResource defined for CommentsField');\n  return (\n    <>\n      <PostCommentForm\n        context={context}\n        helperText={helperText}\n        userResource={userResource}\n        mentions={mentions}\n        addItem={addItem}\n        removeItem={removeItem}\n      />\n      <CommentsList comments={comments} loading={loading} userResource={userResource} />\n    </>\n  );\n};\n\nCommentsField.defaultProps = {\n  addLabel: true,\n  label: 'Commentaires',\n  source: 'id', // Ensure the field is always displayed\n  context: 'id'\n};\n\nexport default CommentsField;\n","import React from 'react';\nimport { useGetOne, LinearProgress } from 'react-admin';\nimport { ReferenceArrayField } from '@semapps/field-components';\n\nconst CollectionList = ({ collectionUrl, resource, children, ...rest }) => {\n  if (React.Children.count(children) !== 1) {\n    throw new Error('<CollectionList> only accepts a single child');\n  }\n\n  // TODO use a simple fetch call, as the resource is not good and it is useless\n  const { data: collection, loading } = useGetOne(resource, collectionUrl, { enabled: !!collectionUrl });\n\n  if (loading) {\n    return (\n      <div style={{ marginTop: 8 }}>\n        <LinearProgress />\n      </div>\n    );\n  } else if (!collection) {\n    return null;\n  }\n\n  return (\n    <ReferenceArrayField reference={resource} record={collection} source=\"items\" {...rest}>\n      {children}\n    </ReferenceArrayField>\n  );\n};\n\nexport default CollectionList;\n","import React from 'react';\nimport CollectionList from './CollectionList';\n\nconst ReferenceCollectionField = ({ source, record, reference, children, ...rest }) => {\n  if (React.Children.count(children) !== 1) {\n    throw new Error('<ReferenceCollectionField> only accepts a single child');\n  }\n\n  if (!record || !record[source]) return null;\n\n  return (\n    <CollectionList resource={reference} collectionUrl={record[source]} {...rest}>\n      {children}\n    </CollectionList>\n  );\n};\n\nReferenceCollectionField.defaultProps = {\n  addLabel: true\n};\n\nexport default ReferenceCollectionField;\n","class BlankNode {\n  constructor (id) {\n    this.value = id || ('b' + (++BlankNode.nextId))\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value\n  }\n}\n\nBlankNode.prototype.termType = 'BlankNode'\n\nBlankNode.nextId = 0\n\nmodule.exports = BlankNode\n","class DefaultGraph {\n  equals (other) {\n    return !!other && other.termType === this.termType\n  }\n}\n\nDefaultGraph.prototype.termType = 'DefaultGraph'\nDefaultGraph.prototype.value = ''\n\nmodule.exports = DefaultGraph\n","function fromTerm (original) {\n  if (!original) {\n    return null\n  }\n\n  if (original.termType === 'BlankNode') {\n    return this.blankNode(original.value)\n  }\n\n  if (original.termType === 'DefaultGraph') {\n    return this.defaultGraph()\n  }\n\n  if (original.termType === 'Literal') {\n    return this.literal(original.value, original.language || this.namedNode(original.datatype.value))\n  }\n\n  if (original.termType === 'NamedNode') {\n    return this.namedNode(original.value)\n  }\n\n  if (original.termType === 'Quad') {\n    const subject = this.fromTerm(original.subject)\n    const predicate = this.fromTerm(original.predicate)\n    const object = this.fromTerm(original.object)\n    const graph = this.fromTerm(original.graph)\n\n    return this.quad(subject, predicate, object, graph)\n  }\n\n  if (original.termType === 'Variable') {\n    return this.variable(original.value)\n  }\n\n  throw new Error(`unknown termType ${original.termType}`)\n}\n\nmodule.exports = fromTerm\n","class NamedNode {\n  constructor (iri) {\n    this.value = iri\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value\n  }\n}\n\nNamedNode.prototype.termType = 'NamedNode'\n\nmodule.exports = NamedNode\n","const NamedNode = require('./NamedNode.js')\n\nclass Literal {\n  constructor (value, language, datatype) {\n    this.value = value\n    this.datatype = Literal.stringDatatype\n    this.language = ''\n\n    if (language) {\n      this.language = language\n      this.datatype = Literal.langStringDatatype\n    } else if (datatype) {\n      this.datatype = datatype\n    }\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value &&\n      other.language === this.language && other.datatype.equals(this.datatype)\n  }\n}\n\nLiteral.prototype.termType = 'Literal'\n\nLiteral.langStringDatatype = new NamedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#langString')\nLiteral.stringDatatype = new NamedNode('http://www.w3.org/2001/XMLSchema#string')\n\nmodule.exports = Literal\n","const DefaultGraph = require('./DefaultGraph.js')\n\nclass Quad {\n  constructor (subject, predicate, object, graph) {\n    this.subject = subject\n    this.predicate = predicate\n    this.object = object\n\n    if (graph) {\n      this.graph = graph\n    } else {\n      this.graph = new DefaultGraph()\n    }\n  }\n\n  equals (other) {\n    // `|| !other.termType` is for backwards-compatibility with old factories without RDF* support.\n    return !!other && (other.termType === 'Quad' || !other.termType) &&\n      other.subject.equals(this.subject) && other.predicate.equals(this.predicate) &&\n      other.object.equals(this.object) && other.graph.equals(this.graph)\n  }\n}\n\nQuad.prototype.termType = 'Quad'\nQuad.prototype.value = ''\n\nmodule.exports = Quad\n","class Variable {\n  constructor (name) {\n    this.value = name\n  }\n\n  equals (other) {\n    return !!other && other.termType === this.termType && other.value === this.value\n  }\n}\n\nVariable.prototype.termType = 'Variable'\n\nmodule.exports = Variable\n","const BlankNode = require('./BlankNode.js')\nconst DefaultGraph = require('./DefaultGraph.js')\nconst fromTermRaw = require('./fromTerm.js')\nconst Literal = require('./Literal.js')\nconst NamedNode = require('./NamedNode.js')\nconst Quad = require('./Quad.js')\nconst Variable = require('./Variable.js')\n\nfunction namedNode (value) {\n  return new NamedNode(value)\n}\n\nfunction blankNode (value) {\n  return new BlankNode(value)\n}\n\nfunction literal (value, languageOrDatatype) {\n  if (typeof languageOrDatatype === 'string') {\n    if (languageOrDatatype.indexOf(':') === -1) {\n      return new Literal(value, languageOrDatatype)\n    }\n\n    return new Literal(value, null, DataFactory.namedNode(languageOrDatatype))\n  }\n\n  return new Literal(value, null, languageOrDatatype)\n}\n\nfunction variable (value) {\n  return new Variable(value)\n}\n\nfunction defaultGraph () {\n  return DataFactory.defaultGraphInstance\n}\n\nfunction triple (subject, predicate, object) {\n  return DataFactory.quad(subject, predicate, object)\n}\n\nfunction quad (subject, predicate, object, graph) {\n  return new Quad(subject, predicate, object, graph || DataFactory.defaultGraphInstance)\n}\n\nfunction fromTerm (original) {\n  return fromTermRaw.call(DataFactory, original)\n}\n\nfunction fromQuad (original) {\n  return fromTermRaw.call(DataFactory, original)\n}\n\nconst DataFactory = {\n  namedNode,\n  blankNode,\n  literal,\n  variable,\n  defaultGraph,\n  triple,\n  quad,\n  fromTerm,\n  fromQuad,\n  defaultGraphInstance: new DefaultGraph()\n}\n\nmodule.exports = DataFactory\n","const DataFactory = require('./lib/DataFactory.js')\n\nmodule.exports = DataFactory\n","import { useCallback, useMemo } from 'react';\nimport { useGetIdentity, fetchUtils } from 'react-admin';\nimport DataFactory from '@rdfjs/data-model';\nimport { buildBlankNodesQuery } from '@semapps/semantic-data-provider';\nconst { namedNode, triple, variable } = DataFactory;\nconst SparqlGenerator = require('sparqljs').Generator;\nconst generator = new SparqlGenerator({\n  /* prefixes, baseIRI, factory, sparqlStar */\n});\n\nconst useInbox = () => {\n  const { identity } = useGetIdentity();\n\n  const inboxUrl = useMemo(() => {\n    if (identity?.webIdData) {\n      return identity?.webIdData?.inbox;\n    }\n  }, [identity]);\n\n  const sparqlEndpoint = useMemo(() => {\n    if (identity?.webIdData) {\n      return identity?.webIdData?.endpoints?.['void:sparqlEndpoint'] || (identity?.id + '/sparql');\n    }\n  }, [identity]);\n\n  const fetch = useCallback(\n    async ({ filters }) => {\n      if (!sparqlEndpoint || !inboxUrl) return;\n\n      const baseTriples = [\n        triple(namedNode(inboxUrl), namedNode('https://www.w3.org/ns/activitystreams#items'), variable('s1')),\n        triple(variable('s1'), variable('p1'), variable('o1'))\n      ];\n\n      const baseQuery = {\n        construct: baseTriples,\n        where: [\n          ...baseTriples\n        ],\n      }\n\n      const token = localStorage.getItem('token');\n      const asOntology = { prefix: \"as\", url: \"https://www.w3.org/ns/activitystreams#\" };\n      const blankNodesQuery = buildBlankNodesQuery(['as:object'], baseQuery, [asOntology]);\n\n      const sparqlJsParams = {\n        type: 'query',\n        queryType: 'CONSTRUCT',\n        template: blankNodesQuery.construct,\n        where: blankNodesQuery.where,\n        prefixes: {\n          as: 'https://www.w3.org/ns/activitystreams#'\n        }\n      };\n\n      // let filtersWhereQuery = '';\n      // if (filters) {\n      //   Object.keys(filters).forEach(predicate => {\n      //     if (filters[predicate]) {\n      //       const object = filters[predicate].startsWith('http') ? `<${filters[predicate]}>` : filters[predicate];\n      //       filtersWhereQuery += `?s1 ${predicate} ${object} .`;\n      //     }\n      //   });\n      // }\n      //\n      // const query = `\n      //   PREFIX as: <https://www.w3.org/ns/activitystreams#>\n      //   CONSTRUCT {\n      //     ?s1 ?p1 ?o1 .\n      //     ${blankNodesQuery.construct}\n      //   }\n      //   WHERE {\n      //     <${inboxUrl}> as:items ?s1 .\n      //     ?s1 ?p1 ?o1 .\n      //     FILTER( (isIRI(?s1)) ) .\n      //     ${filtersWhereQuery}\n      //     ${blankNodesQuery.where}\n      //   }\n      // `;\n\n      const query = generator.stringify(sparqlJsParams);\n\n      const { json } = await fetchUtils.fetchJson(sparqlEndpoint, {\n        method: 'POST',\n        body: query,\n        headers: new Headers({\n          Accept: 'application/ld+json',\n          Authorization: token ? `Bearer ${token}` : undefined\n        })\n      });\n\n      if (json['@graph']) {\n        return json['@graph'];\n      } else {\n        return null;\n      }\n    },\n    [sparqlEndpoint, inboxUrl]\n  );\n\n  return { fetch, url: inboxUrl, owner: identity?.id };\n};\n\nexport default useInbox;\n","import React, { useState, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { makeStyles } from '@material-ui/core';\n\nconst useStyles = makeStyles(theme => ({\n  items: {\n    background: '#fff',\n    borderRadius: '0.5rem',\n    boxShadow: '0 0 0 1px rgba(0, 0, 0, 0.05), 0px 10px 20px rgba(0, 0, 0, 0.1)',\n    color: 'rgba(0, 0, 0, 0.8)',\n    fontSize: '0.9rem',\n    overflow: 'hidden',\n    padding: '0.2rem',\n    position: 'relative'\n  },\n  item: {\n    background: 'transparent',\n    border: '1px solid transparent',\n    borderRadius: '0.4rem',\n    display: 'block',\n    margin: 0,\n    padding: '0.2rem 0.4rem',\n    textAlign: 'left',\n    width: '100%',\n    '&.selected': {\n      borderColor: '#000'\n    }\n  }\n}));\n\nexport default forwardRef((props, ref) => {\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const classes = useStyles();\n\n  const selectItem = index => {\n    const item = props.items[index];\n\n    if (item) {\n      props.command({ id: item });\n    }\n  };\n\n  const upHandler = () => {\n    setSelectedIndex((selectedIndex + props.items.length - 1) % props.items.length);\n  };\n\n  const downHandler = () => {\n    setSelectedIndex((selectedIndex + 1) % props.items.length);\n  };\n\n  const enterHandler = () => {\n    selectItem(selectedIndex);\n  };\n\n  useEffect(() => setSelectedIndex(0), [props.items]);\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: ({ event }) => {\n      if (event.key === 'ArrowUp') {\n        upHandler();\n        return true;\n      }\n\n      if (event.key === 'ArrowDown') {\n        downHandler();\n        return true;\n      }\n\n      if (event.key === 'Enter') {\n        enterHandler();\n        return true;\n      }\n\n      return false;\n    }\n  }));\n\n  return (\n    <div className={classes.items}>\n      {props.items.length ? (\n        props.items.map((item, index) => (\n          <button\n            className={classes.item + (index === selectedIndex ? ' selected' : '')}\n            key={index}\n            onClick={() => selectItem(index)}\n          >\n            {item.label}\n          </button>\n        ))\n      ) : (\n        <div className={classes.item}>Aucun résultat</div>\n      )}\n    </div>\n  );\n});\n","import { ReactRenderer } from '@tiptap/react';\nimport tippy from 'tippy.js';\nimport MentionsList from './MentionsList';\n\nconst renderMentions = () => {\n  let component;\n  let popup;\n\n  return {\n    onStart: props => {\n      component = new ReactRenderer(MentionsList, {\n        props,\n        editor: props.editor\n      });\n\n      popup = tippy('body', {\n        getReferenceClientRect: props.clientRect,\n        appendTo: () => document.body,\n        content: component.element,\n        showOnCreate: true,\n        interactive: true,\n        trigger: 'manual',\n        placement: 'bottom-start'\n      });\n    },\n\n    onUpdate(props) {\n      component.updateProps(props);\n\n      popup[0].setProps({\n        getReferenceClientRect: props.clientRect\n      });\n    },\n\n    onKeyDown(props) {\n      if (props.event.key === 'Escape') {\n        popup[0].hide();\n\n        return true;\n      }\n\n      return component.ref?.onKeyDown(props);\n    },\n\n    onExit() {\n      popup[0].destroy();\n      component.destroy();\n    }\n  };\n};\n\nexport default renderMentions;\n","import { useMemo } from 'react';\nimport { useQuery } from 'react-admin';\nimport renderMentions from './renderMentions';\nimport { useDataModel } from '@semapps/semantic-data-provider';\n\nconst useMentions = userResource => {\n  const userDataModel = useDataModel(userResource);\n\n  // The \"enabled\" option doesn't work with useQueryWithStore\n  const { data } = useQuery(\n    {\n      type: 'getList',\n      resource: userResource,\n      payload: {\n        filter: {\n          _predicates: [userDataModel?.fieldsMapping?.title],\n          blankNodes: []\n        }\n      }\n    },\n    {\n      enabled: !!userDataModel?.fieldsMapping?.title\n    }\n  );\n\n  const availableMentions = useMemo(() => {\n    if (data) {\n      return data.map(item => ({ id: item.id, label: item[userDataModel?.fieldsMapping?.title] }));\n    }\n  }, [data]);\n\n  const items = useMemo(() => {\n    if (availableMentions) {\n      return ({ query }) => {\n        return availableMentions.filter(({ label }) => label.toLowerCase().startsWith(query.toLowerCase())).slice(0, 5);\n      };\n    }\n  }, [availableMentions]);\n\n  return {\n    items,\n    render: renderMentions\n  };\n};\n\nexport default useMentions;\n","import { useCallback } from 'react';\nimport { fetchUtils } from 'react-admin';\n\nconst useWebfinger = () => {\n  // Post an activity to the logged user's outbox and return its URI\n  const fetch = useCallback(async id => {\n    // eslint-disable-next-line\n    const [_, username, host] = id.split('@');\n    if (host) {\n      const protocol = host.includes(':') ? 'http' : 'https'; // If the host has a port, we are most likely on localhost\n      const webfingerUrl = `${protocol}://${host}/.well-known/webfinger?resource=acct:${username}@${host}`;\n\n      try {\n        const { json } = await fetchUtils.fetchJson(webfingerUrl);\n\n        const link = json.links.find(l => l.type === 'application/activity+json');\n\n        return link ? link.href : null;\n      } catch (e) {\n        return null;\n      }\n    } else {\n      return null;\n    }\n  }, []);\n\n  return { fetch };\n};\n\nexport default useWebfinger;\n"],"names":["OBJECT_TYPES","ARTICLE","AUDIO","DOCUMENT","EVENT","IMAGE","NOTE","PAGE","PLACE","PROFILE","RELATIONSHIP","TOMBSTONE","VIDEO","PUBLIC_URI","useOutbox","identity","useGetIdentity","outboxUrl","useMemo","_identity$webIdData","webIdData","outbox","sparqlEndpoint","_identity$webIdData2","_identity$webIdData2$","endpoints","id","post","useCallback","_ref","_asyncToGenerator","_regeneratorRuntime","mark","activity","token","_yield$fetchUtils$fet","headers","wrap","_context","prev","next","localStorage","getItem","fetchUtils","fetchJson","method","body","JSON","stringify","_objectSpread","@context","Headers","Content-Type","Authorization","sent","abrupt","get","stop","_callee","_x","apply","this","arguments","fetch","_callee2","blankNodesQuery","query","_yield$fetchUtils$fet2","json","_context2","buildBlankNodesQuery","concat","construct","where","Accept","undefined","url","owner","CustomMention","Mention","extend","renderHTML","node","HTMLAttributes","mergeAttributes","options","attrs","label","addAttributes","default","parseHTML","element","getAttribute","attributes","data-mention-label","data-mention-id","useStyles","makeStyles","theme","form","marginTop","container","paddingLeft","position","avatar","top","left","bottom","width","height","editorContent","& > div","backgroundColor","padding","borderWidth","borderRadius","borderBottom","minHeight","outline","& > div > p","marginBottom","fontFamily","typography","body1","marginBlockStart","marginBlockEnd","button","PostCommentForm","context","helperText","mentions","userResource","addItem","removeItem","record","useRecordContext","userDataModel","useDataModel","classes","notify","useNotify","_useState2","_slicedToArray","useState","expanded","setExpanded","_useState4","openAuth","setOpenAuth","onSubmit","_ref3","values","_ref2","reset","document","mentionedUsersUris","tempId","note","DOMParser","parseFromString","comment","Array","from","getElementsByClassName","forEach","userUri","value","userLabel","link","createElement","setAttribute","URL","window","location","href","origin","encodeURIComponent","textContent","parentNode","replaceChild","push","innerHTML","Date","now","type","attributedTo","content","inReplyTo","published","toISOString","to","t0","message","_x2","openAuthIfDisconnected","items","React","Fragment","Form","subscription","submitting","pristine","render","_ref4","_userDataModel$fields","handleSubmit","commentElement","getElementById","className","Box","onClick","Avatar","src","fieldsMapping","image","RichTextInput","source","toolbar","fullWidth","editorOptions","DefaultEditorOptions","onFocus","extensions","_toConsumableArray","configure","class","suggestion","editable","Button","size","variant","color","endIcon","SendIcon","disabled","AuthDialog","open","onClose","text","paddingTop","paddingBottom","fontWeight","& p","loading","zIndex","opacity","right","display","alignItems","justifyContent","CommentsList","comments","sort","a","b","map","_userDataModel$fields2","ReferenceField","reference","linkType","AvatarWithLabelField","Typography","TextField","title","DateField","showTime","RichTextField","CircularProgress","thickness","useCollection","predicateOrUrl","setItems","setLoading","_useState6","loaded","setLoaded","_useState8","error","setError","collectionUrl","startsWith","then","orderedItems","useEffect","item","oldItems","itemId","filter","refetch","CommentsField","_useCollection","replies","Error","defaultProps","addLabel","CollectionList","resource","children","rest","_objectWithoutProperties","_excluded","Children","count","_useGetOne","useGetOne","enabled","collection","data","style","LinearProgress","ReferenceArrayField","_extends","ReferenceCollectionField","BlankNode","constructor","nextId","equals","other","termType","prototype","module","DefaultGraph","original","blankNode","defaultGraph","literal","language","namedNode","datatype","subject","fromTerm","predicate","object","graph","quad","variable","NamedNode","iri","Literal","stringDatatype","langStringDatatype","Quad","Variable","name","DataFactory","languageOrDatatype","indexOf","defaultGraphInstance","fromTermRaw","call","fromQuad","triple","generator","SparqlGenerator","require","Generator","background","boxShadow","fontSize","overflow","border","margin","textAlign","&.selected","borderColor","MentionsList","forwardRef","props","ref","selectedIndex","setSelectedIndex","selectItem","index","command","useImperativeHandle","onKeyDown","event","key","length","renderMentions","component","popup","onStart","ReactRenderer","editor","tippy","getReferenceClientRect","clientRect","appendTo","showOnCreate","interactive","trigger","placement","onUpdate","updateProps","setProps","_component$ref","hide","onExit","destroy","ACCEPT","ADD","ANNOUNCE","ARRIVE","BLOCK","CREATE","DELETE","DISLIKE","FLAG","FOLLOW","IGNORE","INVITE","JOIN","LEAVE","LIKE","LISTEN","MOVE","OFFER","QUESTION","REJECT","READ","REMOVE","TENTATIVE_REJECT","TENTATIVE_ACCEPT","TRAVAL","UNDO","UPDATE","VIEW","APPLICATION","GROUP","ORGANIZATION","PERSON","SERVICE","inboxUrl","inbox","baseTriples","baseQuery","asOntology","sparqlJsParams","filters","prefix","queryType","template","prefixes","as","useQuery","payload","_predicates","blankNodes","availableMentions","_userDataModel$fields3","toLowerCase","slice","_id$split","_id$split2","username","host","protocol","webfingerUrl","split","includes","links","find","l"],"mappings":"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"}