import*as e from"react";import t,{createContext as r,useState as n,useContext as i,useEffect as o,useMemo as a,useCallback as l,forwardRef as u,useImperativeHandle as c}from"react";import{useGetIdentity as s,fetchUtils as d,useRecordContext as f,useNotify as m,TextField as p,DateField as v,RichTextField as b,useGetOne as h,LinearProgress as g,useGetList as y}from"react-admin";import E from"@tiptap/extension-placeholder";import{ToggleButtonGroup as S,ToggleButton as w,List as O,ListItem as k,ListItemText as x,Menu as L,MenuItem as j,Box as T,Card as A,FormHelperText as C,Avatar as F,Button as I,Typography as R,CircularProgress as N}from"@mui/material";import P from"@mui/styles/makeStyles";import V from"@mui/icons-material/Send";import{buildBlankNodesQuery as z,useDataModel as _}from"@semapps/semantic-data-provider";import{AuthDialog as D}from"@semapps/auth-provider";import{mergeAttributes as U}from"@tiptap/core";import B from"@tiptap/extension-mention";import{useEditor as M,EditorContent as H,ReactRenderer as q}from"@tiptap/react";import W from"@tiptap/starter-kit";import G from"@tiptap/extension-underline";import J from"@tiptap/extension-link";import K from"@tiptap/extension-text-align";import Q from"@tiptap/extension-image";import $ from"@tiptap/extension-text-style";import{Color as X}from"@tiptap/extension-color";import Y from"@tiptap/extension-highlight";import{styled as Z,alpha as ee}from"@mui/material/styles";import{useTranslate as te,useResourceContext as re,useInput as ne}from"ra-core";import{useTheme as ie,Labeled as oe,InputHelperText as ae}from"ra-ui-materialui";import le from"@mui/icons-material/ArrowDropDown";import ue from"@mui/icons-material/FormatBold";import ce from"@mui/icons-material/FormatItalic";import se from"@mui/icons-material/FormatUnderlined";import de from"@mui/icons-material/FormatStrikethrough";import fe from"@mui/icons-material/Code";import me from"@mui/icons-material/FormatColorText";import pe from"@mui/icons-material/FontDownload";import{grey as ve,red as be,orange as he,yellow as ge,green as ye,blue as Ee,purple as Se}from"@mui/material/colors";import we from"@mui/icons-material/FormatAlignCenter";import Oe from"@mui/icons-material/FormatAlignLeft";import ke from"@mui/icons-material/FormatAlignRight";import xe from"@mui/icons-material/FormatAlignJustify";import Le from"@mui/icons-material/FormatListBulleted";import je from"@mui/icons-material/FormatListNumbered";import Te from"@mui/icons-material/InsertLink";import Ae from"@mui/icons-material/Image";import Ce from"@mui/icons-material/FormatQuote";import Fe from"@mui/icons-material/FormatClear";import{ReferenceField as Ie,AvatarWithLabelField as Re,ReferenceArrayField as Ne}from"@semapps/field-components";import Pe from"tippy.js";function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(r),!0).forEach((function(t){Be(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _e(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
_e=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,o=Object.create(i.prototype),a=new O(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return x()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var l=E(a,r);if(l){if(l===s)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function d(){}function f(){}function m(){}var p={};l(p,i,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(k([])));b&&b!==t&&r.call(b,i)&&(p=b);var h=m.prototype=d.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var n;this._invoke=function(i,o){function a(){return new t((function(n,a){!function n(i,o,a,l){var u=c(e[i],e,o);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,l)}),(function(e){n("throw",e,a,l)})):t.resolve(d).then((function(e){s.value=e,a(s)}),(function(e){return n("throw",e,a,l)}))}l(u.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function E(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return f.prototype=m,l(h,"constructor",m),l(m,"constructor",f),f.displayName=l(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e},e.awrap=function(e){return{__await:e}},g(y.prototype),l(y.prototype,o,(function(){return this})),e.AsyncIterator=y,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new y(u(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},g(h),l(h,a,"Generator"),l(h,i,(function(){return this})),l(h,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=k,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,s):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;w(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}function De(e,t,r,n,i,o,a){try{var l=e[o](a),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,i)}function Ue(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){De(o,n,i,a,l,"next",e)}function l(e){De(o,n,i,a,l,"throw",e)}a(void 0)}))}}function Be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Me(){return(Me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function He(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,l=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){l=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(l)throw i}}return o}(e,t)||Ge(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(e){return function(e){if(Array.isArray(e))return Je(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ge(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){if(e){if("string"==typeof e)return Je(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Je(e,t):void 0}}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ke(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=Ke(e[t]))&&(n&&(n+=" "),n+=r);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function Qe(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=Ke(e))&&(n&&(n+=" "),n+=t);return n}var $e,Xe=r(void 0),Ye=function(t){var r=t.children,n=t.value;return e.createElement(Xe.Provider,{value:n},r)},Ze=function(){var e=n(!1),t=e[0],r=e[1],a=i(Xe);return o((function(){var e=function(){r(!0)};return null!=a&&(r(a.isEditable),a.on("create",e)),function(){null!=a&&a.off("create",e)}}),[a]),t?a:null},et=function(){return(et=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tt=function(t){var r=Ze(),i=te(),a=n([]),l=a[0],u=a[1],c=i("ra.tiptap.bold",{_:"Bold"}),s=i("ra.tiptap.italic",{_:"Italic"}),d=i("ra.tiptap.underline",{_:"Underline"}),f=i("ra.tiptap.strike",{_:"Strikethrough"}),m=i("ra.tiptap.code",{_:"Code"});o((function(){var e=function(){u((function(){return rt.reduce((function(e,t){return r&&r.isActive(t)&&e.push(t),e}),[])}))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]);return e.createElement(S,et({},t,{disabled:!(null==r?void 0:r.isEditable),onChange:function(e,t){rt.forEach((function(e){var n=r&&r.isActive(e)&&!t.includes(e),i=r&&!r.isActive(e)&&t.includes(e);(n||i)&&nt[e](r)}))},value:l}),e.createElement(w,{value:"bold","aria-label":c,title:c},e.createElement(ue,{fontSize:"inherit"})),e.createElement(w,{value:"italic","aria-label":s,title:s},e.createElement(ce,{fontSize:"inherit"})),e.createElement(w,{value:"underline","aria-label":d,title:d},e.createElement(se,{fontSize:"inherit"})),e.createElement(w,{value:"strike","aria-label":f,title:f},e.createElement(de,{fontSize:"inherit"})),e.createElement(w,{value:"code","aria-label":m,title:m},e.createElement(fe,{fontSize:"inherit"})))},rt=["bold","italic","underline","strike","code"],nt={bold:function(e){return e.chain().focus().toggleBold().run()},italic:function(e){return e.chain().focus().toggleItalic().run()},underline:function(e){return e.chain().focus().toggleUnderline().run()},strike:function(e){return e.chain().focus().toggleStrike().run()},code:function(e){return e.chain().focus().toggleCode().run()}},it=function(){return(it=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ot=function(t){var r=Ze(),i=te(),a=i("ra.tiptap.list_bulleted",{_:"Bulleted list"}),l=i("ra.tiptap.list_numbered",{_:"Numbered list"}),u=n(),c=u[0],s=u[1];return o((function(){var e=function(){s((function(){return at.reduce((function(e,t){return r&&r.isActive(t)?t:e}),void 0)}))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]),e.createElement(S,it({},t,{disabled:!(null==r?void 0:r.isEditable),exclusive:!0,onChange:function(e,t){at.forEach((function(e){var n=r&&r.isActive(e)&&t!==e,i=r&&!r.isActive(e)&&t===e;(n||i)&&lt[e](r)}))},value:c}),e.createElement(w,{value:"bulletList","aria-label":a,title:a},e.createElement(Le,{fontSize:"inherit"})),e.createElement(w,{value:"orderedList","aria-label":l,title:l},e.createElement(je,{fontSize:"inherit"})))},at=["bulletList","orderedList"],lt={bulletList:function(e){return e.chain().focus().toggleBulletList().run()},orderedList:function(e){return e.chain().focus().toggleOrderedList().run()}},ut=function(){return(ut=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ct=function(t){var r=Ze(),i=te(),a=n("left"),l=a[0],u=a[1],c=i("ra.tiptap.align_left",{_:"Align left"}),s=i("ra.tiptap.align_right",{_:"Align right"}),d=i("ra.tiptap.align_center",{_:"Center"}),f=i("ra.tiptap.align_justify",{_:"Justify"});o((function(){var e=function(){u((function(e){return st.reduce((function(e,t){return r&&r.isActive({textAlign:t})?t:e}),e)}))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]);return e.createElement(S,ut({},t,{disabled:!(null==r?void 0:r.isEditable),exclusive:!0,onChange:function(e,t){dt[t]&&dt[t](r)},value:l}),e.createElement(w,{value:"left","aria-label":c,title:c},e.createElement(Oe,{fontSize:"inherit"})),e.createElement(w,{value:"center","aria-label":d,title:d},e.createElement(we,{fontSize:"inherit"})),e.createElement(w,{value:"right","aria-label":s,title:s},e.createElement(ke,{fontSize:"inherit"})),e.createElement(w,{value:"justify","aria-label":f,title:f},e.createElement(xe,{fontSize:"inherit"})))},st=["left","center","right","justify","code"],dt={left:function(e){return e.chain().focus().setTextAlign("left").run()},center:function(e){return e.chain().focus().setTextAlign("center").run()},right:function(e){return e.chain().focus().setTextAlign("right").run()},justify:function(e){return e.chain().focus().setTextAlign("justify").run()}},ft=function(){return(ft=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},mt=function(t){var r=Ze(),i=te(),a=function(){var e=Ze(),t=n(e?e.state.doc.textBetween(e.state.selection.from,e.state.selection.to):null),r=t[0],i=t[1];return o((function(){var t=function(){i(e?e.state.doc.textBetween(e.state.selection.from,e.state.selection.to):null)};return e&&e.on("selectionUpdate",t),function(){e&&e.off("selectionUpdate",t)}}),[e]),r}(),l=i("ra.tiptap.link",{_:"Add a link"});return e.createElement(w,ft({"aria-label":l,title:l},t,{disabled:!(null==r?void 0:r.isEditable)||!a,value:"link",onClick:function(){if(r.can().setLink({href:""})){var e=window.prompt("URL");r.chain().focus().extendMarkRange("link").setLink({href:e}).run()}},selected:r&&r.isActive("link")}),e.createElement(Te,{fontSize:"inherit"}))},pt=function(){return(pt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},vt=function(t){var r=Ze(),i=te(),a=n(!1),l=a[0],u=a[1],c=i("ra.tiptap.blockquote",{_:"Blockquote"});return o((function(){var e=function(){u(r&&r.isActive("blockquote"))};return r&&(r.on("update",e),r.on("selectionUpdate",e)),function(){r&&(r.off("update",e),r.off("selectionUpdate",e))}}),[r]),e.createElement(w,pt({"aria-label":c,title:c},t,{disabled:!(null==r?void 0:r.isEditable),onClick:function(){return r.chain().focus().toggleBlockquote().run()},selected:l,value:"quote"}),e.createElement(Ce,{fontSize:"inherit"}))},bt=function(){return(bt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ht=function(t){var r=Ze(),n=te()("ra.tiptap.clear_format",{_:"Clear format"});return e.createElement(w,bt({"aria-label":n,title:n},t,{disabled:!(null==r?void 0:r.isEditable),value:"clear",onClick:function(){return r.chain().focus().unsetAllMarks().run()}}),e.createElement(Fe,{fontSize:"inherit"}))},gt=function(t){var r,i=te(),a=Ze(),l=n(null),u=l[0],c=l[1],s=t.size,d=n(yt[0]),f=d[0],m=d[1];return o((function(){var e=function(){m((function(e){return yt.reduce((function(e,t){if(a){if("paragraph"===t.value&&a.isActive("paragraph"))return t;if(a.isActive("heading",{level:t.level}))return t}return e}),e)}))};return a&&(a.on("update",e),a.on("selectionUpdate",e)),function(){a&&(a.off("update",e),a.off("selectionUpdate",e))}}),[a]),e.createElement(wt,null,e.createElement(O,{component:"nav","aria-label":i("ra.tiptap.select_level",{_:"Select the level"}),dense:!0,disablePadding:!0,className:St.list},e.createElement(k,{button:!0,"aria-haspopup":"true","aria-controls":"level-menu","aria-label":i("ra.tiptap.current_level",{_:"Current level"}),disabled:!(null==a?void 0:a.isEditable),onClick:function(e){c(e.currentTarget)},className:Qe((r={},r[St.sizeSmall]="small"===s,r[St.sizeLarge]="large"===s,r))},e.createElement(x,{primary:i(f.label,{_:f.defaultLabel})}),e.createElement(le,null))),e.createElement(L,{anchorEl:u,open:Boolean(u),id:"level-menu",onClose:function(e){c(null)}},yt.map((function(t,r){return e.createElement(j,{key:t.label,selected:t===f,onClick:function(e){!function(e,t){c(null);var r=yt[t];"paragraph"===r.value?a.chain().focus().setParagraph().run():"heading"===r.value&&a.chain().focus().setHeading({level:r.level}).run()}(0,r)}},i(t.label,{_:t.defaultLabel}))}))))},yt=[{label:"ra.tiptap.paragraph",defaultLabel:"Normal",value:"paragraph"},{label:"ra.tiptap.heading1",defaultLabel:"Heading 1",value:"heading",level:1},{label:"ra.tiptap.heading2",defaultLabel:"Heading 2",value:"heading",level:2},{label:"ra.tiptap.heading3",defaultLabel:"Heading 3",value:"heading",level:3},{label:"ra.tiptap.heading4",defaultLabel:"Heading 4",value:"heading",level:4},{label:"ra.tiptap.heading5",defaultLabel:"Heading 5",value:"heading",level:5},{label:"ra.tiptap.heading6",defaultLabel:"Heading 6",value:"heading",level:6}],Et="RaRichTextInputLevelSelect",St={list:"".concat(Et,"-list"),sizeSmall:"".concat(Et,"-sizeSmall"),sizeLarge:"".concat(Et,"-sizeLarge")},wt=Z("div")((function(e){var t,r=e.theme;return(t={})["&.".concat(St.list)]={borderRadius:r.shape.borderRadius,border:"1px solid ".concat(ee(r.palette.action.active,.12))},t["& .".concat(St.sizeSmall)]={paddingTop:1,paddingBottom:1,"& .MuiTypography-root":{fontSize:r.typography.pxToRem(13)}},t["& .".concat(St.sizeLarge)]={paddingTop:8,paddingBottom:8,"& .MuiTypography-root":{fontSize:r.typography.pxToRem(15)}},t})),Ot=function(){return(Ot=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},kt=function(t){var r=te(),n=Ze(),i=r("ra.tiptap.image",{_:"Image"}),o=e.useCallback((function(){var e=window.prompt(r("ra.tiptap.image_dialog",{_:"Image URL"}));e&&n.chain().focus().setImage({src:e}).run()}),[n,r]);return n?e.createElement(w,Ot({"aria-label":i,title:i},t,{disabled:!(null==n?void 0:n.isEditable),value:"image",onClick:o}),e.createElement(Ae,{fontSize:"inherit"})):null},xt=function(){return(xt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e){e.FONT="font",e.BACKGROUND="background"}($e||($e={}));var Lt=function(t){var r=te(),n=Ze(),i=e.useState(!1),o=i[0],a=i[1],l=e.useState($e.FONT),u=l[0],c=l[1],s=r("ra.tiptap.color",{_:"Color"}),d=r("ra.tiptap.highlight",{_:"Highlight"}),f=function(e){a(!0),c(e)};return n?e.createElement(T,{sx:{position:"relative"}},e.createElement(Tt,{onClick:function(){return a(!1)}},e.createElement(S,null,e.createElement(w,xt({"aria-label":s,title:s},t,{disabled:!(null==n?void 0:n.isEditable),value:"color",onClick:function(){return f($e.FONT)}}),e.createElement(me,{fontSize:"inherit"})),e.createElement(w,xt({"aria-label":d,title:d},t,{disabled:!(null==n?void 0:n.isEditable),value:"highlight",onClick:function(){return f($e.BACKGROUND)}}),e.createElement(pe,{fontSize:"inherit"}))),o&&e.createElement(jt,{editor:n,close:function(){return a(!1)},colorType:u}))):null},jt=function(t){var r,n,i=t.editor,o=t.close,a=t.colorType,l=ie()[0],u=[ve,be,he,ge,ye,Ee,Se];return e.createElement(A,{sx:{position:"absolute",top:38,left:a===$e.FONT?0:"50%",p:1,border:"1px solid ".concat(null===(n=null===(r=null==l?void 0:l.palette)||void 0===r?void 0:r.background)||void 0===n?void 0:n.default),display:"flex",flexDirection:"column",gap:1,zIndex:1}},[900,700,500,300,100].map((function(t,r){return e.createElement(T,{key:"shade-".concat(t),sx:{display:"flex",flexDirection:"row",gap:1}},u.map((function(n,l){return e.createElement(T,{key:"color-".concat(r*u.length+l+1),sx:{width:16,height:16,cursor:"pointer",backgroundColor:n[t]},onClick:function(){return function(e){a===$e.FONT?i.chain().focus().setColor(e).run():i.chain().focus().toggleHighlight({color:e}).run(),o()}(n[t])}})})))})))},Tt=function(t){var r=t.className,n=t.onClick,i=t.children,o=e.useRef(null);return At(o,n),e.createElement("div",{className:r,ref:o},i)},At=function(t,r){e.useEffect((function(){var e=function(e){t.current&&!t.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),function(){document.removeEventListener("mousedown",e)}}),[t,r])},Ct=function(){return(Ct=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Ft=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},It=function(t){var r=t.size,n=void 0===r?"medium":r,i=t.children,o=void 0===i?e.createElement(e.Fragment,null,e.createElement(gt,{size:n}),e.createElement(tt,{size:n}),e.createElement(Lt,{size:n}),e.createElement(ct,{size:n}),e.createElement(ot,{size:n}),e.createElement(mt,{size:n}),e.createElement(kt,{size:n}),e.createElement(vt,{size:n}),e.createElement(ht,{size:n})):i,a=Ft(t,["size","children"]);return e.createElement(Nt,Ct({className:Rt.root},a),o)},Rt={root:"".concat("RaRichTextInputToolbar","-root")},Nt=Z("div")((function(e){var t,r=e.theme;return(t={})["&.".concat(Rt.root)]={display:"flex",flexWrap:"wrap",alignItems:"center","& > *":{marginRight:r.spacing(1),marginBottom:r.spacing(1)},"& > *:last-child":{marginRight:0}},t})),Pt=function(){return(Pt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vt=function(t){var r,n,i=t.className,a=t.defaultValue,l=void 0===a?"":a,u=t.disabled,c=void 0!==u&&u,s=t.editorOptions,d=void 0===s?_t:s,f=t.fullWidth,m=t.helperText,p=t.label,v=t.readOnly,b=void 0!==v&&v,h=t.source,g=t.toolbar,y=re(t),E=ne(Pt(Pt({},t),{source:h,defaultValue:l})),S=E.id,w=E.field,O=E.isRequired,k=E.fieldState,x=E.formState.isSubmitted,L=M(Pt(Pt({},d),{editable:!c&&!b,content:w.value,editorProps:Pt(Pt({},null==d?void 0:d.editorProps),{attributes:Pt(Pt({},null===(r=null==d?void 0:d.editorProps)||void 0===r?void 0:r.attributes),{id:S})})})),j=k.error,T=k.invalid,A=k.isTouched;return o((function(){if(L){var e=L.state.selection,t=e.from,r=e.to;L.commands.setContent(w.value,!1,{preserveWhitespace:!0}),L.commands.setTextSelection({from:t,to:r})}}),[L,w.value]),o((function(){var e;L&&L.setOptions({editable:!c&&!b,editorProps:Pt(Pt({},null==d?void 0:d.editorProps),{attributes:Pt(Pt({},null===(e=null==d?void 0:d.editorProps)||void 0===e?void 0:e.attributes),{id:S})})})}),[c,L,b,S,null==d?void 0:d.editorProps,null===(n=null==d?void 0:d.editorProps)||void 0===n?void 0:n.attributes]),o((function(){if(L){var e=function(){if(L.isEmpty)return w.onChange(""),void w.onBlur();var e=L.getHTML();w.onChange(e),w.onBlur()};return L.on("update",e),function(){L.off("update",e)}}}),[L,w]),e.createElement(oe,{isRequired:O,label:p,id:"".concat(S,"-label"),color:(null==k?void 0:k.invalid)?"error":void 0,source:h,resource:y,fullWidth:f},e.createElement(zt,{className:Qe("ra-input","ra-input-".concat(h),i),editor:L,error:j,helperText:m,id:S,isTouched:A,isSubmitted:x,invalid:T,toolbar:g||e.createElement(It,null)}))},zt=function(t){var r=t.className,n=t.editor,i=t.error;t.fullWidth;var o=t.helperText,a=t.id,l=t.isTouched,u=t.isSubmitted,c=t.invalid,s=t.toolbar;return e.createElement(Ut,{className:r},e.createElement(Ye,{value:n},s,e.createElement(H,{"aria-labelledby":"".concat(a,"-label"),className:Dt.editorContent,editor:n})),e.createElement(C,{className:(l||u)&&c?"ra-rich-text-input-error":"",error:(l||u)&&c},e.createElement(ae,{touched:l||u,error:null==i?void 0:i.message,helperText:o})))},_t={extensions:[W,G,J,K.configure({types:["heading","paragraph"]}),Q.configure({inline:!0}),$,X,Y.configure({multicolor:!0})]},Dt={editorContent:"".concat("RaRichTextInput","-editorContent")},Ut=Z("div",{name:"RaRichTextInput",overridesResolver:function(e,t){return t.root}})((function(e){var t,r=e.theme;return(t={display:"flex",flexDirection:"column",alignItems:"center"})["& .".concat(Dt.editorContent)]={width:"100%","& .ProseMirror":{backgroundColor:r.palette.background.default,borderColor:"light"===r.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)",borderRadius:r.shape.borderRadius,borderStyle:"solid",borderWidth:"1px",padding:r.spacing(1),'&[contenteditable="false"], &[contenteditable="false"]:hover, &[contenteditable="false"]:focus':{backgroundColor:r.palette.action.disabledBackground},"&:hover":{backgroundColor:r.palette.action.hover},"&:focus":{backgroundColor:r.palette.background.default},"& p":{margin:"0 0 1em 0","&:last-child":{marginBottom:0}}}},t}));function Bt(){return(Bt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Mt(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}var Ht=".".charCodeAt(0),qt=/\\(\\)?/g,Wt=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g"),Gt={},Jt=/[.[\]]+/,Kt=function(e){if(null==e||!e.length)return[];if("string"!=typeof e)throw new Error("toPath() expects a string");var t,r;return null==Gt[e]&&(e.endsWith("[]")?Gt[e]=e.split(Jt).filter(Boolean):Gt[e]=(r=[],(t=e).charCodeAt(0)===Ht&&r.push(""),t.replace(Wt,(function(e,t,n,i){var o=e;n?o=i.replace(qt,"$1"):t&&(o=t.trim()),r.push(o)})),r)),Gt[e]},Qt=function(e,t){for(var r=Kt(t),n=e,i=0;i<r.length;i++){var o=r[i];if(null==n||"object"!=typeof n||Array.isArray(n)&&isNaN(o))return;n=n[o]}return n};function $t(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var Xt=function(e,t,r,n){if(void 0===n&&(n=!1),null==e)throw new Error("Cannot call setIn() with "+String(e)+" state");if(null==t)throw new Error("Cannot call setIn() with "+String(t)+" key");return function e(t,r,n,i,o){if(r>=n.length)return i;var a=n[r];if(isNaN(a)){var l;if(null==t){var u,c=e(void 0,r+1,n,i,o);return void 0===c?void 0:((u={})[a]=c,u)}if(Array.isArray(t))throw new Error("Cannot set a non-numeric property on an array");var s=e(t[a],r+1,n,i,o);if(void 0===s){var d=Object.keys(t).length;if(void 0===t[a]&&0===d)return;return void 0!==t[a]&&d<=1?isNaN(n[r-1])||o?void 0:{}:(t[a],Mt(t,[a].map($t)))}return Bt({},t,((l={})[a]=s,l))}var f=Number(a);if(null==t){var m=e(void 0,r+1,n,i,o);if(void 0===m)return;var p=[];return p[f]=m,p}if(!Array.isArray(t))throw new Error("Cannot set a numeric property on an object");var v=e(t[f],r+1,n,i,o),b=[].concat(t);if(o&&void 0===v){if(b.splice(f,1),0===b.length)return}else b[f]=v;return b}(e,0,Kt(t),r,n)},Yt="FINAL_FORM/array-error";function Zt(e,t){var r=e.errors,n=e.initialValues,i=e.lastSubmittedValues,o=e.submitErrors,a=e.submitFailed,l=e.submitSucceeded,u=e.submitting,c=e.values,s=t.active,d=t.blur,f=t.change,m=t.data,p=t.focus,v=t.modified,b=t.modifiedSinceLastSubmit,h=t.name,g=t.touched,y=t.validating,E=t.visited,S=Qt(c,h),w=Qt(r,h);w&&w[Yt]&&(w=w[Yt]);var O=o&&Qt(o,h),k=n&&Qt(n,h),x=t.isEqual(k,S),L=!w&&!O;return{active:s,blur:d,change:f,data:m,dirty:!x,dirtySinceLastSubmit:!(!i||t.isEqual(Qt(i,h),S)),error:w,focus:p,initial:k,invalid:!L,length:Array.isArray(S)?S.length:void 0,modified:v,modifiedSinceLastSubmit:b,name:h,pristine:x,submitError:O,submitFailed:a,submitSucceeded:l,submitting:u,touched:g,valid:L,value:S,visited:E,validating:y}}var er=["active","data","dirty","dirtySinceLastSubmit","error","initial","invalid","length","modified","modifiedSinceLastSubmit","pristine","submitError","submitFailed","submitSucceeded","submitting","touched","valid","value","visited","validating"],tr=function(e,t){if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var i=Object.prototype.hasOwnProperty.bind(t),o=0;o<r.length;o++){var a=r[o];if(!i(a)||e[a]!==t[a])return!1}return!0};function rr(e,t,r,n,i,o){var a=!1;return i.forEach((function(i){n[i]&&(e[i]=t[i],r&&(~o.indexOf(i)?tr(t[i],r[i]):t[i]===r[i])||(a=!0))})),a}var nr=["data"],ir=function(e,t,r,n){var i={blur:e.blur,change:e.change,focus:e.focus,name:e.name};return rr(i,e,t,r,er,nr)||!t||n?i:void 0},or=["active","dirty","dirtyFields","dirtyFieldsSinceLastSubmit","dirtySinceLastSubmit","error","errors","hasSubmitErrors","hasValidationErrors","initialValues","invalid","modified","modifiedSinceLastSubmit","pristine","submitting","submitError","submitErrors","submitFailed","submitSucceeded","touched","valid","validating","values","visited"],ar=["touched","visited"];function lr(e,t,r,n){var i={};return rr(i,e,t,r,or,ar)||!t||n?i:void 0}var ur=function(e){var t,r;return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return t&&i.length===t.length&&!i.some((function(e,r){return!tr(t[r],e)}))||(t=i,r=e.apply(void 0,i)),r}},cr=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then},sr=function(e,t){return e===t},dr=function e(t){return Object.keys(t).some((function(r){var n=t[r];return!n||"object"!=typeof n||n instanceof Error?void 0!==n:e(n)}))};function fr(e,t,r,n,i,o){var a=i(r,n,t,o);return!!a&&(e(a),!0)}function mr(e,t,r,n,i){var o=e.entries;Object.keys(o).forEach((function(e){var a=o[Number(e)];if(a){var l=a.subscription,u=a.subscriber,c=a.notified;fr(u,l,t,r,n,i||!c)&&(a.notified=!0)}}))}function pr(e){if(!e)throw new Error("No config specified");var t=e.debug,r=e.destroyOnUnregister,n=e.keepDirtyOnReinitialize,i=e.initialValues,o=e.mutators,a=e.onSubmit,l=e.validate,u=e.validateOnBlur;if(!a)throw new Error("No onSubmit function specified");var c={subscribers:{index:0,entries:{}},fieldSubscribers:{},fields:{},formState:{asyncErrors:{},dirtySinceLastSubmit:!1,modifiedSinceLastSubmit:!1,errors:{},initialValues:i&&Bt({},i),invalid:!1,pristine:!0,submitting:!1,submitFailed:!1,submitSucceeded:!1,resetWhileSubmitting:!1,valid:!0,validating:0,values:i?Bt({},i):{}},lastFormState:void 0},s=0,d=!1,f=!1,m=!1,p=0,v={},b=function(e,t,r){var n=r(Qt(e.formState.values,t));e.formState.values=Xt(e.formState.values,t,n)||{}},h=function(e,t,r){if(e.fields[t]){var n,i;e.fields=Bt({},e.fields,((n={})[r]=Bt({},e.fields[t],{name:r,blur:function(){return A.blur(r)},change:function(e){return A.change(r,e)},focus:function(){return A.focus(r)},lastFieldState:void 0}),n)),delete e.fields[t],e.fieldSubscribers=Bt({},e.fieldSubscribers,((i={})[r]=e.fieldSubscribers[t],i)),delete e.fieldSubscribers[t];var o=Qt(e.formState.values,t);e.formState.values=Xt(e.formState.values,t,void 0)||{},e.formState.values=Xt(e.formState.values,r,o),delete e.lastFormState}},g=function(e){return function(){if(o){for(var t={formState:c.formState,fields:c.fields,fieldSubscribers:c.fieldSubscribers,lastFormState:c.lastFormState},r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];var a=o[e](n,t,{changeValue:b,getIn:Qt,renameField:h,resetFieldState:A.resetFieldState,setIn:Xt,shallowEqual:tr});return c.formState=t.formState,c.fields=t.fields,c.fieldSubscribers=t.fieldSubscribers,c.lastFormState=t.lastFormState,S(void 0,(function(){w(),j()})),a}}},y=o?Object.keys(o).reduce((function(e,t){return e[t]=g(t),e}),{}):{},E=function(e){return Object.keys(e.validators).reduce((function(t,r){var n=e.validators[Number(r)]();return n&&t.push(n),t}),[])},S=function(e,t){if(d)return f=!0,void t();var r=c.fields,n=c.formState,i=Bt({},r),o=Object.keys(i);if(l||o.some((function(e){return E(i[e]).length}))){var a=!1;if(e){var u=i[e];if(u){var s=u.validateFields;s&&(a=!0,o=s.length?s.concat(e):[e])}}var m,b={},h={},g={},y=[].concat(function(e){var t=[];if(l){var r=l(Bt({},c.formState.values));cr(r)?t.push(r.then((function(t){return e(t,!0)}))):e(r,!1)}return t}((function(e,t){t?h=e||{}:b=e||{}})),o.reduce((function(e,t){return e.concat(function(e,t){var r,n=[],i=E(e);i.length&&(i.forEach((function(i){var o=i(Qt(c.formState.values,e.name),c.formState.values,0===i.length||3===i.length?Zt(c.formState,c.fields[e.name]):void 0);if(o&&cr(o)){e.validating=!0;var a=o.then((function(r){c.fields[e.name]&&(c.fields[e.name].validating=!1,t(r))}));n.push(a)}else r||(r=o)})),t(r));return n}(r[t],(function(e){g[t]=e})))}),[])),S=y.length>0,w=++p,O=Promise.all(y).then((m=w,function(e){return delete v[m],e}));S&&(v[w]=O);var k=function(e){var t=Bt({},a?n.errors:{},b,e?h:n.asyncErrors),u=function(e){o.forEach((function(n){if(r[n]){var o=Qt(b,n),u=Qt(t,n),c=E(i[n]).length,s=g[n];e(n,c&&s||l&&o||(o||a?void 0:u))}}))};u((function(e,r){t=Xt(t,e,r)||{}})),u((function(e,r){if(r&&r[Yt]){var n=Qt(t,e),i=[].concat(n);i[Yt]=r[Yt],t=Xt(t,e,i)}})),tr(n.errors,t)||(n.errors=t),e&&(n.asyncErrors=h),n.error=b["FINAL_FORM/form-error"]};if(S&&(c.formState.validating++,t()),k(!1),t(),S){var x=function(){c.formState.validating--,t()};O.then((function(){p>w||k(!0)})).then(x,x)}}else t()},w=function(e){if(!s){var t=c.fields,r=c.fieldSubscribers,n=c.formState,i=Bt({},t),o=function(e){var t=i[e],o=Zt(n,t),a=t.lastFieldState;t.lastFieldState=o;var l=r[e];l&&mr(l,o,a,ir,void 0===a)};e?o(e):Object.keys(i).forEach(o)}},O=function(){Object.keys(c.fields).forEach((function(e){c.fields[e].touched=!0}))},k=function(){var e=c.fields,t=c.formState,r=c.lastFormState,n=Bt({},e),i=Object.keys(n),o=!1,a=i.reduce((function(e,r){return!n[r].isEqual(Qt(t.values,r),Qt(t.initialValues||{},r))&&(o=!0,e[r]=!0),e}),{}),l=i.reduce((function(e,r){var i=t.lastSubmittedValues||{};return n[r].isEqual(Qt(t.values,r),Qt(i,r))||(e[r]=!0),e}),{});t.pristine=!o,t.dirtySinceLastSubmit=!(!t.lastSubmittedValues||!Object.values(l).some((function(e){return e}))),t.modifiedSinceLastSubmit=!(!t.lastSubmittedValues||!Object.keys(n).some((function(e){return n[e].modifiedSinceLastSubmit}))),t.valid=!(t.error||t.submitError||dr(t.errors)||t.submitErrors&&dr(t.submitErrors));var u=function(e){var t=e.active,r=e.dirtySinceLastSubmit,n=e.modifiedSinceLastSubmit,i=e.error,o=e.errors,a=e.initialValues,l=e.pristine,u=e.submitting,c=e.submitFailed,s=e.submitSucceeded,d=e.submitError,f=e.submitErrors,m=e.valid,p=e.validating,v=e.values;return{active:t,dirty:!l,dirtySinceLastSubmit:r,modifiedSinceLastSubmit:n,error:i,errors:o,hasSubmitErrors:!!(d||f&&dr(f)),hasValidationErrors:!(!i&&!dr(o)),invalid:!m,initialValues:a,pristine:l,submitting:u,submitFailed:c,submitSucceeded:s,submitError:d,submitErrors:f,valid:m,validating:p>0,values:v}}(t),s=i.reduce((function(e,t){return e.modified[t]=n[t].modified,e.touched[t]=n[t].touched,e.visited[t]=n[t].visited,e}),{modified:{},touched:{},visited:{}}),d=s.modified,f=s.touched,m=s.visited;return u.dirtyFields=r&&tr(r.dirtyFields,a)?r.dirtyFields:a,u.dirtyFieldsSinceLastSubmit=r&&tr(r.dirtyFieldsSinceLastSubmit,l)?r.dirtyFieldsSinceLastSubmit:l,u.modified=r&&tr(r.modified,d)?r.modified:d,u.touched=r&&tr(r.touched,f)?r.touched:f,u.visited=r&&tr(r.visited,m)?r.visited:m,r&&tr(r,u)?r:u},x=!1,L=!1,j=function e(){if(x)L=!0;else{if(x=!0,t&&t(k(),Object.keys(c.fields).reduce((function(e,t){return e[t]=c.fields[t],e}),{})),!(s||d&&m)){var r=c.lastFormState,n=k();n!==r&&(c.lastFormState=n,mr(c.subscribers,n,r,lr))}x=!1,L&&(L=!1,e())}},T=function(){return Object.keys(c.fields).forEach((function(e){return c.fields[e].modifiedSinceLastSubmit=!1}))};S(void 0,(function(){j()}));var A={batch:function(e){s++,e(),s--,w(),j()},blur:function(e){var t=c.fields,r=c.formState,n=t[e];n&&(delete r.active,t[e]=Bt({},n,{active:!1,touched:!0}),u?S(e,(function(){w(),j()})):(w(),j()))},change:function(e,t){var r=c.fields,n=c.formState;if(Qt(n.values,e)!==t){b(c,e,(function(){return t}));var i=r[e];i&&(r[e]=Bt({},i,{modified:!0,modifiedSinceLastSubmit:!!n.lastSubmittedValues})),u?(w(),j()):S(e,(function(){w(),j()}))}},get destroyOnUnregister(){return!!r},set destroyOnUnregister(e){r=e},focus:function(e){var t=c.fields[e];t&&!t.active&&(c.formState.active=e,t.active=!0,t.visited=!0,w(),j())},mutators:y,getFieldState:function(e){var t=c.fields[e];return t&&t.lastFieldState},getRegisteredFields:function(){return Object.keys(c.fields)},getState:function(){return k()},initialize:function(e){var t=c.fields,r=c.formState,i=Bt({},t),o="function"==typeof e?e(r.values):e;n||(r.values=o);var a=n?Object.keys(i).reduce((function(e,t){return i[t].isEqual(Qt(r.values,t),Qt(r.initialValues||{},t))||(e[t]=Qt(r.values,t)),e}),{}):{};r.initialValues=o,r.values=o,Object.keys(a).forEach((function(e){r.values=Xt(r.values,e,a[e])||{}})),S(void 0,(function(){w(),j()}))},isValidationPaused:function(){return d},pauseValidation:function(e){void 0===e&&(e=!0),d=!0,m=e},registerField:function(e,t,n,i){void 0===n&&(n={}),c.fieldSubscribers[e]||(c.fieldSubscribers[e]={index:0,entries:{}});var o=c.fieldSubscribers[e].index++;c.fieldSubscribers[e].entries[o]={subscriber:ur(t),subscription:n,notified:!1};var a=c.fields[e]||{active:!1,afterSubmit:i&&i.afterSubmit,beforeSubmit:i&&i.beforeSubmit,data:i&&i.data||{},isEqual:i&&i.isEqual||sr,lastFieldState:void 0,modified:!1,modifiedSinceLastSubmit:!1,name:e,touched:!1,valid:!0,validateFields:i&&i.validateFields,validators:{},validating:!1,visited:!1};a.blur=a.blur||function(){return A.blur(e)},a.change=a.change||function(t){return A.change(e,t)},a.focus=a.focus||function(){return A.focus(e)},c.fields[e]=a;var l=!1,u=i&&i.silent,s=function(){u?w(e):(j(),w())};if(i){l=!(!i.getValidator||!i.getValidator()),i.getValidator&&(c.fields[e].validators[o]=i.getValidator);var d=void 0===Qt(c.formState.values,e);void 0===i.initialValue||!d&&Qt(c.formState.values,e)!==Qt(c.formState.initialValues,e)||(c.formState.initialValues=Xt(c.formState.initialValues||{},e,i.initialValue),c.formState.values=Xt(c.formState.values,e,i.initialValue),S(void 0,s)),void 0!==i.defaultValue&&void 0===i.initialValue&&void 0===Qt(c.formState.initialValues,e)&&d&&(c.formState.values=Xt(c.formState.values,e,i.defaultValue))}return l?S(void 0,s):s(),function(){var t=!1;c.fields[e]&&(t=!(!c.fields[e].validators[o]||!c.fields[e].validators[o]()),delete c.fields[e].validators[o]);var n=!!c.fieldSubscribers[e];n&&delete c.fieldSubscribers[e].entries[o];var i=n&&!Object.keys(c.fieldSubscribers[e].entries).length;i&&(delete c.fieldSubscribers[e],delete c.fields[e],t&&(c.formState.errors=Xt(c.formState.errors,e,void 0)||{}),r&&(c.formState.values=Xt(c.formState.values,e,void 0,!0)||{})),u||(t?S(void 0,(function(){j(),w()})):i&&j())}},reset:function(e){void 0===e&&(e=c.formState.initialValues),c.formState.submitting&&(c.formState.resetWhileSubmitting=!0),c.formState.submitFailed=!1,c.formState.submitSucceeded=!1,delete c.formState.submitError,delete c.formState.submitErrors,delete c.formState.lastSubmittedValues,A.initialize(e||{})},resetFieldState:function(e){c.fields[e]=Bt({},c.fields[e],{active:!1,lastFieldState:void 0,modified:!1,touched:!1,valid:!0,validating:!1,visited:!1}),S(void 0,(function(){w(),j()}))},restart:function(e){void 0===e&&(e=c.formState.initialValues),A.batch((function(){for(var t in c.fields)A.resetFieldState(t),c.fields[t]=Bt({},c.fields[t],{active:!1,lastFieldState:void 0,modified:!1,modifiedSinceLastSubmit:!1,touched:!1,valid:!0,validating:!1,visited:!1});A.reset(e)}))},resumeValidation:function(){d=!1,m=!1,f&&S(void 0,(function(){w(),j()})),f=!1},setConfig:function(e,i){switch(e){case"debug":t=i;break;case"destroyOnUnregister":r=i;break;case"initialValues":A.initialize(i);break;case"keepDirtyOnReinitialize":n=i;break;case"mutators":o=i,i?(Object.keys(y).forEach((function(e){e in i||delete y[e]})),Object.keys(i).forEach((function(e){y[e]=g(e)}))):Object.keys(y).forEach((function(e){delete y[e]}));break;case"onSubmit":a=i;break;case"validate":l=i,S(void 0,(function(){w(),j()}));break;case"validateOnBlur":u=i;break;default:throw new Error("Unrecognised option "+e)}},submit:function(){var e=c.formState;if(!e.submitting){if(delete e.submitErrors,delete e.submitError,e.lastSubmittedValues=Bt({},e.values),c.formState.error||dr(c.formState.errors))return O(),T(),c.formState.submitFailed=!0,j(),void w();var t=Object.keys(v);if(t.length)Promise.all(t.map((function(e){return v[Number(e)]}))).then(A.submit,console.error);else if(!Object.keys(c.fields).some((function(e){return c.fields[e].beforeSubmit&&!1===c.fields[e].beforeSubmit()}))){var r,n=!1,i=function(t){e.submitting=!1;var i=e.resetWhileSubmitting;return i&&(e.resetWhileSubmitting=!1),t&&dr(t)?(e.submitFailed=!0,e.submitSucceeded=!1,e.submitErrors=t,e.submitError=t["FINAL_FORM/form-error"],O()):(i||(e.submitFailed=!1,e.submitSucceeded=!0),Object.keys(c.fields).forEach((function(e){return c.fields[e].afterSubmit&&c.fields[e].afterSubmit()}))),j(),w(),n=!0,r&&r(t),t};e.submitting=!0,e.submitFailed=!1,e.submitSucceeded=!1,e.lastSubmittedValues=Bt({},e.values),T();var o=a(e.values,A,i);if(!n){if(o&&cr(o))return j(),w(),o.then(i,(function(e){throw i(),e}));if(a.length>=3)return j(),w(),new Promise((function(e){r=e}));i(o)}}}},subscribe:function(e,t){if(!e)throw new Error("No callback given.");if(!t)throw new Error("No subscription provided. What values do you want to listen to?");var r=ur(e),n=c.subscribers,i=n.index++;n.entries[i]={subscriber:r,subscription:t,notified:!1};var o=k();return fr(r,t,o,o,lr,!0),function(){delete n.entries[i]}}};return A}var vr=["render","children","component"];function br(e,r,n){void 0===n&&(n=function(e,t){return e===t});var i=t.useRef(e);t.useEffect((function(){n(e,i.current)||(r(),i.current=e)}))}var hr=function(e,t){if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var i=Object.prototype.hasOwnProperty.bind(t),o=0;o<r.length;o++){var a=r[o];if(!i(a)||e[a]!==t[a])return!1}return!0},gr=e.createContext();var yr=function(e,t){return function(e,t,r){r.forEach((function(r){Object.defineProperty(e,r,{get:function(){return t[r]},enumerable:!0})}))}(e,t,["active","dirty","dirtyFields","dirtySinceLastSubmit","dirtyFieldsSinceLastSubmit","error","errors","hasSubmitErrors","hasValidationErrors","initialValues","invalid","modified","modifiedSinceLastSubmit","pristine","submitError","submitErrors","submitFailed","submitSucceeded","submitting","touched","valid","validating","values","visited"])},Er=["debug","decorators","destroyOnUnregister","form","initialValues","initialValuesEqual","keepDirtyOnReinitialize","mutators","onSubmit","subscription","validate","validateOnBlur"],Sr={"final-form":"4.20.8","react-final-form":"6.5.8"},wr=or.reduce((function(e,t){return e[t]=!0,e}),{});function Or(r){var n,i,o=r.debug,a=r.decorators,l=void 0===a?[]:a,u=r.destroyOnUnregister,c=r.form,s=r.initialValues,d=r.initialValuesEqual,f=r.keepDirtyOnReinitialize,m=r.mutators,p=r.onSubmit,v=r.subscription,b=void 0===v?wr:v,h=r.validate,g=r.validateOnBlur,y=Mt(r,Er),E={debug:o,destroyOnUnregister:u,initialValues:s,keepDirtyOnReinitialize:f,mutators:m,onSubmit:p,validate:h,validateOnBlur:g},S=(n=function(){var e=c||pr(E);return e.pauseValidation(),e},(i=t.useRef()).current||(i.current=n()),i.current),w=e.useState((function(){var e={};return S.subscribe((function(t){e=t}),b)(),e})),O=w[0],k=w[1],x=function(e){var r=t.useRef(e);return t.useEffect((function(){r.current=e})),r}(O);e.useEffect((function(){S.isValidationPaused()&&S.resumeValidation();var e=[S.subscribe((function(e){hr(e,x.current)||k(e)}),b)].concat(l?l.map((function(e){return e(S)})):[]);return function(){S.pauseValidation(),e.reverse().forEach((function(e){return e()}))}}),l),br(o,(function(){S.setConfig("debug",o)})),br(u,(function(){S.destroyOnUnregister=!!u})),br(f,(function(){S.setConfig("keepDirtyOnReinitialize",f)})),br(s,(function(){S.setConfig("initialValues",s)}),d||hr),br(m,(function(){S.setConfig("mutators",m)})),br(p,(function(){S.setConfig("onSubmit",p)})),br(h,(function(){S.setConfig("validate",h)})),br(g,(function(){S.setConfig("validateOnBlur",g)}));var L={form:Bt({},S,{reset:function(e){var t;(t=e)&&"function"==typeof t.stopPropagation?S.reset():S.reset(e)}}),handleSubmit:function(e){return e&&("function"==typeof e.preventDefault&&e.preventDefault(),"function"==typeof e.stopPropagation&&e.stopPropagation()),S.submit()}};return yr(L,O),e.createElement(gr.Provider,{value:S},function(t,r,n){var i=t.render,o=t.children,a=t.component,l=Mt(t,vr);if(a)return e.createElement(a,Object.assign(r,l,{children:o,render:i}));if(i)return i(void 0===o?Object.assign(r,l):Object.assign(r,l,{children:o}));if("function"!=typeof o)throw new Error("Must specify either a render prop, a render function as children, or a component prop to "+n);return o(Object.assign(r,l))}(Bt({},y,{__versions:Sr}),L,"ReactFinalForm"))}er.reduce((function(e,t){return e[t]=!0,e}),{});var kr={ACCEPT:"Accept",ADD:"Add",ANNOUNCE:"Announce",ARRIVE:"Arrive",BLOCK:"Block",CREATE:"Create",DELETE:"Delete",DISLIKE:"Dislike",FLAG:"Flag",FOLLOW:"Follow",IGNORE:"Ignore",INVITE:"Invite",JOIN:"Join",LEAVE:"Leave",LIKE:"Like",LISTEN:"Listen",MOVE:"Move",OFFER:"Offer",QUESTION:"Question",REJECT:"Reject",READ:"Read",REMOVE:"Remove",TENTATIVE_REJECT:"TentativeReject",TENTATIVE_ACCEPT:"TentativeAccept",TRAVAL:"Travel",UNDO:"Undo",UPDATE:"Update",VIEW:"View"},xr={APPLICATION:"Application",GROUP:"Group",ORGANIZATION:"Organization",PERSON:"Person",SERVICE:"Service"},Lr={ARTICLE:"Article",AUDIO:"Audio",DOCUMENT:"Document",EVENT:"Event",IMAGE:"Image",NOTE:"Note",PAGE:"Page",PLACE:"Place",PROFILE:"Profile",RELATIONSHIP:"Relationship",TOMBSTONE:"Tombstone",VIDEO:"Video"},jr="https://www.w3.org/ns/activitystreams#Public",Tr=function(){var e=s().identity,t=a((function(){var t;if(null!=e&&e.webIdData)return null==e||null===(t=e.webIdData)||void 0===t?void 0:t.outbox}),[e]),r=a((function(){var t,r;if(null!=e&&e.webIdData)return(null==e||null===(t=e.webIdData)||void 0===t||null===(r=t.endpoints)||void 0===r?void 0:r["void:sparqlEndpoint"])||(null==e?void 0:e.id)+"/sparql"}),[e]);return{post:l(function(){var e=Ue(_e().mark((function e(r){var n,i,o;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("token"),e.next=3,d.fetchJson(t,{method:"POST",body:JSON.stringify(ze({"@context":"https://www.w3.org/ns/activitystreams"},r)),headers:new Headers({"Content-Type":"application/ld+json",Authorization:"Bearer ".concat(n)})});case 3:return i=e.sent,o=i.headers,e.abrupt("return",o.get("Location"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[t]),fetch:l(Ue(_e().mark((function e(){var n,i,o,a,l;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&t){e.next=2;break}return e.abrupt("return");case 2:return n=localStorage.getItem("token"),i=z(["as:object"]),o="\n      PREFIX as: <https://www.w3.org/ns/activitystreams#>\n      CONSTRUCT {\n        ?s1 ?p1 ?o1 .\n        ".concat(i.construct,"\n      }\n      WHERE {\n        <").concat(t,"> as:items ?s1 .\n        ?s1 ?p1 ?o1 .\n        ").concat(i.where,"\n      }\n    "),e.next=7,d.fetchJson(r,{method:"POST",body:o,headers:new Headers({Accept:"application/ld+json",Authorization:n?"Bearer ".concat(n):void 0})});case 7:if(a=e.sent,!(l=a.json)["@graph"]){e.next=13;break}return e.abrupt("return",l["@graph"]);case 13:return e.abrupt("return",null);case 14:case"end":return e.stop()}}),e)}))),[r,t]),url:t,owner:null==e?void 0:e.id}},Ar=B.extend({renderHTML:function(e){var t=e.node,r=e.HTMLAttributes;return["span",U(this.options.HTMLAttributes,r),"@".concat(t.attrs.id.label)]},addAttributes:function(){return{label:{default:null,parseHTML:function(e){return{label:e.getAttribute("data-mention-label")}},renderHTML:function(e){return e.id.label?{"data-mention-label":e.id.label}:{}}},id:{default:null,parseHTML:function(e){return{id:e.getAttribute("data-mention-id")}},renderHTML:function(e){return e.id.id?{"data-mention-id":e.id.id}:{}}}}}}),Cr=P((function(e){return{form:{marginTop:-12},container:{paddingLeft:80,position:"relative"},avatar:{position:"absolute",top:16,left:0,bottom:0,width:64,height:64},editorContent:{"& > div":{backgroundColor:"rgba(0, 0, 0, 0.09)",padding:"2px 12px",borderWidth:"0px !important",borderRadius:0,borderBottom:"1px solid #FFF",minHeight:60,outline:"unset !important"},"& > div > p":{marginTop:12,marginBottom:12,fontFamily:e.typography.body1.fontFamily,marginBlockStart:"0.5em",marginBlockEnd:"0.5em"},"& > div > p.is-editor-empty:first-child::before":{color:"grey",content:"attr(data-placeholder)",float:"left",height:0,pointerEvents:"none"},marginBottom:-19},button:{marginBottom:15}}})),Fr=function(e){var r=e.context,i=e.placeholder,o=e.helperText,a=e.mentions,u=e.userResource,c=e.addItem,d=e.removeItem,p=f(),v=s().identity,b=_(u),h=Cr(),g=m(),y=Tr(),S=qe(n(!1),2),w=S[0],O=S[1],k=qe(n(!1),2),x=k[0],L=k[1],j=l(function(){var e=Ue(_e().mark((function e(t,n){var i,o,a,l,s,f;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.reset,o=(new DOMParser).parseFromString(t.comment,"text/html"),a=Array.from(o.body.getElementsByClassName("mention")),l=[],a.forEach((function(e){var t=e.attributes["data-mention-id"].value,r=e.attributes["data-mention-label"].value,n=o.createElement("a");n.setAttribute("href",new URL(window.location.href).origin+"/"+u+"/"+encodeURIComponent(t)+"/show"),n.textContent="@"+r,e.parentNode.replaceChild(n,e),l.push(t)})),"undefined"!==o.body.innerHTML){e.next=9;break}g("Votre commentaire est vide",{type:"error"}),e.next=24;break;case 9:return s=Date.now(),f={type:Lr.NOTE,attributedTo:y.owner,content:o.body.innerHTML,inReplyTo:p[r],published:(new Date).toISOString()},e.prev=11,c(ze({id:s},f)),i(),O(!1),e.next=17,y.post(ze(ze({},f),{},{to:[].concat(l,[jr])}));case 17:g("Commentaire post avec succs",{type:"success"}),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(11),d(s),g(e.t0.message,{type:"error"});case 24:case"end":return e.stop()}}),e,null,[[11,20]])})));return function(t,r){return e.apply(this,arguments)}}(),[y,g,O,c,d]),A=l((function(){v.id||L(!0)}),[v,L]);return a&&!a.items||!v?null:t.createElement(t.Fragment,null,t.createElement(Or,{onSubmit:j,subscription:{submitting:!0,pristine:!0},render:function(e){var r,n,l,u,c=e.handleSubmit,s=e.submitting;if(e.pristine){var d=document.getElementById("comment");d&&""!==d.textContent&&(d.innerHTML="")}return t.createElement("form",{onSubmit:c,className:h.form},t.createElement(T,{className:h.container,onClick:A},t.createElement(F,{src:(null==v||null===(r=v.webIdData)||void 0===r?void 0:r[null==b||null===(n=b.fieldsMapping)||void 0===n?void 0:n.image])||(null==v||null===(l=v.profileData)||void 0===l?void 0:l[null==b||null===(u=b.fieldsMapping)||void 0===u?void 0:u.image]),className:h.avatar}),t.createElement(Vt,{source:"comment",label:"",toolbar:null,fullWidth:!0,classes:{editorContent:h.editorContent},editorOptions:ze(ze({},_t),{},{onFocus:function(){O(!0)},extensions:[].concat(We(_t.extensions),[i?E.configure({placeholder:i}):null,a?Ar.configure({HTMLAttributes:{class:"mention"},suggestion:a}):null]),editable:!!v.id}),helperText:o}),w&&t.createElement(I,{type:"submit",size:"small",variant:"contained",color:"primary",endIcon:t.createElement(V,null),disabled:s,className:h.button},"Envoyer")))}}),t.createElement(D,{open:x,onClose:function(){return L(!1)},message:"Pour poster un commentaire, vous devez tre connect."}))},Ir=P((function(){return{container:{paddingLeft:80,marginTop:8,minHeight:80,position:"relative"},avatar:{position:"absolute",top:0,left:0,bottom:0,width:64,height:64},text:{paddingTop:2,paddingBottom:8},label:{fontWeight:"bold"},content:{"& p":{marginBlockStart:"0.5em",marginBlockEnd:"0.5em"}},loading:{zIndex:1e3,backgroundColor:"white",opacity:.5,position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",minHeight:200,marginTop:5}}})),Rr=function(e){var r=e.comments,n=e.userResource,i=e.loading,o=Ir(),a=_(n);return t.createElement(T,{position:"relative"},r&&r.sort((function(e,t){return new Date(t.published)-new Date(e.published)})).map((function(e){var r,i;return t.createElement(T,{className:o.container},t.createElement(T,{className:o.avatar},t.createElement(Ie,{record:e,reference:n,source:"attributedTo",linkType:"show"},t.createElement(Re,{image:null==a||null===(r=a.fieldsMapping)||void 0===r?void 0:r.image}))),t.createElement(T,{className:o.text},t.createElement(R,{variant:"body2"},t.createElement(Ie,{record:e,reference:n,source:"attributedTo",linkType:"show"},t.createElement(p,{variant:"body2",source:null==a||null===(i=a.fieldsMapping)||void 0===i?void 0:i.title,className:o.label})),"",t.createElement(v,{record:e,variant:"body2",source:"published",showTime:!0})),t.createElement(b,{record:e,variant:"body1",source:"content",className:o.content})))})),i&&t.createElement(T,{minHeight:200},t.createElement(T,{alignItems:"center",className:o.loading},t.createElement(N,{size:60,thickness:6}))))},Nr=function(e){var t=s().identity,r=qe(n([]),2),i=r[0],u=r[1],c=qe(n(!1),2),f=c[0],m=c[1],p=qe(n(!1),2),v=p[0],b=p[1],h=qe(n(!1),2),g=h[0],y=h[1],E=a((function(){if(e){if(e.startsWith("http"))return e;var r;if(null!=t&&t.webIdData)return null==t||null===(r=t.webIdData)||void 0===r?void 0:r[e]}}),[t,e]),S=l(Ue(_e().mark((function e(){var t,r;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E){e.next=2;break}return e.abrupt("return");case 2:m(!0),t=localStorage.getItem("token"),r=new Headers({Accept:"application/ld+json",Authorization:t?"Bearer ".concat(t):void 0}),d.fetchJson(E,{headers:r}).then((function(e){var t=e.json;t&&t.items?u(t.items):t&&t.orderedItems?u(t.orderedItems):u([]),y(!1),b(!0),m(!1)})).catch((function(){y(!0),b(!0),m(!1)}));case 6:case"end":return e.stop()}}),e)}))),[u,b,m,y,E]);o((function(){f||v||g||S()}),[S,f,v,g]);var w=l((function(e){u((function(t){return[].concat(We(t),[e])}))}),[u]),O=l((function(e){u((function(t){return t.filter((function(t){return"string"==typeof t?t!==e:t.id!==e}))}))}),[u]);return{items:i,loading:f,loaded:v,error:g,refetch:S,addItem:w,removeItem:O,url:E}},Pr=function(e){e.source;var r=e.context,n=e.helperText,i=e.placeholder,o=e.userResource,a=e.mentions,l=f(),u=Nr(l.replies),c=u.items,s=u.loading,d=u.addItem,m=u.removeItem;if(!o)throw new Error("No userResource defined for CommentsField");return t.createElement(t.Fragment,null,t.createElement(Fr,{context:r,helperText:n,userResource:o,placeholder:i,mentions:a,addItem:d,removeItem:m}),t.createElement(Rr,{comments:c,loading:s,userResource:o}))};Pr.defaultProps={label:"Commentaires",placeholder:"Commencez  taper votre commentaire...",source:"id",context:"id"};var Vr=["collectionUrl","resource","children"],zr=function(e){var r=e.collectionUrl,n=e.resource,i=e.children,o=He(e,Vr);if(1!==t.Children.count(i))throw new Error("<CollectionList> only accepts a single child");var a=h(n,r,{enabled:!!r}),l=a.data;return a.isLoading?t.createElement("div",{style:{marginTop:8}},t.createElement(g,null)):l?t.createElement(Ne,Me({reference:n,record:l,source:"items"},o),i):null},_r=["source","record","reference","children"],Dr=function(e){var r=e.source,n=e.record,i=e.reference,o=e.children,a=He(e,_r);if(1!==t.Children.count(o))throw new Error("<ReferenceCollectionField> only accepts a single child");return n&&n[r]?t.createElement(zr,Me({resource:i,collectionUrl:n[r]},a),o):null},Ur=function(){var e=s().identity,t=a((function(){var t;if(null!=e&&e.webIdData)return null==e||null===(t=e.webIdData)||void 0===t?void 0:t.inbox}),[e]),r=a((function(){var t,r;if(null!=e&&e.webIdData)return(null==e||null===(t=e.webIdData)||void 0===t||null===(r=t.endpoints)||void 0===r?void 0:r["void:sparqlEndpoint"])||(null==e?void 0:e.id)+"/sparql"}),[e]);return{fetch:l(function(){var e=Ue(_e().mark((function e(n){var i,o,a,l,u,c,s;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.filters,console.log("inboxUrl",t,r),r&&t){e.next=4;break}return e.abrupt("return");case 4:return o=localStorage.getItem("token"),a=z(["as:object"]),l="",i&&Object.keys(i).forEach((function(e){if(i[e]){var t=i[e].startsWith("http")?"<".concat(i[e],">"):i[e];l+="?s1 ".concat(e," ").concat(t," .")}})),u="\n        PREFIX as: <https://www.w3.org/ns/activitystreams#>\n        CONSTRUCT {\n          ?s1 ?p1 ?o1 .\n          ".concat(a.construct,"\n        }\n        WHERE {\n          <").concat(t,"> as:items ?s1 .\n          ?s1 ?p1 ?o1 .\n          FILTER( (isIRI(?s1)) ) .\n          ").concat(l,"\n          ").concat(a.where,"\n        }\n      "),e.next=11,d.fetchJson(r,{method:"POST",body:u,headers:new Headers({Accept:"application/ld+json",Authorization:o?"Bearer ".concat(o):void 0})});case 11:if(c=e.sent,!(s=c.json)["@graph"]){e.next=17;break}return e.abrupt("return",s["@graph"]);case 17:return e.abrupt("return",null);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,t]),url:t,owner:null==e?void 0:e.id}},Br=function(){return{fetch:l(function(){var e=Ue(_e().mark((function e(t){var r,n,i,o,a,l,u,c,s;return _e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.split("@"),(n=qe(r,3))[0],i=n[1],!(o=n[2])){e.next=18;break}return a=o.includes(":")?"http":"https",l="".concat(a,"://").concat(o,"/.well-known/webfinger?resource=acct:").concat(i,"@").concat(o),e.prev=4,e.next=7,d.fetchJson(l);case 7:return u=e.sent,c=u.json,s=c.links.find((function(e){return"application/activity+json"===e.type})),e.abrupt("return",s?s.href:null);case 13:return e.prev=13,e.t0=e.catch(4),e.abrupt("return",null);case 16:e.next=19;break;case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}(),[])}},Mr=P((function(e){return{items:{background:"#fff",borderRadius:"0.5rem",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.05), 0px 10px 20px rgba(0, 0, 0, 0.1)",color:"rgba(0, 0, 0, 0.8)",fontSize:"0.9rem",overflow:"hidden",padding:"0.2rem",position:"relative"},item:{background:"transparent",border:"1px solid transparent",borderRadius:"0.4rem",display:"block",margin:0,padding:"0.2rem 0.4rem",textAlign:"left",width:"100%","&.selected":{borderColor:"#000"}}}})),Hr=u((function(e,r){var i=qe(n(0),2),a=i[0],l=i[1],u=Mr(),s=function(t){var r=e.items[t];r&&e.command({id:r})};return o((function(){return l(0)}),[e.items]),c(r,(function(){return{onKeyDown:function(t){var r=t.event;return"ArrowUp"===r.key?(l((a+e.items.length-1)%e.items.length),!0):"ArrowDown"===r.key?(l((a+1)%e.items.length),!0):"Enter"===r.key&&(s(a),!0)}}})),t.createElement("div",{className:u.items},e.items.length?e.items.map((function(e,r){return t.createElement("button",{className:u.item+(r===a?" selected":""),key:r,onClick:function(){return s(r)}},e.label)})):t.createElement("div",{className:u.item},"Aucun rsultat"))})),qr=function(){var e,t;return{onStart:function(r){e=new q(Hr,{props:r,editor:r.editor}),t=Pe("body",{getReferenceClientRect:r.clientRect,appendTo:function(){return document.body},content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:function(r){e.updateProps(r),t[0].setProps({getReferenceClientRect:r.clientRect})},onKeyDown:function(r){var n;return"Escape"===r.event.key?(t[0].hide(),!0):null===(n=e.ref)||void 0===n?void 0:n.onKeyDown(r)},onExit:function(){t[0].destroy(),e.destroy()}}},Wr=function(e){var t,r,n=_(e),i=y({resource:e,payload:{filter:{_predicates:[null==n||null===(t=n.fieldsMapping)||void 0===t?void 0:t.title],blankNodes:[]}}},{enabled:!(null==n||null===(r=n.fieldsMapping)||void 0===r||!r.title)}).data,o=a((function(){if(i)return i.map((function(e){var t;return{id:e.id,label:e[null==n||null===(t=n.fieldsMapping)||void 0===t?void 0:t.title]}}))}),[i]);return{items:a((function(){if(o)return function(e){var t=e.query;return o.filter((function(e){return e.label.toLowerCase().startsWith(t.toLowerCase())})).slice(0,5)}}),[o]),render:qr}};export{kr as ACTIVITY_TYPES,xr as ACTOR_TYPES,zr as CollectionList,Pr as CommentsField,Lr as OBJECT_TYPES,jr as PUBLIC_URI,Dr as ReferenceCollectionField,Nr as useCollection,Ur as useInbox,Wr as useMentions,Tr as useOutbox,Br as useWebfinger};
//# sourceMappingURL=index.es.js.map
