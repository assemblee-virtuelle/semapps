"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("react-admin"),r=require("@material-ui/core"),n=require("@material-ui/icons/AddCircle"),a=require("@material-ui/icons/Launch"),l=require("@semapps/semantic-data-provider"),o=require("react-masonry-css"),i=require("react-redux"),u=require("@mui/lab"),c=require("ra-core"),s=require("@mui/icons-material/Cancel"),d=require("@mui/icons-material/Label"),f=require("@mui/material"),p=require("@mui/icons-material/ExpandMore"),m=require("@mui/icons-material/ChevronRight"),b=require("@mui/material/Typography"),h=require("react-router");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var E=y(e),g=v(e),k=y(n),C=y(a),x=y(o),P=y(s),w=y(d),O=y(p),L=y(m),j=y(b);function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(){return(T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function F(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,l=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(i)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var V=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],A=r.makeStyles((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:-2,left:-2},launchIcon:{width:16,paddingRight:6,marginLeft:-10}}})),D=function(e){return e.stopPropagation()},M=function(){},_=function(e){return e.stopPropagation()},B=function(){},G=function(e){var n=e.children,a=e.linkType,o=e.externalLinks,i=e.spacing,u=e.xs,c=e.sm,s=e.md,d=e.lg,f=e.xl,p=t.useListContext(),m=p.ids,b=p.data,h=p.basePath,y=l.useGetExternalLink(o);return g.createElement(r.Grid,{container:!0,spacing:i},m.map((function(e){if(!b[e]||b[e]._error)return null;var l,o=y(b[e]);return l=o?g.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",onClick:_},g.cloneElement(g.Children.only(n),{record:b[e],basePath:n.props.basePath||h,externalLink:!0,onClick:B})):a?g.createElement(t.Link,{to:t.linkToRecord(h,e,a),onClick:_},g.cloneElement(g.Children.only(n),{record:b[e],basePath:n.props.basePath||h,onClick:B})):g.cloneElement(g.Children.only(n),{record:b[e],basePath:n.props.basePath||h}),g.createElement(r.Grid,{item:!0,key:e,xs:u,sm:c,md:s,lg:d,xl:f},g.createElement(t.RecordContextProvider,{value:b[e],key:e},l))})))};G.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var U=r.makeStyles((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),W=function(e){var n=e.image,a=e.content,l=e.actions,o=e.breakpointCols,i=e.linkType,u=U(),c=t.useListContext(),s=c.ids,d=c.data,f=c.basePath;return E.default.createElement(x.default,{breakpointCols:o,className:u.grid,columnClassName:u.column},s.map((function(e){if(!d[e]||d[e]._error)return null;var o="function"==typeof n?n(d[e]):n;return E.default.createElement(r.Card,{key:e,className:u.card},E.default.createElement(t.Link,{to:t.linkToRecord(f,e)+"/"+i},E.default.createElement(r.CardActionArea,null,o&&E.default.createElement(r.CardMedia,{className:u.media,image:o}),a&&E.default.createElement(r.CardContent,null,a(d[e])))),l&&E.default.createElement(r.CardActions,null,l.map((function(t){return E.default.createElement(t,{record:d[e],basePath:f})}))))})))};W.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var z=function(e){var r=e.source,n=e.id,a=t.useResourceContext(),l=t.useGetList(a).data;return E.default.createElement(E.default.Fragment,null," ",E.default.createElement("span",{className:"filter-count"},"("+Object.values(l).filter((function(e){return[].concat(e[r]).includes(n)})).length+")"))},J=function(r){var n=r.reference,a=r.source,o=r.inverseSource,u=r.limit,c=r.sort,s=r.filter,d=r.label,f=r.icon,p=r.showCounters,m=t.useGetList(n,{page:1,perPage:u},c,s),b=m.data,h=m.ids,y=i.useSelector(t.getResources,i.shallowEqual).filter((function(e){return(null==e?void 0:e.name)===n}))[0],v=t.useResourceContext();l.useDataModel(v);var g=l.useContainers(v),k=t.useListContext();k.displayedFilters,k.filterValues;var C=k.setFilters;k.hideFilter,e.useEffect((function(){var e=new URLSearchParams(window.location.search);Object.fromEntries(e.entries()).filter||C({})}),[]);return E.default.createElement(t.FilterList,{label:d||y.options.label,icon:f||E.default.createElement(y.icon)},h.filter((function(e){return function(e){if(!o)return!0;if(!g||!b||!b[e][o])return!1;var t=!1;return Object.values(g).forEach((function(r){r.forEach((function(r){[].concat(b[e][o]).forEach((function(e){e.startsWith(r)&&(t=!0)}))}))})),t}(e)})).map((function(e){return E.default.createElement(t.FilterListItem,{key:e,label:E.default.createElement("span",{className:"filter-label"},b[e]["pair:label"],p&&E.default.createElement(z,{source:a,id:e})),value:S({},a,e)})})))};function Q(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=Q(e[t]))&&(n&&(n+=" "),n+=r);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function $(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=Q(e))&&(n&&(n+=" "),n+=t);return n}J.defaultProps={limit:25,showCounters:!0};var H=E.default.forwardRef((function(e,t){var r,n=e.classes,a=e.className,l=e.label,o=e.nodeId,i=e.icon,c=e.expansionIcon,s=e.displayIcon,d=u.useTreeItem(o),f=d.disabled,p=d.expanded,m=d.selected,b=d.focused,h=d.handleExpansion,y=d.handleSelection,v=d.preventSelection,g=i||c||s;return E.default.createElement("div",{className:$(a,n.root,(r={},S(r,n.expanded,p),S(r,n.selected,m),S(r,n.focused,b),S(r,n.disabled,f),r)),onMouseDown:function(e){v(e)},ref:t},E.default.createElement("div",{onClick:function(e){h(e)},className:n.iconContainer},g),E.default.createElement(j.default,{onClick:function(e){y(e)},component:"div",className:n.label},l))}));function K(e){return E.default.createElement(u.TreeItem,T({ContentComponent:H},e))}var X=function(e){var r=e.reference,n=e.limit,a=e.sort,l=e.filter,o=t.useGetList(r,{page:1,perPage:n},a,l).data,i=c.useListFilterContext(),s=i.filterValues,d=i.setFilters,p=[],m=[],b=!1;for(var h in o)null==o[h]["pair:broader"]&&p.push(o[h]),m=m.concat(o[h]);return console.log(s),null!=s.sparqlWhere&&(b=!0),E.default.createElement("div",null,E.default.createElement(f.IconButton,{size:"small",edge:"start"},E.default.createElement(w.default,{style:{color:"black"}})),"Thèmes",b?E.default.createElement(f.IconButton,{onClick:function(){var e=Object.assign({},s);delete e.sparqlWhere,d(e,null,!1),b=!1},size:"small"},E.default.createElement(P.default,null)):null,E.default.createElement(u.TreeView,{multiSelect:!0,onNodeSelect:function(e,t){var r={type:"bgp",triples:t.map((function(e){return{subject:{termType:"Variable",value:"s1"},predicate:{termType:"NamedNode",value:"http://virtual-assembly.org/ontologies/pair#hasTopic"},object:{termType:"NamedNode",value:e}}}))},n=JSON.stringify(r),a=encodeURIComponent(n);d(N(N({},s),{},{sparqlWhere:a}))},"aria-label":"icon expansion",defaultCollapseIcon:E.default.createElement(O.default,null),defaultExpandIcon:E.default.createElement(L.default,null)},p.map((function(e){return E.default.createElement(K,{nodeId:e.id,label:e["pair:label"],key:e.id},function e(t,r,n){var a=!1;return t.map((function(n){if(null!=n["pair:broader"]&&n["pair:broader"]==r.id)return t.map((function(e){null!=e["pair:broader"]&&e["pair:broader"]==n.id&&(a=!0)})),E.default.createElement(K,{key:n.id,nodeId:n.id,label:n["pair:label"]},a?e(t,n):null)}))}(m,e))}))))};X.defaultProps={limit:25,showCounters:!0};var Y=E.default.createContext({views:null,currentView:null,setView:function(){return null}}),Z=function(){var e=new URLSearchParams(h.useLocation().search),r=E.default.useContext(Y),n=r.views,a=r.currentView,l=r.setView;return n?Object.entries(n).filter((function(e){return R(e,1)[0]!==a})).map((function(r){var n=R(r,2),a=n[0],o=n[1];return e.set("view",a),e.set("page",1),e.set("perPage",o.perPage),o.sort&&(e.set("sort",o.sort.field),e.set("order",o.sort.order)),E.default.createElement(t.Link,{key:a,to:"?"+e.toString()},E.default.createElement(t.Button,{onClick:function(){return l(a)},label:o.label},E.default.createElement(o.icon)))})):null},ee=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],te=function(e){var n=e.bulkActions,a=e.basePath,l=e.currentSort,o=e.displayedFilters,i=e.exporter,u=e.filters,c=e.filterValues,s=e.onUnselectItems,d=e.resource,f=e.selectedIds,p=e.showFilter,m=e.total,b=F(e,ee),h=r.useMediaQuery((function(e){return e.breakpoints.down("xs")})),y=t.useResourceDefinition(b);return E.default.createElement(t.TopToolbar,null,E.default.createElement(Z,null),u&&E.default.cloneElement(u,{resource:d,showFilter:p,displayedFilters:o,filterValues:c,context:"button"}),y.hasCreate&&E.default.createElement(t.CreateButton,{basePath:a}),!h&&!1!==i&&E.default.createElement(t.ExportButton,{disabled:0===m,resource:d,sort:l,filter:c,exporter:i}),n&&E.default.cloneElement(n,{basePath:a,filterValues:c,resource:d,selectedIds:f,onUnselectItems:s}))},re=["children","actions","views","ListComponent"],ne=function(t){t.children;var r=t.actions,n=t.views,a=t.ListComponent,l=F(t,re),o=new URLSearchParams(h.useLocation().search),i=o.has("view")?o.get("view"):Object.keys(n)[0],u=R(e.useState(i),2),c=u[0],s=u[1];return E.default.createElement(Y.Provider,{value:{views:n,currentView:c,setView:s}},E.default.createElement(a,T({actions:r,pagination:n[c].pagination,perPage:n[i].perPage,sort:n[i].sort},l),n[c].list))};ne.defaultProps={actions:E.default.createElement(te,null),ListComponent:t.List},exports.ChipList=function(e){e.classes,e.className,e.children;var n=e.linkType,a=void 0===n?"edit":n,o=e.component,i=void 0===o?"div":o,u=e.primaryText,c=e.appendLink,s=e.externalLinks,d=void 0!==s&&s,f=F(e,V),p=t.useListContext(e),m=p.ids,b=p.data,h=p.loaded,y=p.basePath,v=t.useResourceContext(e),g=l.useGetExternalLink(d),x=A(e),P=i;return!1===h?E.default.createElement(r.LinearProgress,null):E.default.createElement(P,T({className:x.root},t.sanitizeListRestProps(f)),m.map((function(e){if(!b[e]||b[e]._error)return null;var r=g(b[e]);return r?E.default.createElement(t.RecordContextProvider,{value:b[e],key:e},E.default.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:x.link,onClick:D},E.default.createElement(t.ChipField,{record:b[e],resource:v,basePath:y,source:u,className:x.chipField,color:"secondary",deleteIcon:E.default.createElement(C.default,{className:x.launchIcon}),onClick:M,onDelete:M}))):a?E.default.createElement(t.RecordContextProvider,{value:b[e],key:e},E.default.createElement(t.Link,{className:x.link,to:t.linkToRecord(y,e,a),onClick:D},E.default.createElement(t.ChipField,{record:b[e],resource:v,basePath:y,source:u,className:x.chipField,color:"secondary",onClick:M}))):E.default.createElement(t.RecordContextProvider,{value:b[e],key:e},E.default.createElement(t.ChipField,{record:b[e],resource:v,basePath:y,source:u,className:x.chipField,color:"secondary",onClick:M}))})),c&&E.default.createElement(k.default,{color:"primary",className:x.addIcon,onClick:c}))},exports.GridList=G,exports.ListActionsWithViews=te,exports.ListViewContext=Y,exports.MasonryList=W,exports.MultiViewsList=ne,exports.ReferenceFilter=J,exports.ReferenceFilterTree=X,exports.ViewsButtons=Z;
//# sourceMappingURL=index.cjs.js.map
