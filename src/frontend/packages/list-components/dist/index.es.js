import*as e from"react";import t,{useEffect as r,useState as n}from"react";import{useListContext as a,useResourceContext as o,sanitizeListRestProps as l,RecordContextProvider as i,ChipField as c,Link as s,linkToRecord as u,useGetList as m,getResources as f,FilterList as p,FilterListItem as d,Button as b,useResourceDefinition as h,TopToolbar as y,CreateButton as v,ExportButton as g,List as E}from"react-admin";import{makeStyles as k,LinearProgress as P,Grid as w,Card as C,CardActionArea as O,CardMedia as x,CardContent as j,CardActions as N,useMediaQuery as I}from"@material-ui/core";import S from"@material-ui/icons/AddCircle";import L from"@material-ui/icons/Launch";import{useGetExternalLink as T,useDataModel as F,useContainers as V}from"@semapps/semantic-data-provider";import A from"react-masonry-css";import{useSelector as U,shallowEqual as D}from"react-redux";import{TreeView as R,TreeItem as W,useTreeItem as _}from"@mui/lab";import{useListFilterContext as q}from"ra-core";import z from"@mui/icons-material/Cancel";import M from"@mui/icons-material/Label";import{IconButton as B}from"@mui/material";import J from"@mui/icons-material/ExpandMore";import $ from"@mui/icons-material/ChevronRight";import G from"@mui/material/Typography";import{useLocation as H}from"react-router";function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){X(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(){return(Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Z(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],l=!0,i=!1;try{for(r=r.call(e);!(l=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);l=!0);}catch(e){i=!0,a=e}finally{try{l||null==r.return||r.return()}finally{if(i)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return te(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var re=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],ne=k((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:-2,left:-2},launchIcon:{width:16,paddingRight:6,marginLeft:-10}}})),ae=function(e){return e.stopPropagation()},oe=function(){},le=function(e){e.classes,e.className,e.children;var r=e.linkType,n=void 0===r?"edit":r,m=e.component,f=void 0===m?"div":m,p=e.primaryText,d=e.appendLink,b=e.externalLinks,h=void 0!==b&&b,y=Z(e,re),v=a(e),g=v.ids,E=v.data,k=v.loaded,w=v.basePath,C=o(e),O=T(h),x=ne(e),j=f;return!1===k?t.createElement(P,null):t.createElement(j,Y({className:x.root},l(y)),g.map((function(e){if(!E[e]||E[e]._error)return null;var r=O(E[e]);return r?t.createElement(i,{value:E[e],key:e},t.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:x.link,onClick:ae},t.createElement(c,{record:E[e],resource:C,basePath:w,source:p,className:x.chipField,color:"secondary",deleteIcon:t.createElement(L,{className:x.launchIcon}),onClick:oe,onDelete:oe}))):n?t.createElement(i,{value:E[e],key:e},t.createElement(s,{className:x.link,to:u(w,e,n),onClick:ae},t.createElement(c,{record:E[e],resource:C,basePath:w,source:p,className:x.chipField,color:"secondary",onClick:oe}))):t.createElement(i,{value:E[e],key:e},t.createElement(c,{record:E[e],resource:C,basePath:w,source:p,className:x.chipField,color:"secondary",onClick:oe}))})),d&&t.createElement(S,{color:"primary",className:x.addIcon,onClick:d}))},ie=function(e){return e.stopPropagation()},ce=function(){},se=function(t){var r=t.children,n=t.linkType,o=t.externalLinks,l=t.spacing,c=t.xs,m=t.sm,f=t.md,p=t.lg,d=t.xl,b=a(),h=b.ids,y=b.data,v=b.basePath,g=T(o);return e.createElement(w,{container:!0,spacing:l},h.map((function(t){if(!y[t]||y[t]._error)return null;var a,o=g(y[t]);return a=o?e.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",onClick:ie},e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||v,externalLink:!0,onClick:ce})):n?e.createElement(s,{to:u(v,t,n),onClick:ie},e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||v,onClick:ce})):e.cloneElement(e.Children.only(r),{record:y[t],basePath:r.props.basePath||v}),e.createElement(w,{item:!0,key:t,xs:c,sm:m,md:f,lg:p,xl:d},e.createElement(i,{value:y[t],key:t},a))})))};se.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var ue=k((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),me=function(e){var r=e.image,n=e.content,o=e.actions,l=e.breakpointCols,i=e.linkType,c=ue(),m=a(),f=m.ids,p=m.data,d=m.basePath;return t.createElement(A,{breakpointCols:l,className:c.grid,columnClassName:c.column},f.map((function(e){if(!p[e]||p[e]._error)return null;var a="function"==typeof r?r(p[e]):r;return t.createElement(C,{key:e,className:c.card},t.createElement(s,{to:u(d,e)+"/"+i},t.createElement(O,null,a&&t.createElement(x,{className:c.media,image:a}),n&&t.createElement(j,null,n(p[e])))),o&&t.createElement(N,null,o.map((function(r){return t.createElement(r,{record:p[e],basePath:d})}))))})))};me.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var fe=function(e){var r=e.source,n=e.id,a=o(),l=m(a).data;return t.createElement(t.Fragment,null," ",t.createElement("span",{className:"filter-count"},"("+Object.values(l).filter((function(e){return[].concat(e[r]).includes(n)})).length+")"))},pe=function(e){var n=e.reference,l=e.source,i=e.inverseSource,c=e.limit,s=e.sort,u=e.filter,b=e.label,h=e.icon,y=e.showCounters,v=m(n,{page:1,perPage:c},s,u),g=v.data,E=v.ids,k=U(f,D).filter((function(e){return(null==e?void 0:e.name)===n}))[0],P=o();F(P);var w=V(P),C=a();C.displayedFilters,C.filterValues;var O=C.setFilters;C.hideFilter,r((function(){var e=new URLSearchParams(window.location.search);Object.fromEntries(e.entries()).filter||O({})}),[]);return t.createElement(p,{label:b||k.options.label,icon:h||t.createElement(k.icon)},E.filter((function(e){return function(e){if(!i)return!0;if(!w||!g||!g[e][i])return!1;var t=!1;return Object.values(w).forEach((function(r){r.forEach((function(r){[].concat(g[e][i]).forEach((function(e){e.startsWith(r)&&(t=!0)}))}))})),t}(e)})).map((function(e){return t.createElement(d,{key:e,label:t.createElement("span",{className:"filter-label"},g[e]["pair:label"],y&&t.createElement(fe,{source:l,id:e})),value:X({},l,e)})})))};function de(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(r=de(e[t]))&&(n&&(n+=" "),n+=r);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function be(){for(var e,t,r=0,n="";r<arguments.length;)(e=arguments[r++])&&(t=de(e))&&(n&&(n+=" "),n+=t);return n}pe.defaultProps={limit:25,showCounters:!0};var he=t.forwardRef((function(e,r){var n,a=e.classes,o=e.className,l=e.label,i=e.nodeId,c=e.icon,s=e.expansionIcon,u=e.displayIcon,m=_(i),f=m.disabled,p=m.expanded,d=m.selected,b=m.focused,h=m.handleExpansion,y=m.handleSelection,v=m.preventSelection,g=c||s||u;return t.createElement("div",{className:be(o,a.root,(n={},X(n,a.expanded,p),X(n,a.selected,d),X(n,a.focused,b),X(n,a.disabled,f),n)),onMouseDown:function(e){v(e)},ref:r},t.createElement("div",{onClick:function(e){h(e)},className:a.iconContainer},g),t.createElement(G,{onClick:function(e){y(e)},component:"div",className:a.label},l))}));function ye(e){return t.createElement(W,Y({ContentComponent:he},e))}var ve=function(e){var r=e.reference,n=e.source,a=e.label,o=e.limit,l=e.sort,i=e.filter,c=m(r,{page:1,perPage:o},l,i).data,s=q(),u=s.filterValues,f=s.setFilters,p=[],d=[],b=!1;for(var h in c)null==c[h]["pair:broader"]&&p.push(c[h]),d=d.concat(c[h]);return console.log(u),null!=u.sparqlWhere&&(b=!0),t.createElement("div",null,t.createElement(B,{size:"small",edge:"start"},t.createElement(M,{style:{color:"black"}})),"Thèmes",b?t.createElement(B,{onClick:function(){var e=Object.assign({},u);delete e.sparqlWhere,f(e,null,!1),b=!1},size:"small"},t.createElement(z,null)):null,t.createElement(R,{multiSelect:!0,onNodeSelect:function(e,t){var r={type:"bgp",triples:t.map((function(e){return{subject:{termType:"Variable",value:"s1"},predicate:{termType:"NamedNode",value:"http://virtual-assembly.org/ontologies/pair#hasTopic"},object:{termType:"NamedNode",value:e}}}))},n=JSON.stringify(r),a=encodeURIComponent(n);f(Q(Q({},u),{},{sparqlWhere:a}))},"aria-label":"icon expansion",defaultCollapseIcon:t.createElement(J,null),defaultExpandIcon:t.createElement($,null)},p.map((function(e){return t.createElement(ye,{nodeId:e.id,label:e[a],key:e.id},function e(r,n,a,o){var l=!1;return a.map((function(i){if(null!=i&&i[r]==o.id)return a.map((function(e){null!=e[r]&&e[r]==i.id&&(l=!0)})),t.createElement(ye,{key:i.id,nodeId:i.id,label:i[n]},l?e(r,n,a,i):null)}))}(n,a,d,e))}))))};ve.defaultProps={limit:25,showCounters:!0};var ge=t.createContext({views:null,currentView:null,setView:function(){return null}}),Ee=function(){var e=new URLSearchParams(H().search),r=t.useContext(ge),n=r.views,a=r.currentView,o=r.setView;return n?Object.entries(n).filter((function(e){return ee(e,1)[0]!==a})).map((function(r){var n=ee(r,2),a=n[0],l=n[1];return e.set("view",a),e.set("page",1),e.set("perPage",l.perPage),l.sort&&(e.set("sort",l.sort.field),e.set("order",l.sort.order)),t.createElement(s,{key:a,to:"?"+e.toString()},t.createElement(b,{onClick:function(){return o(a)},label:l.label},t.createElement(l.icon)))})):null},ke=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],Pe=function(e){var r=e.bulkActions,n=e.basePath,a=e.currentSort,o=e.displayedFilters,l=e.exporter,i=e.filters,c=e.filterValues,s=e.onUnselectItems,u=e.resource,m=e.selectedIds,f=e.showFilter,p=e.total,d=Z(e,ke),b=I((function(e){return e.breakpoints.down("xs")})),E=h(d);return t.createElement(y,null,t.createElement(Ee,null),i&&t.cloneElement(i,{resource:u,showFilter:f,displayedFilters:o,filterValues:c,context:"button"}),E.hasCreate&&t.createElement(v,{basePath:n}),!b&&!1!==l&&t.createElement(g,{disabled:0===p,resource:u,sort:a,filter:c,exporter:l}),r&&t.cloneElement(r,{basePath:n,filterValues:c,resource:u,selectedIds:m,onUnselectItems:s}))},we=["children","actions","views","ListComponent"],Ce=function(e){e.children;var r=e.actions,a=e.views,o=e.ListComponent,l=Z(e,we),i=new URLSearchParams(H().search),c=i.has("view")?i.get("view"):Object.keys(a)[0],s=ee(n(c),2),u=s[0],m=s[1];return t.createElement(ge.Provider,{value:{views:a,currentView:u,setView:m}},t.createElement(o,Y({actions:r,pagination:a[u].pagination,perPage:a[c].perPage,sort:a[c].sort},l),a[u].list))};Ce.defaultProps={actions:t.createElement(Pe,null),ListComponent:E};export{le as ChipList,se as GridList,Pe as ListActionsWithViews,ge as ListViewContext,me as MasonryList,Ce as MultiViewsList,pe as ReferenceFilter,ve as ReferenceFilterTree,Ee as ViewsButtons};
//# sourceMappingURL=index.es.js.map
