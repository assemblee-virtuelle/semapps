import e,{useEffect as t,createElement as r,cloneElement as n,Children as a,useState as o}from"react";import{getResources as l,Notification as i,TopToolbar as c,ListButton as s,Create as u,ShowButton as m,Edit as d,useResourceDefinition as p,CreateButton as f,ExportButton as h,RefreshButton as b,List as E,Pagination as g,SimpleList as v,useGetList as y,FilterList as P,FilterListItem as w,useTranslate as x,getFieldLabelTranslationArgs as k,useListContext as S,linkToRecord as L,ImageField as N,EditButton as C,Show as I,sanitizeListRestProps as T,Link as B,useCreate as O,useNotify as R,ReferenceInput as j,Button as A,FormWithRedirect as W,TextInput as F,required as U,SaveButton as V}from"react-admin";import{Grid as M,Button as H,TextField as z,Select as G,MenuItem as _,makeStyles as D,Box as q,Container as $,Hidden as J,useMediaQuery as K,ThemeProvider as Q,createMuiTheme as X,Tabs as Y,Tab as Z,Typography as ee,CircularProgress as te,LinearProgress as re,Dialog as ne,DialogTitle as ae,DialogContent as oe,DialogActions as le}from"@material-ui/core";import{useHistory as ie,useLocation as ce,Link as se}from"react-router-dom";import{Form as ue,Field as me,useForm as de}from"react-final-form";import{useSelector as pe,shallowEqual as fe}from"react-redux";import{useHistory as he,useLocation as be}from"react-router";import{createMuiTheme as Ee,ThemeProvider as ge,makeStyles as ve}from"@material-ui/core/styles";import ye from"react-markdown";import Pe from"classnames";import we from"@material-ui/icons/Add";import xe from"@material-ui/icons/Cancel";function ke(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function Se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Le(){return(Le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ne(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}(e,t)||Te(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ie(e){return function(e){if(Array.isArray(e))return Be(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Te(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Te(e,t){if(e){if("string"==typeof e)return Be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Be(e,t):void 0}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Oe=function(t){var r=t.input,n=Ne(t,["input"]);return e.createElement(z,Le({},r,n))},Re=function(t){var r=t.input,n=Ne(t,["input"]),a=pe(l,fe);return e.createElement(G,Le({},r,n),a.filter((function(e){return e.hasList})).map((function(t){return e.createElement(_,{value:t.name,key:t.name},t.options.label)})))},je=function(){var t=ie(),r=ce().pathname.match(/^\/([^/]+)/),n=r?r[1]:"Organization";return e.createElement(ue,{onSubmit:function(e){var r=e.filter,n=e.type;r?t.push("/".concat(n,"?filter=").concat(encodeURIComponent('{"q": "'.concat(r,'"}')))):t.push("/".concat(n))},initialValues:{type:n},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r},e.createElement(M,{container:!0,spacing:2},e.createElement(M,{item:!0,xs:5},e.createElement(me,{name:"filter",component:Oe,placeholder:"Rechercher...",fullWidth:!0})),e.createElement(M,{item:!0,xs:5},e.createElement(me,{name:"type",component:Re,fullWidth:!0})),e.createElement(M,{item:!0,xs:2},e.createElement(H,{variant:"outlined",type:"submit",fullWidth:!0},"Hop"))))}})},Ae=D((function(e){return{header:{position:"relative",height:65},logo:Se({position:"absolute",top:-15,height:110,width:110},e.breakpoints.down("xs"),{position:"relative",top:0,width:65,height:65})}})),We=function(t){var r=t.userMenu,n=t.logout,a=Ae();return e.createElement(q,{bgcolor:"primary.main"},e.createElement($,{maxWidth:"lg",className:a.header},e.createElement(M,{container:!0},e.createElement(M,{item:!0,xs:12,sm:r?3:6},e.createElement(se,{to:"/"},e.createElement("img",{src:process.env.PUBLIC_URL+"/logo192.png",alt:"SemApps",className:a.logo}))),e.createElement(J,{xsDown:!0},e.createElement(M,{item:!0,sm:6},e.createElement(q,{pt:2},e.createElement(je,null)))),r&&e.createElement(M,{item:!0,sm:3,align:"right"},e.createElement(q,{pt:2},e.cloneElement(r,{logout:n}))))))},Fe=function(){var e=ce().pathname;return t((function(){window.scrollTo(0,0)}),[e]),null},Ue=function(t){var r=t.appBar,n=t.logout,a=t.theme,o=t.children,l=K(a.breakpoints.down("xs"));return e.createElement(Q,{theme:a},e.createElement(Fe,null),e.cloneElement(r,{logout:n}),e.createElement($,{maxWidth:"lg",disableGutters:l},e.createElement(q,{mb:{xs:0,sm:5}},o)),e.createElement(i,null))};Ue.defaultProps={appBar:e.createElement(We,null)};var Ve=X(),Me=X({palette:{primary:{main:"#28ccfb"},secondary:{main:"#bcef5b"},grey:{main:"#e0e0e0"}},typography:{details:{fontSize:8}},overrides:{RaChipField:{chip:{marginLeft:0,marginTop:0,marginRight:8,marginBottom:8}},RaShow:{card:Se({padding:25},Ve.breakpoints.down("xs"),{padding:15})},RaList:{content:Se({padding:25},Ve.breakpoints.down("xs"),{padding:15})},RaListToolbar:{toolbar:Se({},Ve.breakpoints.down("xs"),{height:0,minHeight:0})},RaSingleFieldList:{root:{marginTop:0,marginBottom:0}},MuiTab:{labelIcon:{paddingTop:0}}}}),He=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=Ne(t,["basePath","className","data","hasList"]);return e.createElement(c,Le({className:n},l),o&&e.createElement(s,{basePath:r,record:a}))},ze=function(t){return e.createElement(u,Le({actions:e.createElement(He,null),redirect:"show"},t))},Ge=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasShow,i=Ne(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(c,Le({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(m,{basePath:r,record:a}))},_e=function(t){return e.createElement(d,Le({actions:e.createElement(Ge,null)},t))},De=D((function(e){return{tab:{minWidth:55}}})),qe=function(){var t=he(),r=De(),n=be().pathname.match(/^\/([^/]+)/),a=n?n[1]:null,o=pe(l,fe),i=K((function(e){return e.breakpoints.down("xs")}));return e.createElement(Y,{value:a,onChange:function(e,r){return t.push("/"+r)},indicatorColor:"primary",textColor:"primary",scrollButtons:"auto"},o.filter((function(e){return e.hasList})).map((function(t){return e.createElement(Z,{key:t.name,icon:e.createElement(t.icon),label:i?void 0:t.options.label,value:t.name,className:r.tab})})))},$e=function(t){var r=t.bulkActions,n=t.basePath,a=t.currentSort,o=t.displayedFilters,l=t.exporter,i=t.filters,s=t.filterValues,u=t.onUnselectItems,m=t.resource,d=t.selectedIds,E=t.showFilter,g=t.total,v=K((function(e){return e.breakpoints.down("xs")})),y=p();return e.createElement(c,null,r&&e.cloneElement(r,{basePath:n,filterValues:s,resource:m,selectedIds:d,onUnselectItems:u}),i&&e.cloneElement(i,{resource:m,showFilter:E,displayedFilters:o,filterValues:s,context:"button"}),y.hasCreate&&e.createElement(f,{basePath:n}),!v&&e.createElement(h,{disabled:0===g,resource:m,sort:a,filter:s,exporter:l}),!v&&e.createElement(b,null))},Je=function(t){return e.createElement(g,Le({rowsPerPageOptions:[25,50,100]},t))},Ke=function(t){var r=t.children,n=Ne(t,["children"]);return e.createElement(E,Le({actions:e.createElement($e,null),sort:{field:"pair:label",order:"DESC"},pagination:e.createElement(Je,null),perPage:50},n),e.createElement(e.Fragment,null,e.createElement(qe,null),r))},Qe=Ee({overrides:{MuiListItem:{root:{padding:15,paddingBottom:15,paddingTop:15,marginBottom:10,borderStyle:"solid",borderColor:"#e0e0e0",borderWidth:1}}}}),Xe=function(t){return e.createElement(ge,{theme:Qe},e.createElement(v,t))},Ye=function(t){var r=t.reference,n=t.source,a=t.limit,o=t.label,i=t.icon,c=y(r,{page:1,perPage:a},{},{}),s=c.data,u=c.ids,m=pe(l,fe).filter((function(e){return(null==e?void 0:e.name)===r}))[0];return e.createElement(P,{label:o||m.options.label,icon:i||e.createElement(m.icon)},u.map((function(t){return e.createElement(w,{key:t,label:s[t]["pair:label"],value:Se({},n,t)})})))};Ye.defaultProps={limit:20};var Ze=D((function(){return{rightLabel:{color:"grey",textAlign:"right",borderBottom:"1px dashed #c0c0c0",paddingBottom:10,marginBottom:10}}})),et=function(t){var r=t.label,n=t.children,a=t.record,o=t.resource,l=t.source,i=t.basePath,c=Ze(),s=x();return a[l]?e.createElement(q,{mb:4},e.createElement(q,{className:c.rightLabel},s.apply(void 0,Ie(k({label:r,resource:o,source:l})))),e.createElement(q,{m:0},e.cloneElement(n,{record:a,resource:o,basePath:i}))):null},tt=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.showLabel,i=Ne(t,["basePath","children","record","resource","showLabel"]);return e.createElement(M,Le({item:!0},i),e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel&&l?e.createElement(et,{record:a,resource:o,basePath:r,label:t.props.label,source:t.props.source,disabled:!1},t):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},rt=D((function(){return{root:{flexGrow:1}}})),nt=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=rt();return e.createElement("div",{className:l.root},e.createElement(M,{container:!0,spacing:5},e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.cloneElement(t,{resource:o,record:a,basePath:r}):null}))))},at=function(e){return e.stopPropagation()},ot=function(){},lt=function(e){var t=e.children,o=e.xs,l=e.linkType,i=S(),c=i.ids,s=i.data,u=i.basePath;return r(M,{container:!0,spacing:3},c.map((function(e){return r(M,{item:!0,xs:o,key:e},r(se,{to:L(u,e,l),onClick:at},n(a.only(t),{record:s[e],basePath:u,onClick:ot})))})))};lt.defaultProps={xs:6,linkType:"edit"};var it=D((function(){return{line:{borderBottom:"1px solid #e0e0e0",marginTop:-6,marginBottom:7}}})),ct=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=it(),i=x();return e.createElement(q,null,e.Children.map(n,(function(t){return t&&a[t.props.source]&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel?e.createElement(M,{container:!0,spacing:3,className:l.line},e.createElement(M,{item:!0,xs:3},e.createElement(ee,{color:"textSecondary",align:"right",variant:"body2"},i.apply(void 0,Ie(k({label:t.props.label,resource:o,source:t.props.source}))))),e.createElement(M,{item:!0,xs:9},e.createElement(ee,{variant:"body2"},e.cloneElement(t,{record:a,resource:o,basePath:r})))):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},st=D((function(){return{loader:{width:"100%",backgroundColor:"#e0e0e0",paddingTop:100,paddingBottom:100},image:{width:"100%",maxHeight:"none"}}})),ut=function(t){var r=t.record,n=t.source,a=t.defaultImage,o=Ne(t,["record","source","defaultImage"]),l=st();if(r[n]){if(r[n].rawFile instanceof File)return e.createElement(q,{align:"center",className:l.loader},e.createElement(te,null))}else r[n]=a;return e.createElement(N,Le({record:r,source:n,classes:{image:l.image}},o))},mt=D((function(){return{root:{flexGrow:1}}})),dt=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.image,i=t.defaultImage,c=mt();return e.createElement("div",{className:c.root},e.createElement(ee,{variant:"h3",color:"primary",component:"h1",id:"react-admin-title"}),e.createElement(M,{container:!0,spacing:5},e.createElement(M,{item:!0,xs:12,sm:5},e.createElement(ut,{record:a,source:l,defaultImage:i})),e.createElement(M,{item:!0,xs:12,sm:7},e.createElement(ct,{record:a,resource:o,basePath:r},n))))};dt.defaultProps={defaultImage:process.env.PUBLIC_URL+"/logo192.png"};var pt=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasEdit,i=Ne(t,["basePath","className","data","hasList","hasEdit"]);return e.createElement(c,Le({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(C,{basePath:r,record:a}))},ft=function(t){return e.createElement(I,Le({actions:e.createElement(pt,null)},t))},ht=D((function(){return{parent:{position:"relative"},image:{width:"100%",borderRadius:"50%"},child:{position:"absolute",bottom:0,left:0,right:0,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},caption:{color:"black",fontSize:13}}})),bt=function(t){var r=t.record,n=ht(),a=r?r["pair:firstName"]+" "+r["pair:lastName"]:"";return e.createElement(q,{className:n.parent},e.createElement("img",{src:r&&r.image||process.env.PUBLIC_URL+"/unknown-user.png",className:n.image,alt:a}),e.createElement(q,{bgcolor:"secondary.main",className:n.child,borderRadius:7},e.createElement(ee,{align:"center",className:n.caption,noWrap:!0},a)))},Et=function(t){var r=t.source,n=t.record;return n&&n[r]?e.createElement(ye,{source:n[r]}):null},gt=ve((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{}}})),vt=function(e){return e.stopPropagation()},yt=function(){},Pt=function(e){e.classes;var t=e.className,o=e.children,l=e.linkType,i=void 0===l?"edit":l,c=e.separator,s=void 0===c?",":c,u=Ne(e,["classes","className","children","linkType","separator"]),m=S(e),d=m.ids,p=m.data,f=m.loaded,h=m.resource,b=m.basePath,E=gt(e);return!1===f?r(re,null):r("div",Le({className:Pe(E.root,t)},T(u)),d.map((function(e,t){var l=!!i&&L(b,e,i);return l?r("span",{key:e},r(B,{classes:E.link,to:l,onClick:vt},n(a.only(o),{record:p[e],resource:h,basePath:b,onClick:yt})),t<d.length-1&&s+"Â "):n(a.only(o),{key:e,record:p[e],resource:h,basePath:b})})))},wt=D({root:{display:"flex",alignItems:"center"}}),xt=function(t){var r=t.label,n=t.reference,a=t.source,l=t.children,i=wt(),c=Ce(o(!1),2),s=c[0],u=c[1],m=Ce(O(n),2),d=m[0],p=m[1].loading,f=x(),h=R(),b=de(),E=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d({payload:{data:t}},{onSuccess:function(e){var t=e.data;u(!1),b.change(a,t["@id"])},onFailure:function(e){var t=e.error;h(t.message,"error")}});case 1:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){ke(o,n,a,l,i,"next",e)}function i(e){ke(o,n,a,l,i,"throw",e)}l(void 0)}))});return function(e){return t.apply(this,arguments)}}();return e.createElement("div",{className:i.root},e.createElement(j,{label:r,reference:n,source:a},l),e.createElement(A,{onClick:function(){return u(!0)},label:"ra.action.create"},e.createElement(we,null)),e.createElement(ne,{fullWidth:!0,open:s,onClose:function(){return u(!1)}},e.createElement(ae,null,f("ra.action.create")),e.createElement(W,{resource:n,save:E,render:function(t){var r=t.handleSubmitWithRedirect,n=t.pristine,a=t.saving;return e.createElement(e.Fragment,null,e.createElement(oe,null,e.createElement(F,{label:"Titre",source:"pair:label",validate:U(),fullWidth:!0})),e.createElement(le,null,e.createElement(A,{label:"ra.action.cancel",onClick:function(){return u(!1)},disabled:p},e.createElement(xe,null)),e.createElement(V,{handleSubmitWithRedirect:r,pristine:n,saving:a,disabled:p})))}})))};export{We as AppBar,tt as Column,nt as ColumnShowLayout,ze as Create,He as CreateActions,_e as Edit,Ge as EditActions,lt as GridList,dt as Hero,Ue as Layout,Ke as List,Et as MarkdownField,Ye as ReferenceFilter,xt as ReferenceQuickCreateInput,qe as ResourceTabs,Pt as SeparatedListField,ft as Show,pt as ShowActions,Xe as SimpleList,bt as UserIcon,Me as theme};
