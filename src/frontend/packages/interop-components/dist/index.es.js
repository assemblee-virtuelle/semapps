import e,{useState as t,useMemo as r,useEffect as n,useCallback as a}from"react";import{Form as o}from"react-final-form";import{useLocale as i,useTranslate as s,useNotify as l,useInput as c,FieldTitle as u,useCreateSuggestionContext as f,useResourceContext as p,useCreate as m,useDataProvider as b,useRedirect as d,FormInput as h,TextInput as g,RadioButtonGroupInput as v,SimpleForm as y,required as x}from"react-admin";import{makeStyles as w,TextField as E,Grid as O,Typography as j,Dialog as S,DialogContent as k,DialogActions as P,Button as A,Box as C,Toolbar as R,useMediaQuery as T,Tabs as U,Tab as I,Divider as F}from"@material-ui/core";import W from"@material-ui/lab/Autocomplete";import L from"@material-ui/icons/Language";import D from"@material-ui/icons/Add";import N from"final-form-calculate";import $ from"@material-ui/icons/SaveAlt";import{useContainers as B,useDataModel as M}from"@semapps/semantic-data-provider";import{ReferenceInput as V,MultiServerAutocompleteInput as q}from"@semapps/input-components";import z from"@material-ui/icons/Save";import _ from"@material-ui/icons/StarBorder";function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){H(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Y(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function Z(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Y(o,n,a,i,s,"next",e)}function s(e){Y(o,n,a,i,s,"throw",e)}i(void 0)}))}}function H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Q(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,s=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return o}(e,t)||te(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||te(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){if(e){if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ne="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ae(e,t){return e(t={exports:{}},t.exports),t.exports}var oe=ae((function(e){
// @license MIT
!function(t,r){e.exports?e.exports=r():this.Diacritics=r()}(0,(function(){for(var e={map:{}},t=[{base:" ",letters:" "},{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"Th",letters:"Þ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"ff",letters:"ﬀ"},{base:"fi",letters:"ﬁ"},{base:"fl",letters:"ﬂ"},{base:"ffi",letters:"ﬃ"},{base:"ffl",letters:"ﬄ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nñnⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"߀oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oe",letters:"Œœ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"ss",letters:"ß"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"th",letters:"þ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],r=0,n=t.length;r<n;r++)for(var a=t[r].letters.split(""),o=0,i=a.length;o<i;o++)e.map[a[o]]=t[r].base;return e.clean=function(t){if(!t||!t.length||t.length<1)return"";for(var r,n="",a=t.split(""),o=0,i=a.length;o<i;o++)n+=(r=a[o])in e.map?e.map[r]:r;return n},e}))})).clean,ie=/[.*+?^${}()|[\]\\]/g,se=/[a-z0-9_]/i,le=/\s+/;var ce=function(e,t,r){var n,a;return a={insideWords:!1,findAllOccurrences:!1,requireMatchAll:!1},n=(n=r)||{},Object.keys(n).forEach((function(e){a[e]=!!n[e]})),r=a,e=oe(e),(t=oe(t)).trim().split(le).filter((function(e){return e.length>0})).reduce((function(t,n){var a,o,i=n.length,s=!r.insideWords&&se.test(n[0])?"\\b":"",l=new RegExp(s+n.replace(ie,"\\$&"),"i");if(a=l.exec(e),r.requireMatchAll&&null===a)return e="",[];for(;a&&(o=a.index,t.push([o,o+i]),e=e.slice(0,o)+new Array(i+1).join(" ")+e.slice(o+i),r.findAllOccurrences);)a=l.exec(e);return t}),[]).sort((function(e,t){return e[0]-t[0]}))},ue=/^\s+|\s+$/g,fe=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,me=/^0o[0-7]+$/i,be=parseInt,de="object"==typeof ne&&ne&&ne.Object===Object&&ne,he="object"==typeof self&&self&&self.Object===Object&&self,ge=de||he||Function("return this")(),ve=Object.prototype.toString,ye=Math.max,xe=Math.min,we=function(){return ge.Date.now()};function Ee(e,t,r){var n,a,o,i,s,l,c=0,u=!1,f=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var r=n,o=a;return n=a=void 0,c=t,i=e.apply(o,r)}function b(e){return c=e,s=setTimeout(h,t),u?m(e):i}function d(e){var r=e-l;return void 0===l||r>=t||r<0||f&&e-c>=o}function h(){var e=we();if(d(e))return g(e);s=setTimeout(h,function(e){var r=t-(e-l);return f?xe(r,o-(e-c)):r}(e))}function g(e){return s=void 0,p&&n?m(e):(n=a=void 0,i)}function v(){var e=we(),r=d(e);if(n=arguments,a=this,l=e,r){if(void 0===s)return b(l);if(f)return s=setTimeout(h,t),m(l)}return void 0===s&&(s=setTimeout(h,t)),i}return t=je(t)||0,Oe(r)&&(u=!!r.leading,o=(f="maxWait"in r)?ye(je(r.maxWait)||0,t):o,p="trailing"in r?!!r.trailing:p),v.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=l=a=s=void 0},v.flush=function(){return void 0===s?i:g(we())},v}function Oe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function je(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==ve.call(e)}(e))return NaN;if(Oe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Oe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ue,"");var r=pe.test(e);return r||me.test(e)?be(e.slice(2),r?2:8):fe.test(e)?NaN:+e}var Se=function(e,t,r){var n=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Oe(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),Ee(e,t,{leading:n,maxWait:t,trailing:a})},ke=["fetchLexicon","resource","source","initialValue","label","parse","optionText","helperText"],Pe=w((function(e){return{icon:{color:e.palette.text.secondary,marginRight:e.spacing(2)}}})),Ae=function(e,t){return"string"==typeof e?e:e.label?e.label:"string"==typeof t?e[t]:"function"==typeof t?t(e):void 0},Ce=function(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)},Re=function(a){var o=a.fetchLexicon,f=a.resource,p=a.source,m=a.initialValue,b=a.label,d=a.parse,h=a.optionText;a.helperText;var g=Q(a,ke),v=Pe(),y=i(),x=s(),w=l(),S=c(J({source:p,initialValue:m},g)),k=S.input,P=k.value,A=k.onChange,C=k.onBlur,R=k.onFocus,T=S.isRequired,U=S.meta,I=U.error,F=U.submitError,N=U.touched,$=X(t(m),2),B=$[0],M=$[1],V=X(t([]),2),q=V[0],z=V[1],_=r((function(){return Se((function(e,t){o({keyword:e,locale:y}).then((function(e){return t(e)})).catch((function(e){return w(e.message,"error")}))}),200)}),[y,o,w]);return n((function(){B&&_(B,(function(e){return z(e)}))}),[P,B,h,_]),e.createElement(W,{freeSolo:!0,autoComplete:!0,value:P||null,openOnFocus:!!m,options:P?[P].concat(ee(q)):q,filterSelectedOptions:!0,filterOptions:function(e,t){return B&&e.push({label:Ce(B),summary:'Ajouter "'.concat(Ce(B),'" au dictionnaire'),icon:D}),e},clearOnBlur:!0,selectOnFocus:!0,handleHomeEndKeys:!0,getOptionLabel:function(e){return Ae(e,h)},getOptionSelected:function(e,t){return Ae(e,h)===Ae(t,h)},onChange:function(e,t){t&&d&&(t=d(t)),A(t),z([])},onInputChange:function(e,t){return M(t)},noOptionsText:x("ra.navigation.no_results"),renderInput:function(t){return t.inputProps.autoComplete="new-password",e.createElement(E,K({},t,{autoFocus:!0,inputProps:J(J({},t.inputProps),{},{onBlur:function(e){C(e),t.inputProps.onBlur&&t.inputProps.onBlur(e)},onFocus:function(e){R(e),t.inputProps.onFocus&&t.inputProps.onFocus(e)}}),label:""!==b&&!1!==b&&e.createElement(u,{label:b,source:p,resource:f,isRequired:T}),error:!(!N||!I&&!F)},g))},renderOption:function(t){var r=ce(t.label,B),n=function(e,t){var r=[];return 0===t.length?r.push({text:e,highlight:!1}):t[0][0]>0&&r.push({text:e.slice(0,t[0][0]),highlight:!1}),t.forEach((function(n,a){var o=n[0],i=n[1];r.push({text:e.slice(o,i),highlight:!0}),a===t.length-1?i<e.length&&r.push({text:e.slice(i,e.length),highlight:!1}):i<t[a+1][0]&&r.push({text:e.slice(i,t[a+1][0]),highlight:!1})})),r}(t.label,r);return e.createElement(O,{container:!0,alignItems:"center"},e.createElement(O,{item:!0},e.createElement(t.icon||L,{className:v.icon})),e.createElement(O,{item:!0,xs:!0},"string"==typeof n?n:n.map((function(t,r){return e.createElement("span",{key:r,style:{fontWeight:t.highlight?700:400}},t.text)})),e.createElement(j,{variant:"body2",color:"textSecondary"},t.summary)))}})};Re.defaultProps={variant:"filled",margin:"dense"};var Te=function(r){var n=r.fetchLexicon,i=r.selectData,s=f(),l=s.filter,c=s.onCancel,u=s.onCreate,b=p(),d=X(t(l||""),2),h=d[0],g=d[1],v=X(m(b),1)[0],y=a((function(e){var t=e.lexicon;t.uri||delete t.summary,v({payload:{data:i(t)}},{onSuccess:function(e){var t=e.data;g(""),u(t)}})}),[v,u,i]);return e.createElement(S,{open:!0,onClose:c,fullWidth:!0,maxWidth:"sm"},e.createElement(o,{onSubmit:y,render:function(t){var r=t.handleSubmit,a=t.dirtyFields;return e.createElement("form",{onSubmit:r},e.createElement(k,null,e.createElement(Re,{label:"Titre",source:"lexicon",initialValue:h,fetchLexicon:n})),e.createElement(P,null,e.createElement(A,{onClick:c},"Annuler"),e.createElement(A,{variant:"contained",color:"primary",type:"submit",disabled:!a.lexicon},"Ajouter")))}}))},Ue=function(e){var t=b(),r=d(),n=l();return a(function(){var a=Z(regeneratorRuntime.mark((function a(o){var i,s,l,c,u,f,p=arguments;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=p.length>1&&void 0!==p[1]?p[1]:[],a.next=3,t.getOne(e,{id:o});case 3:return s=a.sent,l=s.data,(c=J({},l))["http://www.w3.org/ns/prov#wasDerivedFrom"]=c.id,delete c.id,delete c["@context"],i.forEach((function(e){delete c[e]})),a.next=12,t.create(e,{data:c});case 12:u=a.sent,f=u.data,r("/"+e+"/"+encodeURIComponent(f.id)+"/show"),n("La ressource a bien été copiée",{type:"success"});case 16:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),[e,t,r,n])},Ie=function(e){var t=b(),r=l(),n=d();return a(function(){var a=Z(regeneratorRuntime.mark((function a(o){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.create(e,{id:o});case 2:n("/"+e+"/"+encodeURIComponent(o)+"/show"),r("La ressource a bien été importée",{type:"success"});case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),[t,n,r])},Fe=w((function(e){return{toolbar:{backgroundColor:"light"===e.palette.type?e.palette.grey[100]:e.palette.grey[900],marginTop:e.spacing(2)},field:{marginBottom:23,minWidth:e.spacing(20)}}})),We=N({field:"remoteUri",updates:function(e){return e?{plainUri:e}:{}}},{field:"plainUri",updates:function(e,t,r){return e!==r.remoteUri?{remoteUri:null}:{}}}),Le=function(t){var r=t.basePath,n=t.record,i=t.resource,s=t.stripProperties,l=Fe(),c=B(i,"@remote"),u=M(i),f=Ue(i),p=Ie(i),m=a(function(){var e=Z(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.plainUri,"fork"!==t.method){e.next=6;break}return e.next=4,f(r,s);case 4:e.next=8;break;case 6:return e.next=8,p(r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f,p,s]);return u?e.createElement(o,{onSubmit:m,decorators:[We],initialValues:{method:"sync"},render:function(t){var a,o,s=t.handleSubmit,f=t.dirtyFields;return e.createElement("form",{onSubmit:s},e.createElement(C,{m:"1em"},c&&Object.keys(c).length>0&&e.createElement(h,{input:e.createElement(V,{source:"remoteUri",label:"Rechercher...",reference:i,filter:{_servers:"@remote",_predicates:[null==u||null===(a=u.fieldsMapping)||void 0===a?void 0:a.title]},enableGetChoices:function(e){var t=e.q;return!!(t&&t.length>1)},fullWidth:!0},e.createElement(q,{optionText:null==u||null===(o=u.fieldsMapping)||void 0===o?void 0:o.title,shouldRenderSuggestions:function(e){return e.length>1},resettable:!0})),basePath:r,record:n,resource:i,variant:"filled",margin:"dense"}),e.createElement(h,{input:e.createElement(g,{source:"plainUri",label:"URL de la ressource distante",fullWidth:!0}),basePath:r,record:n,resource:i,variant:"filled",margin:"dense"}),e.createElement(h,{input:e.createElement(v,{source:"method",label:"Méthode d'importation",choices:[{id:"sync",name:"Garder la ressource locale synchronisée avec la ressource distante"},{id:"fork",name:"Créer une nouvelle version de la ressource (fork)"}]}),basePath:r,record:n,resource:i,variant:"filled",margin:"dense"})),e.createElement(R,{className:l.toolbar},e.createElement(A,{type:"submit",startIcon:e.createElement($,null),variant:"contained",color:"primary",disabled:!f.plainUri},"Importer")))}}):null},De=["stripProperties"],Ne=w((function(e){return{tab:{maxWidth:"unset",padding:"6px 24px"}}})),$e=function(r){var n=r.stripProperties,a=Q(r,De),o=X(t(0),2),i=o[0],s=o[1],l=T((function(e){return e.breakpoints.down("xs")}),{noSsr:!0}),c=Ne();return e.createElement(e.Fragment,null,e.createElement(C,{pb:2,fullWidth:!0},e.createElement(U,{value:i,onChange:function(e,t){return s(t)},indicatorColor:"primary"},e.createElement(I,{className:c.tab,label:"Créer"}),e.createElement(I,{className:c.tab,label:l?"Importer":"Importer une ressource distante"})),e.createElement(F,null)),0===i&&e.createElement(y,a),1===i&&e.createElement(Le,K({stripProperties:n||[]},a)))},Be=["resource","fetchLexicon","selectData","redirect","save","saving"],Me=w((function(e){return{toolbar:{backgroundColor:"light"===e.palette.type?e.palette.grey[100]:e.palette.grey[900],marginTop:e.spacing(2)},field:{marginBottom:23,minWidth:e.spacing(20)}}})),Ve=function(t){t.resource;var r=t.fetchLexicon,n=t.selectData,i=t.redirect,s=t.save;t.saving,Q(t,Be);var l=Me(),c=a(function(){var e=Z(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t.lexicon).uri||delete r.summary,"string"==typeof r&&(r={label:r}),e.next=5,s(n(r),i);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,s,i]);return e.createElement(o,{onSubmit:c,render:function(t){var n=t.handleSubmit,a=t.dirtyFields;return e.createElement("form",{onSubmit:n},e.createElement(C,{m:"1em"},e.createElement(Re,{label:"Titre",source:"lexicon",fetchLexicon:r,validate:x()})),e.createElement(R,{className:l.toolbar},e.createElement(A,{type:"submit",startIcon:e.createElement(z,null),variant:"contained",color:"primary",disabled:!a.lexicon},"Créer")))}})},qe=function(e){return e&&e[0].toUpperCase()+e.slice(1)||""},ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://www.wikidata.org/w/api.php";return function(){var t=Z(regeneratorRuntime.mark((function t(r){var n,a,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.keyword,a=r.locale,t.next=3,fetch("".concat(e,"?action=wbsearchentities&format=json&language=").concat(a,"&uselang=").concat(a,"&type=item&limit=10&origin=*&search=").concat(encodeURIComponent(n)));case 3:if(!(o=t.sent).ok){t.next=11;break}return t.next=7,o.json();case 7:return i=t.sent,t.abrupt("return",i.search.map((function(e){return{uri:e.concepturi,label:qe(e.match.text),summary:qe(e.description),icon:L}})));case 11:throw new Error("Failed to fetch Wikidata server");case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},_e=ae((function(e){var t,r;t=ne,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a)throw new TypeError("Url must be a string. Received "+a);""!==a&&(n>0&&(a=a.replace(/^[\/]+/,"")),a=n<e.length-1?a.replace(/[\/]+$/,""):a.replace(/[\/]+$/,"/"),t.push(a))}var o=t.join("/"),i=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),Ge=function(e){return e&&e[0].toUpperCase()+e.slice(1)||""},Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://ec.europa.eu/esco/api",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"skill";return function(){var r=Z(regeneratorRuntime.mark((function r(n){var a,o,i,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.keyword,o=n.locale,r.next=3,fetch(_e(e,"suggest2?text=".concat(encodeURIComponent(a),"&language=").concat(o,"&type=").concat(t,"&isInScheme=&facet=&offset=&limit=&full=&selectedVersion=&viewObsolete=")));case 3:if(!(i=r.sent).ok){r.next=11;break}return r.next=7,i.json();case 7:return s=r.sent,r.abrupt("return",s._embedded.results.map((function(e){return{uri:e.uri,label:Ge(e.title.replace("’","'")),icon:_}})));case 11:throw new Error("Failed to fetch ESCO server");case 12:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()};export{$e as CreateOrImportForm,Le as ImportForm,Re as LexiconAutocompleteInput,Te as LexiconCreateDialog,Ve as LexiconImportForm,Je as fetchESCO,ze as fetchWikidata,Ue as useFork,Ie as useSync};
//# sourceMappingURL=index.es.js.map
