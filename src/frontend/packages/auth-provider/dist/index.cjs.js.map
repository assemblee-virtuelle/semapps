{"version":3,"file":"index.cjs.js","sources":["../node_modules/jwt-decode/build/jwt-decode.esm.js","../node_modules/url-join/lib/url-join.js","../src/utils.js","../src/constants.js","../src/components/PermissionsButton/AddPermissionsForm.js","../src/components/PermissionsButton/AgentIcon.js","../src/components/PermissionsButton/AgentItem.js","../src/components/PermissionsButton/EditPermissionsForm.js","../src/hooks/useAgents.js","../src/components/PermissionsButton/PermissionsDialog.js","../src/components/PermissionsButton/PermissionsButton.js","../src/components/EditWithPermissions/EditActions.js","../src/components/EditWithPermissions/EditToolbarWithPermissions.js","../src/components/ListWithPermissions/ListWithPermissions.js","../src/components/ShowWithPermissions/ShowActions.js","../src/components/LoginPage.js","../src/components/LogoutButton.js","../src/components/UserMenu.js","../src/components/EditWithPermissions/EditWithPermissions.js","../src/components/ResourceWithPermissions.js","../src/components/ShowWithPermissions/ShowWithPermissions.js","../src/authProvider.js","../src/messages/french.js"],"sourcesContent":["function e(e){this.message=e}e.prototype=new Error,e.prototype.name=\"InvalidCharacterError\";var r=\"undefined\"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,\"\");if(t.length%4==1)throw new e(\"'atob' failed: The string to be decoded is not correctly encoded.\");for(var n,o,a=0,i=0,c=\"\";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\".indexOf(o);return c};function t(e){var t=e.replace(/-/g,\"+\").replace(/_/g,\"/\");switch(t.length%4){case 0:break;case 2:t+=\"==\";break;case 3:t+=\"=\";break;default:throw\"Illegal base64url string!\"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t=\"0\"+t),\"%\"+t})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if(\"string\"!=typeof e)throw new n(\"Invalid token specified\");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(\".\")[o]))}catch(e){throw new n(\"Invalid token specified: \"+e.message)}}n.prototype=new Error,n.prototype.name=\"InvalidTokenError\";export default o;export{n as InvalidTokenError};\n//# sourceMappingURL=jwt-decode.esm.js.map\n","(function (name, context, definition) {\n  if (typeof module !== 'undefined' && module.exports) module.exports = definition();\n  else if (typeof define === 'function' && define.amd) define(definition);\n  else context[name] = definition();\n})('urljoin', this, function () {\n\n  function normalize (strArray) {\n    var resultArray = [];\n    if (strArray.length === 0) { return ''; }\n\n    if (typeof strArray[0] !== 'string') {\n      throw new TypeError('Url must be a string. Received ' + strArray[0]);\n    }\n\n    // If the first part is a plain protocol, we combine it with the next part.\n    if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n      var first = strArray.shift();\n      strArray[0] = first + strArray[0];\n    }\n\n    // There must be two or three slashes in the file protocol, two slashes in anything else.\n    if (strArray[0].match(/^file:\\/\\/\\//)) {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1:///');\n    } else {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1://');\n    }\n\n    for (var i = 0; i < strArray.length; i++) {\n      var component = strArray[i];\n\n      if (typeof component !== 'string') {\n        throw new TypeError('Url must be a string. Received ' + component);\n      }\n\n      if (component === '') { continue; }\n\n      if (i > 0) {\n        // Removing the starting slashes for each component but the first.\n        component = component.replace(/^[\\/]+/, '');\n      }\n      if (i < strArray.length - 1) {\n        // Removing the ending slashes for each component but the last.\n        component = component.replace(/[\\/]+$/, '');\n      } else {\n        // For the last component we will combine multiple slashes to a single one.\n        component = component.replace(/[\\/]+$/, '/');\n      }\n\n      resultArray.push(component);\n\n    }\n\n    var str = resultArray.join('/');\n    // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n    // remove trailing slash before parameters or hash\n    str = str.replace(/\\/(\\?|&|#[^!])/g, '$1');\n\n    // replace ? in parameters with &\n    var parts = str.split('?');\n    str = parts.shift() + (parts.length > 0 ? '?': '') + parts.join('&');\n\n    return str;\n  }\n\n  return function () {\n    var input;\n\n    if (typeof arguments[0] === 'object') {\n      input = arguments[0];\n    } else {\n      input = [].slice.call(arguments);\n    }\n\n    return normalize(input);\n  };\n\n});\n","import urlJoin from 'url-join';\n\nexport const defaultToArray = value => (!value ? undefined : Array.isArray(value) ? value : [value]);\n\n// Transform the URI to the one used to find the ACL\n// To be compatible with all servers, we should do a HEAD request to the resource URI\nexport const getAclUri = (middlewareUri, resourceUri) =>\n  urlJoin(middlewareUri, resourceUri.replace(middlewareUri, '_acl/'));\n\nexport const getAclContext = baseUri => ({\n  '@base': baseUri,\n  acl: 'http://www.w3.org/ns/auth/acl#',\n  foaf: 'http://xmlns.com/foaf/0.1/',\n  'acl:agent': { '@type': '@id' },\n  'acl:agentGroup': { '@type': '@id' },\n  'acl:agentClass': { '@type': '@id' },\n  'acl:mode': { '@type': '@id' },\n  'acl:accessTo': { '@type': '@id' }\n});\n","export const ACL_READ = 'acl:Read';\nexport const ACL_APPEND = 'acl:Append';\nexport const ACL_WRITE = 'acl:Write';\nexport const ACL_CONTROL = 'acl:Control';\n\nexport const USER_AGENT = 'acl:agent';\nexport const GROUP_AGENT = 'acl:agentGroup';\nexport const CLASS_AGENT = 'acl:agentClass';\n\nexport const ANONYMOUS_AGENT = 'foaf:Agent';\nexport const AUTHENTICATED_AGENT = 'acl:AuthenticatedAgent';\n\nexport const rightsToList = [ACL_READ, ACL_APPEND, ACL_WRITE, ACL_CONTROL];\nexport const rightsToCreate = [ACL_APPEND, ACL_WRITE, ACL_CONTROL];\nexport const rightsToEdit = [ACL_APPEND, ACL_WRITE, ACL_CONTROL];\nexport const rightsToDelete = [ACL_WRITE, ACL_CONTROL];\nexport const rightsToControl = [ACL_CONTROL];\n\nexport const resourceRightsLabels = {\n  [ACL_READ]: 'auth.right.resource.read',\n  [ACL_APPEND]: 'auth.right.resource.append',\n  [ACL_WRITE]: 'auth.right.resource.write',\n  [ACL_CONTROL]: 'auth.right.resource.control'\n};\n\nexport const containerRightsLabels = {\n  [ACL_READ]: 'auth.right.container.read',\n  [ACL_WRITE]: 'auth.right.container.write',\n  [ACL_CONTROL]: 'auth.right.container.control'\n};\n","import React, { useEffect, useState } from 'react';\nimport { useGetList, useTranslate } from 'react-admin';\nimport { TextField, makeStyles, List, ListItem, ListItemAvatar, ListItemText, Avatar } from '@material-ui/core';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport PersonIcon from '@material-ui/icons/Person';\nimport { USER_AGENT, ACL_READ } from '../../constants';\n\nconst useStyles = makeStyles(() => ({\n  list: {\n    padding: 0,\n    width: '100%'\n  },\n  option: {\n    padding: 0\n  }\n}));\n\nconst AddPermissionsForm = ({ agents, addPermission }) => {\n  const classes = useStyles();\n  const translate = useTranslate();\n  const [value, setValue] = useState(null);\n  const [inputValue, setInputValue] = useState('');\n  const [options, setOptions] = useState([]);\n\n  const { ids, data } = useGetList(\n    'Person',\n    { page: 1, perPage: 100 },\n    { field: 'pair:label', order: 'ASC' },\n    { q: inputValue },\n    { enabled: inputValue.length > 0 }\n  );\n\n  useEffect(() => {\n    setOptions(ids.length > 0 ? Object.values(data) : []);\n  }, [ids, data]);\n\n  return (\n    <Autocomplete\n      classes={{ option: classes.option }}\n      getOptionLabel={option => option['pair:label']}\n      // Do not return agents which have already been added\n      filterOptions={x => x.filter(agent => !Object.keys(agents).includes(agent.id))}\n      options={options}\n      noOptionsText={translate('ra.navigation.no_results')}\n      autoComplete\n      blurOnSelect\n      clearOnBlur\n      disableClearable\n      value={value}\n      onChange={(event, record) => {\n        addPermission(record.id || record['@id'], USER_AGENT, ACL_READ);\n        setValue(null);\n        setInputValue('');\n        setOptions([]);\n      }}\n      onInputChange={(event, newInputValue) => {\n        setInputValue(newInputValue);\n      }}\n      renderInput={params => (\n        <TextField {...params} label={translate('auth.input.agent_select')} variant=\"filled\" margin=\"dense\" fullWidth />\n      )}\n      renderOption={option => (\n        <List dense className={classes.list}>\n          <ListItem button>\n            <ListItemAvatar>\n              <Avatar src={option.image}>\n                <PersonIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary={option['pair:label']} />\n          </ListItem>\n        </List>\n      )}\n    />\n  );\n};\n\nexport default AddPermissionsForm;\n","import React from 'react';\nimport PublicIcon from '@material-ui/icons/Public';\nimport VpnLockIcon from '@material-ui/icons/VpnLock';\nimport PersonIcon from '@material-ui/icons/Person';\nimport GroupIcon from '@material-ui/icons/Group';\nimport { CLASS_AGENT, GROUP_AGENT, USER_AGENT, ANONYMOUS_AGENT } from '../../constants';\n\nconst AgentIcon = ({ agent }) => {\n  switch (agent.predicate) {\n    case CLASS_AGENT:\n      return agent.id === ANONYMOUS_AGENT ? <PublicIcon /> : <VpnLockIcon />;\n    case USER_AGENT:\n      return <PersonIcon />;\n    case GROUP_AGENT:\n      return <GroupIcon />;\n    default:\n      throw new Error('Unknown agent predicate: ' + agent.predicate);\n  }\n};\n\nexport default AgentIcon;\n","import React, { useState, useEffect } from 'react';\nimport { useDataProvider, useTranslate, Loading, Error } from 'react-admin';\nimport {\n  makeStyles,\n  Avatar,\n  ListItem,\n  ListItemIcon,\n  ListItemAvatar,\n  ListItemText,\n  ListItemSecondaryAction,\n  IconButton,\n  Menu,\n  MenuItem\n} from '@material-ui/core';\nimport EditIcon from '@material-ui/icons/Edit';\nimport CheckIcon from '@material-ui/icons/Check';\nimport { GROUP_AGENT, USER_AGENT, ANONYMOUS_AGENT, resourceRightsLabels, containerRightsLabels } from '../../constants';\nimport AgentIcon from './AgentIcon';\n\nconst useStyles = makeStyles(() => ({\n  listItem: {\n    paddingLeft: 4,\n    paddingRight: 36\n  },\n  primaryText: {\n    width: '30%',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis'\n  },\n  secondaryText: {\n    textAlign: 'center',\n    width: '60%',\n    fontStyle: 'italic',\n    color: 'grey'\n  }\n}));\n\nconst AgentItem = ({ isContainer, agent, addPermission, removePermission }) => {\n  const classes = useStyles();\n  const translate = useTranslate();\n  const dataProvider = useDataProvider();\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const [user, setUser] = useState();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState();\n\n  useEffect(() => {\n    if (agent.predicate === USER_AGENT) {\n      dataProvider\n        .getOne('Person', { id: agent.id })\n        .then(({ data }) => {\n          setUser(data);\n          setLoading(false);\n        })\n        .catch(error => {\n          setError(error);\n          setLoading(false);\n        });\n    } else {\n      setLoading(false);\n    }\n  }, [agent.id, agent.predicate]);\n\n  // For now, do not display groups\n  if (agent.predicate === GROUP_AGENT) return null;\n\n  const openMenu = event => setAnchorEl(event.currentTarget);\n  const closeMenu = () => setAnchorEl(null);\n\n  const labels = isContainer ? containerRightsLabels : resourceRightsLabels;\n\n  if (loading) return <Loading />;\n  if (error) return <Error />;\n\n  return (\n    <ListItem className={classes.listItem}>\n      <ListItemAvatar>\n        <Avatar src={user?.image}>\n          <AgentIcon agent={agent} />\n        </Avatar>\n      </ListItemAvatar>\n      <ListItemText\n        className={classes.primaryText}\n        primary={\n          user\n            ? user['pair:label']\n            : translate(agent.id === ANONYMOUS_AGENT ? 'auth.agent.anonymous' : 'auth.agent.authenticated')\n        }\n      />\n      <ListItemText\n        className={classes.secondaryText}\n        primary={agent.permissions && agent.permissions.map(p => translate(labels[p])).join(', ')}\n      />\n      <ListItemSecondaryAction>\n        <IconButton onClick={openMenu}>\n          <EditIcon />\n        </IconButton>\n        <Menu anchorEl={anchorEl} keepMounted open={Boolean(anchorEl)} onClose={closeMenu}>\n          {Object.entries(labels).map(([rightKey, rightLabel]) => {\n            const hasPermission = agent.permissions && agent.permissions.includes(rightKey);\n            return (\n              <MenuItem\n                key={rightKey}\n                onClick={() => {\n                  if (hasPermission) {\n                    removePermission(agent.id, agent.predicate, rightKey);\n                  } else {\n                    addPermission(agent.id, agent.predicate, rightKey);\n                  }\n                  closeMenu();\n                }}\n              >\n                <ListItemIcon>{hasPermission ? <CheckIcon /> : null}</ListItemIcon>\n                <ListItemText primary={translate(rightLabel)} />\n              </MenuItem>\n            );\n          })}\n        </Menu>\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n};\n\nexport default AgentItem;\n","import React from 'react';\nimport { List, makeStyles } from '@material-ui/core';\nimport AgentItem from './AgentItem';\n\nconst useStyles = makeStyles(theme => ({\n  list: {\n    width: '100%',\n    maxWidth: '100%',\n    backgroundColor: theme.palette.background.paper\n  }\n}));\n\nconst EditPermissionsForm = ({ isContainer, agents, addPermission, removePermission }) => {\n  const classes = useStyles();\n  return (\n    <List dense className={classes.list}>\n      {Object.entries(agents).map(([agentId, agent]) => (\n        <AgentItem\n          key={agentId}\n          isContainer={isContainer}\n          agent={agent}\n          addPermission={addPermission}\n          removePermission={removePermission}\n        />\n      ))}\n    </List>\n  );\n};\n\nexport default EditPermissionsForm;\n","import { useEffect, useCallback, useState } from 'react';\nimport { usePermissionsOptimized, useAuthProvider } from 'react-admin';\nimport { defaultToArray } from '../utils';\nimport { CLASS_AGENT, GROUP_AGENT, USER_AGENT, ANONYMOUS_AGENT, AUTHENTICATED_AGENT } from '../constants';\n\nconst useAgents = resourceId => {\n  const { permissions } = usePermissionsOptimized(resourceId);\n  const authProvider = useAuthProvider();\n  const [agents, setAgents] = useState({});\n\n  // Format list of authorized agents, based on the permissions returned for the resource\n  useEffect(() => {\n    let result = {\n      [ANONYMOUS_AGENT]: {\n        id: ANONYMOUS_AGENT,\n        predicate: CLASS_AGENT,\n        permissions: []\n      },\n      [AUTHENTICATED_AGENT]: {\n        id: AUTHENTICATED_AGENT,\n        predicate: CLASS_AGENT,\n        permissions: []\n      }\n    };\n\n    const appendPermission = (agentId, predicate, mode) => {\n      if (result[agentId]) {\n        result[agentId].permissions.push(mode);\n      } else {\n        result[agentId] = {\n          id: agentId,\n          predicate,\n          permissions: [mode]\n        };\n      }\n    };\n\n    if (permissions) {\n      for (let p of permissions) {\n        if (p[CLASS_AGENT]) {\n          defaultToArray(p[CLASS_AGENT]).forEach(agentId => appendPermission(agentId, CLASS_AGENT, p['acl:mode']));\n        }\n        if (p[USER_AGENT]) {\n          defaultToArray(p[USER_AGENT]).forEach(userUri => appendPermission(userUri, USER_AGENT, p['acl:mode']));\n        }\n        if (p[GROUP_AGENT]) {\n          defaultToArray(p[GROUP_AGENT]).forEach(groupUri => appendPermission(groupUri, GROUP_AGENT, p['acl:mode']));\n        }\n      }\n      setAgents(result);\n    }\n  }, [permissions]);\n\n  const addPermission = useCallback(\n    (agentId, predicate, mode) => {\n      const prevAgents = { ...agents };\n      setAgents({\n        ...agents,\n        [agentId]: {\n          id: agentId,\n          predicate,\n          permissions: agents[agentId] ? [...agents[agentId]?.permissions, mode] : [mode]\n        }\n      });\n      authProvider.addPermission(resourceId, agentId, predicate, mode).catch(e => {\n        // If there was an error, revert the optimistic update\n        setAgents(prevAgents);\n      });\n    },\n    [agents, setAgents, resourceId, authProvider]\n  );\n\n  const removePermission = useCallback(\n    (agentId, predicate, mode) => {\n      const prevAgents = { ...agents };\n      setAgents(\n        Object.fromEntries(\n          Object.entries(agents)\n            .map(([key, agent]) => {\n              if (agent.id === agentId) {\n                agent.permissions = agent.permissions.filter(m => m !== mode);\n              }\n              return [key, agent];\n            })\n            // Remove agents if they have no permissions (except if they are class agents)\n            .filter(([_, agent]) => agent.predicate === CLASS_AGENT || agent.permissions.length > 0)\n        )\n      );\n      authProvider.removePermission(resourceId, agentId, predicate, mode).catch(e => {\n        // If there was an error, revert the optimistic update\n        setAgents(prevAgents);\n      });\n    },\n    [agents, setAgents, resourceId, authProvider]\n  );\n\n  return { agents, addPermission, removePermission };\n};\n\nexport default useAgents;\n","import React from 'react';\nimport { Button, useTranslate } from 'react-admin';\nimport { Dialog, DialogTitle, DialogContent, DialogActions, makeStyles } from '@material-ui/core';\nimport AddPermissionsForm from './AddPermissionsForm';\nimport EditPermissionsForm from './EditPermissionsForm';\nimport useAgents from '../../hooks/useAgents';\n\nconst useStyles = makeStyles(() => ({\n  title: {\n    paddingBottom: 8\n  },\n  actions: {\n    padding: 15\n  },\n  addForm: {\n    paddingTop: 0\n  },\n  listForm: {\n    paddingTop: 0,\n    paddingBottom: 0,\n    paddingRight: 0,\n    maxHeight: 210\n  }\n}));\n\nconst PermissionsDialog = ({ open, onClose, resourceId, isContainer }) => {\n  const classes = useStyles();\n  const translate = useTranslate();\n  const { agents, addPermission, removePermission } = useAgents(resourceId);\n\n  return (\n    <Dialog fullWidth open={open} onClose={onClose}>\n      <DialogTitle className={classes.title}>\n        {translate(isContainer ? 'auth.dialog.container_permissions' : 'auth.dialog.resource_permissions')}\n      </DialogTitle>\n      <DialogContent className={classes.addForm}>\n        <AddPermissionsForm agents={agents} addPermission={addPermission} />\n      </DialogContent>\n      <DialogContent className={classes.listForm}>\n        <EditPermissionsForm\n          isContainer={isContainer}\n          agents={agents}\n          addPermission={addPermission}\n          removePermission={removePermission}\n        />\n      </DialogContent>\n      <DialogActions className={classes.actions}>\n        <Button label=\"ra.action.close\" variant=\"text\" onClick={onClose} />\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default PermissionsDialog;\n","import React, { useState } from 'react';\nimport { Button } from 'react-admin';\nimport ShareIcon from '@material-ui/icons/Share';\nimport PermissionsDialog from './PermissionsDialog';\n\nconst PermissionsButton = ({ record, resource }) => {\n  const [showDialog, setShowDialog] = useState(false);\n  const isContainer = !!resource;\n  const resourceId = isContainer ? resource : record.id || record['@id'];\n  return (\n    <>\n      <Button label=\"auth.action.permissions\" onClick={() => setShowDialog(true)}>\n        <ShareIcon />\n      </Button>\n      <PermissionsDialog\n        resourceId={resourceId}\n        isContainer={!!resource}\n        open={showDialog}\n        onClose={() => setShowDialog(false)}\n      />\n    </>\n  );\n};\n\nexport default PermissionsButton;\n","import React from 'react';\nimport { ShowButton, ListButton } from 'react-admin';\nimport { TopToolbar } from '@semapps/archipelago-layout';\nimport PermissionsButton from '../PermissionsButton/PermissionsButton';\n\nconst EditActions = ({ basePath, className, data, hasList, hasShow, hasControl, ...otherProps }) => (\n  <TopToolbar className={className} {...otherProps}>\n    {hasList && <ListButton basePath={basePath} record={data} />}\n    {hasShow && <ShowButton basePath={basePath} record={data} />}\n    {data && hasControl && <PermissionsButton basePath={basePath} record={data} />}\n  </TopToolbar>\n);\n\nexport default EditActions;\n","import React from 'react';\nimport { SaveButton, Toolbar, DeleteButton } from 'react-admin';\nimport { makeStyles } from '@material-ui/core';\n\nconst useStyles = makeStyles(() => ({\n  toolbar: {\n    flex: 1,\n    display: 'flex',\n    justifyContent: 'space-between'\n  }\n}));\n\nconst EditToolbarWithPermissions = ({ hasDelete, ...rest }) => {\n  const classes = useStyles();\n  return (\n    <Toolbar {...rest} className={classes.toolbar}>\n      <SaveButton />\n      {hasDelete && <DeleteButton undoable={false} />}\n    </Toolbar>\n  );\n};\n\nexport default EditToolbarWithPermissions;\n","import React from 'react';\nimport { usePermissionsOptimized } from 'react-admin';\nimport { List, ListActions } from '@semapps/archipelago-layout';\nimport PermissionsButton from '../PermissionsButton/PermissionsButton';\nimport { rightsToCreate, rightsToControl } from '../../constants';\n\nconst ListWithPermissions = ({ actions, resource, hasCreate, ...rest }) => {\n  const { permissions } = usePermissionsOptimized(resource);\n  return (\n    <List\n      {...rest}\n      resource={resource}\n      hasCreate={hasCreate && !!permissions && permissions.some(p => rightsToCreate.includes(p['acl:mode']))}\n      actions={\n        actions && permissions && permissions.some(p => rightsToControl.includes(p['acl:mode']))\n          ? React.cloneElement(actions, { bulkActions: <PermissionsButton /> })\n          : actions\n      }\n    />\n  );\n};\n\nListWithPermissions.defaultProps = {\n  actions: <ListActions />\n};\n\nexport default ListWithPermissions;\n","import React from 'react';\nimport { EditButton, ListButton } from 'react-admin';\nimport { TopToolbar } from '@semapps/archipelago-layout';\nimport PermissionsButton from '../PermissionsButton/PermissionsButton';\n\nconst ShowActions = ({ basePath, className, data, hasList, hasEdit, hasControl, ...otherProps }) => (\n  <TopToolbar className={className} {...otherProps}>\n    {hasList && <ListButton basePath={basePath} record={data} />}\n    {hasEdit && <EditButton basePath={basePath} record={data} />}\n    {data && hasControl && <PermissionsButton basePath={basePath} record={data} />}\n  </TopToolbar>\n);\n\nexport default ShowActions;\n","import React from 'react';\nimport jwtDecode from 'jwt-decode';\nimport { useLogin, useNotify, Notification } from 'react-admin';\nimport { ThemeProvider } from '@material-ui/styles';\nimport { createMuiTheme, makeStyles } from '@material-ui/core/styles';\nimport { Avatar, Button, Card, CardActions } from '@material-ui/core';\nimport LockIcon from '@material-ui/icons/Lock';\n\nconst useStyles = makeStyles(theme => ({\n  main: {\n    display: 'flex',\n    flexDirection: 'column',\n    minHeight: '100vh',\n    alignItems: 'center',\n    justifyContent: 'flex-start',\n    backgroundColor: theme.palette.primary[500]\n  },\n  card: {\n    minWidth: 300,\n    marginTop: '6em'\n  },\n  lockIconAvatar: {\n    margin: '1em',\n    display: 'flex',\n    justifyContent: 'center'\n  },\n  lockIcon: {\n    backgroundColor: theme.palette.secondary[500]\n  }\n}));\n\nconst LoginPage = ({ theme, history, location, buttons, userResource }) => {\n  const classes = useStyles();\n  const notify = useNotify();\n  const login = useLogin();\n\n  const searchParams = new URLSearchParams(location.search);\n  if (searchParams.has('token')) {\n    localStorage.setItem('token', searchParams.get('token'));\n    if (searchParams.has('new') && searchParams.get('new') === 'true') {\n      notify('Votre compte a été créé, vous pouvez maintenant le compléter', 'info');\n      const { webId } = jwtDecode(searchParams.get('token'));\n      history.push('/' + userResource + '/' + encodeURIComponent(webId) + '/edit');\n    } else {\n      notify('Vous êtes maintenant connecté', 'info');\n      history.push('/');\n    }\n  }\n\n  if (searchParams.has('logout')) {\n    localStorage.removeItem('token');\n    notify('Vous êtes maintenant déconnecté', 'info');\n    history.push('/');\n  }\n\n  return (\n    <ThemeProvider theme={createMuiTheme(theme)}>\n      <div className={classes.main}>\n        <Card className={classes.card}>\n          <div className={classes.lockIconAvatar}>\n            <Avatar className={classes.lockIcon}>\n              <LockIcon />\n            </Avatar>\n          </div>\n          {buttons &&\n            buttons.map(button => (\n              <CardActions>\n                {React.cloneElement(button, {\n                  fullWidth: true,\n                  variant: 'outlined',\n                  type: 'submit',\n                  onClick: () => login({}, '/login')\n                })}\n              </CardActions>\n            ))}\n        </Card>\n      </div>\n      <Notification />\n    </ThemeProvider>\n  );\n};\n\n// TODO deprecate this\nLoginPage.defaultProps = {\n  buttons: [<Button startIcon={<Avatar src=\"/lescommuns.jpg\" />}>Les Communs</Button>],\n  userResource: 'Person'\n};\n\nexport default LoginPage;\n","import React, { forwardRef } from 'react';\nimport { useLogout } from 'react-admin';\n\nimport MenuItem from '@material-ui/core/MenuItem';\nimport ExitIcon from '@material-ui/icons/PowerSettingsNew';\n\nconst LogoutButton = forwardRef((props, ref) => {\n  const logout = useLogout();\n  return (\n    <MenuItem onClick={() => logout()} ref={ref}>\n      <ExitIcon />\n      &nbsp;&nbsp; Se déconnecter\n    </MenuItem>\n  );\n});\n\nexport default LogoutButton;\n","import React, { forwardRef } from 'react';\nimport { UserMenu as RaUserMenu, MenuItemLink, useGetIdentity } from 'react-admin';\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle';\nimport EditIcon from '@material-ui/icons/Edit';\n\nconst ViewProfileMenu = forwardRef(({ onClick, webId }, ref) => (\n  <MenuItemLink\n    ref={ref}\n    to={`/Person/${encodeURIComponent(webId)}/show`}\n    primaryText=\"Voir mon profil\"\n    leftIcon={<AccountCircleIcon />}\n    onClick={onClick}\n  />\n));\n\nconst EditProfileMenu = forwardRef(({ onClick, webId }, ref) => (\n  <MenuItemLink\n    ref={ref}\n    to={`/Person/${encodeURIComponent(webId)}/edit`}\n    primaryText=\"Editer mon profil\"\n    leftIcon={<EditIcon />}\n    onClick={onClick}\n  />\n));\n\nconst LoginMenu = forwardRef(({ onClick }, ref) => (\n  <MenuItemLink ref={ref} to=\"/login\" primaryText=\"Se connecter\" onClick={onClick} />\n));\n\nconst UserMenu = ({ logout, ...otherProps }) => {\n  const { identity } = useGetIdentity();\n  return (\n    <RaUserMenu {...otherProps}>\n      {identity && identity.id !== '' ? (\n        [\n          <ViewProfileMenu webId={identity.id} key=\"view\" />,\n          <EditProfileMenu webId={identity.id} key=\"edit\" />,\n          React.cloneElement(logout, { key: 'logout' })\n        ]\n      ) : (\n        <LoginMenu />\n      )}\n    </RaUserMenu>\n  );\n};\n\nexport default UserMenu;\n","import React, { useEffect } from 'react';\nimport { Edit as RaEdit, usePermissionsOptimized, useRedirect, useNotify } from 'react-admin';\nimport EditActions from './EditActions';\nimport EditToolbarWithPermissions from './EditToolbarWithPermissions';\nimport { rightsToEdit, rightsToControl, rightsToDelete } from '../../constants';\n\nconst EditWithPermissions = props => {\n  const { permissions } = usePermissionsOptimized(props.id);\n  const notify = useNotify();\n  const redirect = useRedirect();\n  useEffect(() => {\n    if (permissions && !permissions.some(p => rightsToEdit.includes(p['acl:mode']))) {\n      notify('auth.message.resource_edit_forbidden', 'error');\n      redirect(props.basePath);\n    }\n  }, [permissions, redirect, notify]);\n  return (\n    <RaEdit\n      actions={\n        <EditActions hasControl={!!permissions && permissions.some(p => rightsToControl.includes(p['acl:mode']))} />\n      }\n      {...props}\n      permissions={permissions}\n    >\n      {React.cloneElement(props.children, {\n        toolbar: (\n          <EditToolbarWithPermissions\n            hasDelete={!!permissions && permissions.some(p => rightsToDelete.includes(p['acl:mode']))}\n          />\n        )\n      })}\n    </RaEdit>\n  );\n};\n\nexport default EditWithPermissions;\n","import React from 'react';\nimport { Resource, usePermissionsOptimized } from 'react-admin';\nimport { rightsToCreate } from '../constants';\n\n// Not used for now. The ListWithPermissions component will handle the conditional display of the Create button.\nconst ResourceWithPermission = ({ name, create, ...rest }) => {\n  const { permissions } = usePermissionsOptimized(name);\n  return (\n    <Resource\n      {...rest}\n      name={name}\n      create={permissions && permissions.some(p => rightsToCreate.includes(p['acl:mode'])) ? create : undefined}\n      // Requesting permissions to list container is too long, we will avoid that for now\n      // list={permissions && permissions.some(p => rightsToList.includes(p['acl:mode'])) ? list : undefined}\n    />\n  );\n};\n\nexport default ResourceWithPermission;\n","import React from 'react';\nimport { Show as RaShow, usePermissionsOptimized } from 'react-admin';\nimport ShowActions from './ShowActions';\nimport { rightsToEdit, rightsToControl } from '../../constants';\n\nconst ShowWithPermissions = props => {\n  const { permissions } = usePermissionsOptimized(props.id);\n  return (\n    <RaShow\n      actions={\n        <ShowActions hasControl={!!permissions && permissions.some(p => rightsToControl.includes(p['acl:mode']))} />\n      }\n      {...props}\n      permissions={permissions}\n      hasEdit={props.hasEdit && !!permissions && permissions.some(p => rightsToEdit.includes(p['acl:mode']))}\n    />\n  );\n};\n\nexport default ShowWithPermissions;\n","import jwtDecode from 'jwt-decode';\nimport { defaultToArray, getAclUri, getAclContext } from './utils';\n\nconst authProvider = ({ middlewareUri, httpClient, checkPermissions, resources }) => ({\n  login: params => {\n    window.location.href = `${middlewareUri}auth?redirectUrl=` + encodeURIComponent(window.location.href);\n    return Promise.resolve();\n  },\n  logout: () => {\n    // Redirect to login page after disconnecting from SSO\n    // The login page will remove the token, display a notification and redirect to the homepage\n    const url = new URL(window.location.href);\n    window.location.href =\n      `${middlewareUri}auth/logout?redirectUrl=` + encodeURIComponent(url.origin + '/login?logout');\n\n    // Avoid displaying immediately the login page\n    return Promise.resolve('/');\n  },\n  checkAuth: () => {\n    if (localStorage.getItem('token')) {\n      return Promise.resolve();\n    } else {\n      return Promise.resolve();\n    }\n  },\n  checkError: error => Promise.resolve(),\n  getPermissions: async resourceId => {\n    if (!checkPermissions) return true;\n\n    // If a resource name is passed, get the corresponding container, otherwise assume we have the URI\n    const resourceUri = resources[resourceId] ? resources[resourceId].containerUri : resourceId;\n\n    const aclUri = getAclUri(middlewareUri, resourceUri);\n\n    let { json } = await httpClient(aclUri);\n\n    return json['@graph'];\n  },\n  addPermission: async (resourceId, agentId, predicate, mode) => {\n    // If a resource name is passed, get the corresponding container, otherwise assume we have the URI\n    const resourceUri = resources[resourceId] ? resources[resourceId].containerUri : resourceId;\n\n    const aclUri = getAclUri(middlewareUri, resourceUri);\n\n    let authorization = {\n      '@id': '#' + mode.replace('acl:', ''),\n      '@type': 'acl:Authorization',\n      [predicate]: agentId,\n      'acl:accessTo': resourceUri,\n      'acl:mode': mode\n    };\n\n    await httpClient(aclUri, {\n      method: 'PATCH',\n      body: JSON.stringify({\n        '@context': getAclContext(aclUri),\n        '@graph': [authorization]\n      })\n    });\n  },\n  removePermission: async (resourceId, agentId, predicate, mode) => {\n    // If a resource name is passed, get the corresponding container, otherwise assume we have the URI\n    const resourceUri = resources[resourceId] ? resources[resourceId].containerUri : resourceId;\n    const aclUri = getAclUri(middlewareUri, resourceUri);\n\n    // Fetch current permissions\n    let { json } = await httpClient(aclUri);\n\n    const updatedPermissions = json['@graph']\n      .filter(authorization => !authorization['@id'].includes('#Default'))\n      .map(authorization => {\n        const modes = defaultToArray(authorization['acl:mode']);\n        let agents = defaultToArray(authorization[predicate]);\n        if (mode && modes.includes(mode) && agents && agents.includes(agentId)) {\n          agents = agents.filter(agent => agent !== agentId);\n        }\n        return { ...authorization, [predicate]: agents };\n      });\n\n    await httpClient(aclUri, {\n      method: 'PUT',\n      body: JSON.stringify({\n        '@context': getAclContext(aclUri),\n        '@graph': updatedPermissions\n      })\n    });\n  },\n  getIdentity: () => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      const { webId, name } = jwtDecode(token);\n      return { id: webId, fullName: name };\n    }\n  }\n});\n\nexport default authProvider;\n","import { ACL_APPEND, ACL_CONTROL, ACL_READ, ACL_WRITE } from '../constants';\n\nconst frenchMessages = {\n  auth: {\n    dialog: {\n      container_permissions: 'Permissions sur le container',\n      resource_permissions: 'Permissions sur la resource'\n    },\n    action: {\n      permissions: 'Permissions'\n    },\n    right: {\n      resource: {\n        read: 'Lire',\n        append: 'Enrichir',\n        write: 'Modifier',\n        control: 'Administrer'\n      },\n      container: {\n        read: 'Lister',\n        append: 'Ajouter',\n        write: 'Ajouter',\n        control: 'Administrer'\n      }\n    },\n    agent: {\n      anonymous: 'Tous les utilisateurs',\n      authenticated: 'Utilisateurs connectés'\n    },\n    input: {\n      agent_select: 'Ajouter un utilisateur...'\n    },\n    message: {\n      resource_edit_forbidden: \"Vous n'avez pas la permission d'éditer cette ressource\"\n    }\n  }\n};\n\nexport default frenchMessages;\n"],"names":["e","this","message","prototype","Error","name","r","window","atob","bind","t","String","replace","length","n","o","a","i","c","charAt","fromCharCode","indexOf","decodeURIComponent","charCodeAt","toString","toUpperCase","header","JSON","parse","split","context","definition","normalize","strArray","resultArray","TypeError","match","first","shift","component","push","str","join","parts","arguments","slice","call","module","exports","defaultToArray","value","Array","isArray","undefined","getAclUri","middlewareUri","resourceUri","urlJoin","getAclContext","baseUri","acl","foaf","CLASS_AGENT","rightsToCreate","rightsToEdit","rightsToDelete","rightsToControl","resourceRightsLabels","containerRightsLabels","useStyles","makeStyles","list","padding","width","option","AddPermissionsForm","agents","addPermission","classes","translate","useTranslate","useState","setValue","inputValue","setInputValue","options","setOptions","useGetList","page","perPage","field","order","q","enabled","ids","data","useEffect","Object","values","React","Autocomplete","getOptionLabel","filterOptions","x","filter","agent","keys","includes","id","noOptionsText","autoComplete","blurOnSelect","clearOnBlur","disableClearable","onChange","event","record","onInputChange","newInputValue","renderInput","params","TextField","label","variant","margin","fullWidth","renderOption","List","dense","className","ListItem","button","ListItemAvatar","Avatar","src","image","PersonIcon","ListItemText","primary","AgentIcon","predicate","PublicIcon","VpnLockIcon","GroupIcon","listItem","paddingLeft","paddingRight","primaryText","whiteSpace","overflow","textOverflow","secondaryText","textAlign","fontStyle","color","AgentItem","isContainer","removePermission","dataProvider","useDataProvider","anchorEl","setAnchorEl","user","setUser","loading","setLoading","error","setError","getOne","then","closeMenu","labels","Loading","permissions","map","p","ListItemSecondaryAction","IconButton","onClick","currentTarget","EditIcon","Menu","keepMounted","open","Boolean","onClose","entries","rightKey","rightLabel","hasPermission","MenuItem","key","ListItemIcon","CheckIcon","theme","maxWidth","backgroundColor","palette","background","paper","EditPermissionsForm","agentId","useAgents","resourceId","usePermissionsOptimized","authProvider","useAuthProvider","setAgents","result","appendPermission","mode","forEach","userUri","groupUri","useCallback","prevAgents","_agents$agentId","fromEntries","m","title","paddingBottom","actions","addForm","paddingTop","listForm","maxHeight","PermissionsDialog","Dialog","DialogTitle","DialogContent","DialogActions","Button","PermissionsButton","resource","showDialog","setShowDialog","ShareIcon","EditActions","basePath","hasList","hasShow","hasControl","otherProps","TopToolbar","ListButton","ShowButton","toolbar","flex","display","justifyContent","EditToolbarWithPermissions","hasDelete","rest","Toolbar","SaveButton","DeleteButton","undoable","ListWithPermissions","hasCreate","some","cloneElement","bulkActions","defaultProps","ListActions","ShowActions","hasEdit","EditButton","main","flexDirection","minHeight","alignItems","card","minWidth","marginTop","lockIconAvatar","lockIcon","secondary","LoginPage","history","location","buttons","userResource","notify","useNotify","login","useLogin","searchParams","URLSearchParams","search","has","localStorage","setItem","get","webId","jwtDecode","encodeURIComponent","removeItem","ThemeProvider","createMuiTheme","Card","LockIcon","CardActions","type","Notification","startIcon","LogoutButton","forwardRef","props","ref","logout","useLogout","ExitIcon","ViewProfileMenu","MenuItemLink","to","leftIcon","AccountCircleIcon","EditProfileMenu","LoginMenu","redirect","useRedirect","RaEdit","children","create","Resource","RaShow","identity","useGetIdentity","RaUserMenu","httpClient","checkPermissions","resources","href","Promise","resolve","url","URL","origin","checkAuth","getItem","checkError","getPermissions","containerUri","aclUri","json","authorization","method","body","stringify","updatedPermissions","modes","getIdentity","token","fullName","auth","dialog","container_permissions","resource_permissions","action","right","read","append","write","control","container","anonymous","authenticated","input","agent_select","resource_edit_forbidden"],"mappings":"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"}