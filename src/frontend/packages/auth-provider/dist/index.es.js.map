{"version":3,"file":"index.es.js","sources":["../node_modules/jwt-decode/build/jwt-decode.esm.js","../node_modules/url-join/lib/url-join.js","../src/utils.js","../src/authProvider.js","../src/constants.js","../src/components/PermissionsButton/AddPermissionsForm.js","../src/components/PermissionsButton/AgentIcon.js","../src/components/PermissionsButton/AgentItem.js","../src/components/PermissionsButton/EditPermissionsForm.js","../src/hooks/useAgents.js","../src/components/PermissionsButton/PermissionsDialog.js","../src/components/PermissionsButton/PermissionsButton.js","../src/components/EditWithPermissions/EditActions.js","../src/components/EditWithPermissions/EditToolbarWithPermissions.js","../src/components/EditWithPermissions/EditWithPermissions.js","../src/components/ListWithPermissions/ListWithPermissions.js","../src/components/ShowWithPermissions/ShowActions.js","../src/components/ShowWithPermissions/ShowWithPermissions.js","../src/components/LoginPage.js","../src/components/LogoutButton.js","../src/components/ResourceWithPermissions.js","../src/components/UserMenu.js","../src/messages/french.js"],"sourcesContent":["function e(e){this.message=e}e.prototype=new Error,e.prototype.name=\"InvalidCharacterError\";var r=\"undefined\"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,\"\");if(t.length%4==1)throw new e(\"'atob' failed: The string to be decoded is not correctly encoded.\");for(var n,o,a=0,i=0,c=\"\";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\".indexOf(o);return c};function t(e){var t=e.replace(/-/g,\"+\").replace(/_/g,\"/\");switch(t.length%4){case 0:break;case 2:t+=\"==\";break;case 3:t+=\"=\";break;default:throw\"Illegal base64url string!\"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t=\"0\"+t),\"%\"+t})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if(\"string\"!=typeof e)throw new n(\"Invalid token specified\");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(\".\")[o]))}catch(e){throw new n(\"Invalid token specified: \"+e.message)}}n.prototype=new Error,n.prototype.name=\"InvalidTokenError\";export default o;export{n as InvalidTokenError};\n//# sourceMappingURL=jwt-decode.esm.js.map\n","(function (name, context, definition) {\n  if (typeof module !== 'undefined' && module.exports) module.exports = definition();\n  else if (typeof define === 'function' && define.amd) define(definition);\n  else context[name] = definition();\n})('urljoin', this, function () {\n\n  function normalize (strArray) {\n    var resultArray = [];\n    if (strArray.length === 0) { return ''; }\n\n    if (typeof strArray[0] !== 'string') {\n      throw new TypeError('Url must be a string. Received ' + strArray[0]);\n    }\n\n    // If the first part is a plain protocol, we combine it with the next part.\n    if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n      var first = strArray.shift();\n      strArray[0] = first + strArray[0];\n    }\n\n    // There must be two or three slashes in the file protocol, two slashes in anything else.\n    if (strArray[0].match(/^file:\\/\\/\\//)) {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1:///');\n    } else {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1://');\n    }\n\n    for (var i = 0; i < strArray.length; i++) {\n      var component = strArray[i];\n\n      if (typeof component !== 'string') {\n        throw new TypeError('Url must be a string. Received ' + component);\n      }\n\n      if (component === '') { continue; }\n\n      if (i > 0) {\n        // Removing the starting slashes for each component but the first.\n        component = component.replace(/^[\\/]+/, '');\n      }\n      if (i < strArray.length - 1) {\n        // Removing the ending slashes for each component but the last.\n        component = component.replace(/[\\/]+$/, '');\n      } else {\n        // For the last component we will combine multiple slashes to a single one.\n        component = component.replace(/[\\/]+$/, '/');\n      }\n\n      resultArray.push(component);\n\n    }\n\n    var str = resultArray.join('/');\n    // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n    // remove trailing slash before parameters or hash\n    str = str.replace(/\\/(\\?|&|#[^!])/g, '$1');\n\n    // replace ? in parameters with &\n    var parts = str.split('?');\n    str = parts.shift() + (parts.length > 0 ? '?': '') + parts.join('&');\n\n    return str;\n  }\n\n  return function () {\n    var input;\n\n    if (typeof arguments[0] === 'object') {\n      input = arguments[0];\n    } else {\n      input = [].slice.call(arguments);\n    }\n\n    return normalize(input);\n  };\n\n});\n","import urlJoin from 'url-join';\n\nexport const defaultToArray = value => (!value ? undefined : Array.isArray(value) ? value : [value]);\n\n// Transform the URI to the one used to find the ACL\n// To be compatible with all servers, we should do a HEAD request to the resource URI\nexport const getAclUri = (middlewareUri, resourceUri) =>\n  urlJoin(middlewareUri, resourceUri.replace(middlewareUri, '_acl/'));\n\nexport const getAclContext = baseUri => ({\n  '@base': baseUri,\n  acl: 'http://www.w3.org/ns/auth/acl#',\n  foaf: 'http://xmlns.com/foaf/0.1/',\n  'acl:agent': { '@type': '@id' },\n  'acl:agentGroup': { '@type': '@id' },\n  'acl:agentClass': { '@type': '@id' },\n  'acl:mode': { '@type': '@id' },\n  'acl:accessTo': { '@type': '@id' }\n});\n","import jwtDecode from 'jwt-decode';\nimport { defaultToArray, getAclUri, getAclContext } from './utils';\n\nconst authProvider = ({ middlewareUri, httpClient, checkPermissions, resources }) => ({\n  login: params => {\n    window.location.href = `${middlewareUri}auth?redirectUrl=` + encodeURIComponent(window.location.href);\n    return Promise.resolve();\n  },\n  logout: () => {\n    // Redirect to login page after disconnecting from SSO\n    // The login page will remove the token, display a notification and redirect to the homepage\n    const url = new URL(window.location.href);\n    window.location.href =\n      `${middlewareUri}auth/logout?redirectUrl=` + encodeURIComponent(url.origin + '/login?logout');\n\n    // Avoid displaying immediately the login page\n    return Promise.resolve('/');\n  },\n  checkAuth: () => {\n    if (localStorage.getItem('token')) {\n      return Promise.resolve();\n    } else {\n      return Promise.resolve();\n    }\n  },\n  checkError: error => Promise.resolve(),\n  getPermissions: async resourceId => {\n    if (!checkPermissions) return true;\n\n    // If a resource name is passed, get the corresponding container, otherwise assume we have the URI\n    const resourceUri = resources[resourceId] ? resources[resourceId].containerUri : resourceId;\n\n    const aclUri = getAclUri(middlewareUri, resourceUri);\n\n    let { json } = await httpClient(aclUri);\n\n    return json['@graph'];\n  },\n  addPermission: async (resourceId, agentId, predicate, mode) => {\n    // If a resource name is passed, get the corresponding container, otherwise assume we have the URI\n    const resourceUri = resources[resourceId] ? resources[resourceId].containerUri : resourceId;\n\n    const aclUri = getAclUri(middlewareUri, resourceUri);\n\n    let authorization = {\n      '@id': '#' + mode.replace('acl:', ''),\n      '@type': 'acl:Authorization',\n      [predicate]: agentId,\n      'acl:accessTo': resourceUri,\n      'acl:mode': mode\n    };\n\n    await httpClient(aclUri, {\n      method: 'PATCH',\n      body: JSON.stringify({\n        '@context': getAclContext(aclUri),\n        '@graph': [authorization]\n      })\n    });\n  },\n  removePermission: async (resourceId, agentId, predicate, mode) => {\n    // If a resource name is passed, get the corresponding container, otherwise assume we have the URI\n    const resourceUri = resources[resourceId] ? resources[resourceId].containerUri : resourceId;\n    const aclUri = getAclUri(middlewareUri, resourceUri);\n\n    // Fetch current permissions\n    let { json } = await httpClient(aclUri);\n\n    const updatedPermissions = json['@graph']\n      .filter(authorization => !authorization['@id'].includes('#Default'))\n      .map(authorization => {\n        const modes = defaultToArray(authorization['acl:mode']);\n        let agents = defaultToArray(authorization[predicate]);\n        if (mode && modes.includes(mode) && agents && agents.includes(agentId)) {\n          agents = agents.filter(agent => agent !== agentId);\n        }\n        return { ...authorization, [predicate]: agents };\n      });\n\n    await httpClient(aclUri, {\n      method: 'PUT',\n      body: JSON.stringify({\n        '@context': getAclContext(aclUri),\n        '@graph': updatedPermissions\n      })\n    });\n  },\n  getIdentity: () => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      const { webId, name } = jwtDecode(token);\n      return { id: webId, fullName: name };\n    }\n  }\n});\n\nexport default authProvider;\n","export const ACL_READ = 'acl:Read';\nexport const ACL_APPEND = 'acl:Append';\nexport const ACL_WRITE = 'acl:Write';\nexport const ACL_CONTROL = 'acl:Control';\n\nexport const USER_AGENT = 'acl:agent';\nexport const GROUP_AGENT = 'acl:agentGroup';\nexport const CLASS_AGENT = 'acl:agentClass';\n\nexport const ANONYMOUS_AGENT = 'foaf:Agent';\nexport const AUTHENTICATED_AGENT = 'acl:AuthenticatedAgent';\n\nexport const rightsToList = [ACL_READ, ACL_APPEND, ACL_WRITE, ACL_CONTROL];\nexport const rightsToCreate = [ACL_APPEND, ACL_WRITE, ACL_CONTROL];\nexport const rightsToEdit = [ACL_APPEND, ACL_WRITE, ACL_CONTROL];\nexport const rightsToDelete = [ACL_WRITE, ACL_CONTROL];\nexport const rightsToControl = [ACL_CONTROL];\n\nexport const resourceRightsLabels = {\n  [ACL_READ]: 'auth.right.resource.read',\n  [ACL_APPEND]: 'auth.right.resource.append',\n  [ACL_WRITE]: 'auth.right.resource.write',\n  [ACL_CONTROL]: 'auth.right.resource.control'\n};\n\nexport const containerRightsLabels = {\n  [ACL_READ]: 'auth.right.container.read',\n  [ACL_WRITE]: 'auth.right.container.write',\n  [ACL_CONTROL]: 'auth.right.container.control'\n};\n","import React, { useEffect, useState } from 'react';\nimport { useGetList, useTranslate } from 'react-admin';\nimport { TextField, makeStyles, List, ListItem, ListItemAvatar, ListItemText, Avatar } from '@material-ui/core';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport PersonIcon from '@material-ui/icons/Person';\nimport { USER_AGENT, ACL_READ } from '../../constants';\n\nconst useStyles = makeStyles(() => ({\n  list: {\n    padding: 0,\n    width: '100%'\n  },\n  option: {\n    padding: 0\n  }\n}));\n\nconst AddPermissionsForm = ({ agents, addPermission }) => {\n  const classes = useStyles();\n  const translate = useTranslate();\n  const [value, setValue] = useState(null);\n  const [inputValue, setInputValue] = useState('');\n  const [options, setOptions] = useState([]);\n\n  const { ids, data } = useGetList(\n    'Person',\n    { page: 1, perPage: 100 },\n    { field: 'pair:label', order: 'ASC' },\n    { q: inputValue },\n    { enabled: inputValue.length > 0 }\n  );\n\n  useEffect(() => {\n    setOptions(ids.length > 0 ? Object.values(data) : []);\n  }, [ids, data]);\n\n  return (\n    <Autocomplete\n      classes={{ option: classes.option }}\n      getOptionLabel={option => option['pair:label']}\n      // Do not return agents which have already been added\n      filterOptions={x => x.filter(agent => !Object.keys(agents).includes(agent.id))}\n      options={options}\n      noOptionsText={translate('ra.navigation.no_results')}\n      autoComplete\n      blurOnSelect\n      clearOnBlur\n      disableClearable\n      value={value}\n      onChange={(event, record) => {\n        addPermission(record.id || record['@id'], USER_AGENT, ACL_READ);\n        setValue(null);\n        setInputValue('');\n        setOptions([]);\n      }}\n      onInputChange={(event, newInputValue) => {\n        setInputValue(newInputValue);\n      }}\n      renderInput={params => (\n        <TextField {...params} label={translate('auth.input.agent_select')} variant=\"filled\" margin=\"dense\" fullWidth />\n      )}\n      renderOption={option => (\n        <List dense className={classes.list}>\n          <ListItem button>\n            <ListItemAvatar>\n              <Avatar src={option.image}>\n                <PersonIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary={option['pair:label']} />\n          </ListItem>\n        </List>\n      )}\n    />\n  );\n};\n\nexport default AddPermissionsForm;\n","import React from 'react';\nimport PublicIcon from '@material-ui/icons/Public';\nimport VpnLockIcon from '@material-ui/icons/VpnLock';\nimport PersonIcon from '@material-ui/icons/Person';\nimport GroupIcon from '@material-ui/icons/Group';\nimport { CLASS_AGENT, GROUP_AGENT, USER_AGENT, ANONYMOUS_AGENT } from '../../constants';\n\nconst AgentIcon = ({ agent }) => {\n  switch (agent.predicate) {\n    case CLASS_AGENT:\n      return agent.id === ANONYMOUS_AGENT ? <PublicIcon /> : <VpnLockIcon />;\n    case USER_AGENT:\n      return <PersonIcon />;\n    case GROUP_AGENT:\n      return <GroupIcon />;\n    default:\n      throw new Error('Unknown agent predicate: ' + agent.predicate);\n  }\n};\n\nexport default AgentIcon;\n","import React, { useState, useEffect } from 'react';\nimport { useDataProvider, useTranslate, Loading, Error } from 'react-admin';\nimport {\n  makeStyles,\n  Avatar,\n  ListItem,\n  ListItemIcon,\n  ListItemAvatar,\n  ListItemText,\n  ListItemSecondaryAction,\n  IconButton,\n  Menu,\n  MenuItem\n} from '@material-ui/core';\nimport EditIcon from '@material-ui/icons/Edit';\nimport CheckIcon from '@material-ui/icons/Check';\nimport { GROUP_AGENT, USER_AGENT, ANONYMOUS_AGENT, resourceRightsLabels, containerRightsLabels } from '../../constants';\nimport AgentIcon from './AgentIcon';\n\nconst useStyles = makeStyles(() => ({\n  listItem: {\n    paddingLeft: 4,\n    paddingRight: 36\n  },\n  primaryText: {\n    width: '30%',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis'\n  },\n  secondaryText: {\n    textAlign: 'center',\n    width: '60%',\n    fontStyle: 'italic',\n    color: 'grey'\n  }\n}));\n\nconst AgentItem = ({ isContainer, agent, addPermission, removePermission }) => {\n  const classes = useStyles();\n  const translate = useTranslate();\n  const dataProvider = useDataProvider();\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const [user, setUser] = useState();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState();\n\n  useEffect(() => {\n    if (agent.predicate === USER_AGENT) {\n      dataProvider\n        .getOne('Person', { id: agent.id })\n        .then(({ data }) => {\n          setUser(data);\n          setLoading(false);\n        })\n        .catch(error => {\n          setError(error);\n          setLoading(false);\n        });\n    } else {\n      setLoading(false);\n    }\n  }, [agent.id, agent.predicate]);\n\n  // For now, do not display groups\n  if (agent.predicate === GROUP_AGENT) return null;\n\n  const openMenu = event => setAnchorEl(event.currentTarget);\n  const closeMenu = () => setAnchorEl(null);\n\n  const labels = isContainer ? containerRightsLabels : resourceRightsLabels;\n\n  if (loading) return <Loading />;\n  if (error) return <Error />;\n\n  return (\n    <ListItem className={classes.listItem}>\n      <ListItemAvatar>\n        <Avatar src={user?.image}>\n          <AgentIcon agent={agent} />\n        </Avatar>\n      </ListItemAvatar>\n      <ListItemText\n        className={classes.primaryText}\n        primary={\n          user\n            ? user['pair:label']\n            : translate(agent.id === ANONYMOUS_AGENT ? 'auth.agent.anonymous' : 'auth.agent.authenticated')\n        }\n      />\n      <ListItemText\n        className={classes.secondaryText}\n        primary={agent.permissions && agent.permissions.map(p => translate(labels[p])).join(', ')}\n      />\n      <ListItemSecondaryAction>\n        <IconButton onClick={openMenu}>\n          <EditIcon />\n        </IconButton>\n        <Menu anchorEl={anchorEl} keepMounted open={Boolean(anchorEl)} onClose={closeMenu}>\n          {Object.entries(labels).map(([rightKey, rightLabel]) => {\n            const hasPermission = agent.permissions && agent.permissions.includes(rightKey);\n            return (\n              <MenuItem\n                key={rightKey}\n                onClick={() => {\n                  if (hasPermission) {\n                    removePermission(agent.id, agent.predicate, rightKey);\n                  } else {\n                    addPermission(agent.id, agent.predicate, rightKey);\n                  }\n                  closeMenu();\n                }}\n              >\n                <ListItemIcon>{hasPermission ? <CheckIcon /> : null}</ListItemIcon>\n                <ListItemText primary={translate(rightLabel)} />\n              </MenuItem>\n            );\n          })}\n        </Menu>\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n};\n\nexport default AgentItem;\n","import React from 'react';\nimport { List, makeStyles } from '@material-ui/core';\nimport AgentItem from './AgentItem';\n\nconst useStyles = makeStyles(theme => ({\n  list: {\n    width: '100%',\n    maxWidth: '100%',\n    backgroundColor: theme.palette.background.paper\n  }\n}));\n\nconst EditPermissionsForm = ({ isContainer, agents, addPermission, removePermission }) => {\n  const classes = useStyles();\n  return (\n    <List dense className={classes.list}>\n      {Object.entries(agents).map(([agentId, agent]) => (\n        <AgentItem\n          key={agentId}\n          isContainer={isContainer}\n          agent={agent}\n          addPermission={addPermission}\n          removePermission={removePermission}\n        />\n      ))}\n    </List>\n  );\n};\n\nexport default EditPermissionsForm;\n","import { useEffect, useCallback, useState } from 'react';\nimport { usePermissionsOptimized, useAuthProvider } from 'react-admin';\nimport { defaultToArray } from '../utils';\nimport { CLASS_AGENT, GROUP_AGENT, USER_AGENT, ANONYMOUS_AGENT, AUTHENTICATED_AGENT } from '../constants';\n\nconst useAgents = resourceId => {\n  const { permissions } = usePermissionsOptimized(resourceId);\n  const authProvider = useAuthProvider();\n  const [agents, setAgents] = useState({});\n\n  // Format list of authorized agents, based on the permissions returned for the resource\n  useEffect(() => {\n    let result = {\n      [ANONYMOUS_AGENT]: {\n        id: ANONYMOUS_AGENT,\n        predicate: CLASS_AGENT,\n        permissions: []\n      },\n      [AUTHENTICATED_AGENT]: {\n        id: AUTHENTICATED_AGENT,\n        predicate: CLASS_AGENT,\n        permissions: []\n      }\n    };\n\n    const appendPermission = (agentId, predicate, mode) => {\n      if (result[agentId]) {\n        result[agentId].permissions.push(mode);\n      } else {\n        result[agentId] = {\n          id: agentId,\n          predicate,\n          permissions: [mode]\n        };\n      }\n    };\n\n    if (permissions) {\n      for (let p of permissions) {\n        if (p[CLASS_AGENT]) {\n          defaultToArray(p[CLASS_AGENT]).forEach(agentId => appendPermission(agentId, CLASS_AGENT, p['acl:mode']));\n        }\n        if (p[USER_AGENT]) {\n          defaultToArray(p[USER_AGENT]).forEach(userUri => appendPermission(userUri, USER_AGENT, p['acl:mode']));\n        }\n        if (p[GROUP_AGENT]) {\n          defaultToArray(p[GROUP_AGENT]).forEach(groupUri => appendPermission(groupUri, GROUP_AGENT, p['acl:mode']));\n        }\n      }\n      setAgents(result);\n    }\n  }, [permissions]);\n\n  const addPermission = useCallback(\n    (agentId, predicate, mode) => {\n      const prevAgents = { ...agents };\n      setAgents({\n        ...agents,\n        [agentId]: {\n          id: agentId,\n          predicate,\n          permissions: agents[agentId] ? [...agents[agentId]?.permissions, mode] : [mode]\n        }\n      });\n      authProvider.addPermission(resourceId, agentId, predicate, mode).catch(e => {\n        // If there was an error, revert the optimistic update\n        setAgents(prevAgents);\n      });\n    },\n    [agents, setAgents, resourceId, authProvider]\n  );\n\n  const removePermission = useCallback(\n    (agentId, predicate, mode) => {\n      const prevAgents = { ...agents };\n      setAgents(\n        Object.fromEntries(\n          Object.entries(agents)\n            .map(([key, agent]) => {\n              if (agent.id === agentId) {\n                agent.permissions = agent.permissions.filter(m => m !== mode);\n              }\n              return [key, agent];\n            })\n            // Remove agents if they have no permissions (except if they are class agents)\n            .filter(([_, agent]) => agent.predicate === CLASS_AGENT || agent.permissions.length > 0)\n        )\n      );\n      authProvider.removePermission(resourceId, agentId, predicate, mode).catch(e => {\n        // If there was an error, revert the optimistic update\n        setAgents(prevAgents);\n      });\n    },\n    [agents, setAgents, resourceId, authProvider]\n  );\n\n  return { agents, addPermission, removePermission };\n};\n\nexport default useAgents;\n","import React from 'react';\nimport { Button, useTranslate } from 'react-admin';\nimport { Dialog, DialogTitle, DialogContent, DialogActions, makeStyles } from '@material-ui/core';\nimport AddPermissionsForm from './AddPermissionsForm';\nimport EditPermissionsForm from './EditPermissionsForm';\nimport useAgents from '../../hooks/useAgents';\n\nconst useStyles = makeStyles(() => ({\n  title: {\n    paddingBottom: 8\n  },\n  actions: {\n    padding: 15\n  },\n  addForm: {\n    paddingTop: 0\n  },\n  listForm: {\n    paddingTop: 0,\n    paddingBottom: 0,\n    paddingRight: 0,\n    maxHeight: 210\n  }\n}));\n\nconst PermissionsDialog = ({ open, onClose, resourceId, isContainer }) => {\n  const classes = useStyles();\n  const translate = useTranslate();\n  const { agents, addPermission, removePermission } = useAgents(resourceId);\n\n  return (\n    <Dialog fullWidth open={open} onClose={onClose}>\n      <DialogTitle className={classes.title}>\n        {translate(isContainer ? 'auth.dialog.container_permissions' : 'auth.dialog.resource_permissions')}\n      </DialogTitle>\n      <DialogContent className={classes.addForm}>\n        <AddPermissionsForm agents={agents} addPermission={addPermission} />\n      </DialogContent>\n      <DialogContent className={classes.listForm}>\n        <EditPermissionsForm\n          isContainer={isContainer}\n          agents={agents}\n          addPermission={addPermission}\n          removePermission={removePermission}\n        />\n      </DialogContent>\n      <DialogActions className={classes.actions}>\n        <Button label=\"ra.action.close\" variant=\"text\" onClick={onClose} />\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default PermissionsDialog;\n","import React, { useState } from 'react';\nimport { Button } from 'react-admin';\nimport ShareIcon from '@material-ui/icons/Share';\nimport PermissionsDialog from './PermissionsDialog';\n\nconst PermissionsButton = ({ record, resource }) => {\n  const [showDialog, setShowDialog] = useState(false);\n  const isContainer = !!resource;\n  const resourceId = isContainer ? resource : record.id || record['@id'];\n  return (\n    <>\n      <Button label=\"auth.action.permissions\" onClick={() => setShowDialog(true)}>\n        <ShareIcon />\n      </Button>\n      <PermissionsDialog\n        resourceId={resourceId}\n        isContainer={!!resource}\n        open={showDialog}\n        onClose={() => setShowDialog(false)}\n      />\n    </>\n  );\n};\n\nexport default PermissionsButton;\n","import React from 'react';\nimport { TopToolbar, ShowButton, ListButton } from 'react-admin';\nimport PermissionsButton from '../PermissionsButton/PermissionsButton';\n\nconst EditActions = ({ basePath, className, data, hasList, hasShow, hasControl, ...otherProps }) => (\n  <TopToolbar className={className} {...otherProps}>\n    {hasList && <ListButton basePath={basePath} record={data} />}\n    {hasShow && <ShowButton basePath={basePath} record={data} />}\n    {data && hasControl && <PermissionsButton basePath={basePath} record={data} />}\n  </TopToolbar>\n);\n\nexport default EditActions;\n","import React from 'react';\nimport { SaveButton, Toolbar, DeleteButton } from 'react-admin';\nimport { makeStyles } from '@material-ui/core';\n\nconst useStyles = makeStyles(() => ({\n  toolbar: {\n    flex: 1,\n    display: 'flex',\n    justifyContent: 'space-between'\n  }\n}));\n\nconst EditToolbarWithPermissions = ({ hasDelete, ...rest }) => {\n  const classes = useStyles();\n  return (\n    <Toolbar {...rest} className={classes.toolbar}>\n      <SaveButton />\n      {hasDelete && <DeleteButton undoable={false} />}\n    </Toolbar>\n  );\n};\n\nexport default EditToolbarWithPermissions;\n","import React from 'react';\nimport { Edit as RaEdit, usePermissionsOptimized } from 'react-admin';\nimport EditActions from './EditActions';\nimport EditToolbarWithPermissions from './EditToolbarWithPermissions';\nimport { rightsToControl, rightsToDelete } from '../../constants';\n\nconst EditWithPermissions = props => {\n  const { permissions } = usePermissionsOptimized(props.id);\n  return (\n    <RaEdit\n      actions={\n        <EditActions hasControl={!!permissions && permissions.some(p => rightsToControl.includes(p['acl:mode']))} />\n      }\n      {...props}\n      permissions={permissions}\n    >\n      {React.cloneElement(props.children, {\n        toolbar: (\n          <EditToolbarWithPermissions\n            hasDelete={!!permissions && permissions.some(p => rightsToDelete.includes(p['acl:mode']))}\n          />\n        )\n      })}\n    </RaEdit>\n  );\n};\n\nexport default EditWithPermissions;\n","import React from 'react';\nimport { usePermissionsOptimized } from 'react-admin';\nimport { List, ListActions } from '@semapps/archipelago-layout';\nimport PermissionsButton from '../PermissionsButton/PermissionsButton';\nimport { rightsToCreate, rightsToControl } from '../../constants';\n\nconst ListWithPermissions = ({ actions, resource, hasCreate, ...rest }) => {\n  const { permissions } = usePermissionsOptimized(resource);\n  return (\n    <List\n      {...rest}\n      resource={resource}\n      hasCreate={hasCreate && !!permissions && permissions.some(p => rightsToCreate.includes(p['acl:mode']))}\n      actions={\n        actions && permissions && permissions.some(p => rightsToControl.includes(p['acl:mode']))\n          ? React.cloneElement(actions, { bulkActions: <PermissionsButton /> })\n          : actions\n      }\n    />\n  );\n};\n\nListWithPermissions.defaultProps = {\n  actions: <ListActions />\n};\n\nexport default ListWithPermissions;\n","import React from 'react';\nimport { TopToolbar, EditButton, ListButton } from 'react-admin';\nimport PermissionsButton from '../PermissionsButton/PermissionsButton';\n\nconst ShowActions = ({ basePath, className, data, hasList, hasEdit, hasControl, ...otherProps }) => (\n  <TopToolbar className={className} {...otherProps}>\n    {hasList && <ListButton basePath={basePath} record={data} />}\n    {hasEdit && <EditButton basePath={basePath} record={data} />}\n    {data && hasControl && <PermissionsButton basePath={basePath} record={data} />}\n  </TopToolbar>\n);\n\nexport default ShowActions;\n","import React from 'react';\nimport { Show as RaShow, usePermissionsOptimized } from 'react-admin';\nimport ShowActions from './ShowActions';\nimport { rightsToEdit, rightsToControl } from '../../constants';\n\nconst ShowWithPermissions = props => {\n  const { permissions } = usePermissionsOptimized(props.id);\n  return (\n    <RaShow\n      actions={\n        <ShowActions hasControl={!!permissions && permissions.some(p => rightsToControl.includes(p['acl:mode']))} />\n      }\n      {...props}\n      permissions={permissions}\n      hasEdit={props.hasEdit && !!permissions && permissions.some(p => rightsToEdit.includes(p['acl:mode']))}\n    />\n  );\n};\n\nexport default ShowWithPermissions;\n","import React from 'react';\nimport jwtDecode from 'jwt-decode';\nimport { useLogin, useNotify, Notification } from 'react-admin';\nimport { ThemeProvider } from '@material-ui/styles';\nimport { createMuiTheme, makeStyles } from '@material-ui/core/styles';\nimport { Avatar, Button, Card, CardActions } from '@material-ui/core';\nimport LockIcon from '@material-ui/icons/Lock';\n\nconst useStyles = makeStyles(theme => ({\n  main: {\n    display: 'flex',\n    flexDirection: 'column',\n    minHeight: '100vh',\n    alignItems: 'center',\n    justifyContent: 'flex-start',\n    backgroundColor: theme.palette.primary[500]\n  },\n  card: {\n    minWidth: 300,\n    marginTop: '6em'\n  },\n  lockIconAvatar: {\n    margin: '1em',\n    display: 'flex',\n    justifyContent: 'center'\n  },\n  lockIcon: {\n    backgroundColor: theme.palette.secondary[500]\n  }\n}));\n\nconst LoginPage = ({ theme, history, location, buttons, userResource }) => {\n  const classes = useStyles();\n  const notify = useNotify();\n  const login = useLogin();\n\n  const searchParams = new URLSearchParams(location.search);\n  if (searchParams.has('token')) {\n    localStorage.setItem('token', searchParams.get('token'));\n    if (searchParams.has('new') && searchParams.get('new') === 'true') {\n      notify('Votre compte a été créé, vous pouvez maintenant le compléter', 'info');\n      const { webId } = jwtDecode(searchParams.get('token'));\n      history.push('/' + userResource + '/' + encodeURIComponent(webId) + '/edit');\n    } else {\n      notify('Vous êtes maintenant connecté', 'info');\n      history.push('/');\n    }\n  }\n\n  if (searchParams.has('logout')) {\n    localStorage.removeItem('token');\n    notify('Vous êtes maintenant déconnecté', 'info');\n    history.push('/');\n  }\n\n  return (\n    <ThemeProvider theme={createMuiTheme(theme)}>\n      <div className={classes.main}>\n        <Card className={classes.card}>\n          <div className={classes.lockIconAvatar}>\n            <Avatar className={classes.lockIcon}>\n              <LockIcon />\n            </Avatar>\n          </div>\n          {buttons &&\n            buttons.map(button => (\n              <CardActions>\n                {React.cloneElement(button, {\n                  fullWidth: true,\n                  variant: 'outlined',\n                  type: 'submit',\n                  onClick: () => login({}, '/login')\n                })}\n              </CardActions>\n            ))}\n        </Card>\n      </div>\n      <Notification />\n    </ThemeProvider>\n  );\n};\n\n// TODO deprecate this\nLoginPage.defaultProps = {\n  buttons: [<Button startIcon={<Avatar src=\"/lescommuns.jpg\" />}>Les Communs</Button>],\n  userResource: 'Person'\n};\n\nexport default LoginPage;\n","import React, { forwardRef } from 'react';\nimport { useLogout } from 'react-admin';\n\nimport MenuItem from '@material-ui/core/MenuItem';\nimport ExitIcon from '@material-ui/icons/PowerSettingsNew';\n\nconst LogoutButton = forwardRef((props, ref) => {\n  const logout = useLogout();\n  return (\n    <MenuItem onClick={() => logout()} ref={ref}>\n      <ExitIcon />\n      &nbsp;&nbsp; Se déconnecter\n    </MenuItem>\n  );\n});\n\nexport default LogoutButton;\n","import React from 'react';\nimport { Resource, usePermissionsOptimized } from 'react-admin';\nimport { rightsToCreate } from '../constants';\n\n// Not used for now. The ListWithPermissions component will handle the conditional display of the Create button.\nconst ResourceWithPermission = ({ name, create, ...rest }) => {\n  const { permissions } = usePermissionsOptimized(name);\n  return (\n    <Resource\n      {...rest}\n      name={name}\n      create={permissions && permissions.some(p => rightsToCreate.includes(p['acl:mode'])) ? create : undefined}\n      // Requesting permissions to list container is too long, we will avoid that for now\n      // list={permissions && permissions.some(p => rightsToList.includes(p['acl:mode'])) ? list : undefined}\n    />\n  );\n};\n\nexport default ResourceWithPermission;\n","import React, { forwardRef } from 'react';\nimport { UserMenu as RaUserMenu, MenuItemLink, useGetIdentity } from 'react-admin';\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle';\nimport EditIcon from '@material-ui/icons/Edit';\n\nconst ViewProfileMenu = forwardRef(({ onClick, webId }, ref) => (\n  <MenuItemLink\n    ref={ref}\n    to={`/Person/${encodeURIComponent(webId)}/show`}\n    primaryText=\"Voir mon profil\"\n    leftIcon={<AccountCircleIcon />}\n    onClick={onClick}\n  />\n));\n\nconst EditProfileMenu = forwardRef(({ onClick, webId }, ref) => (\n  <MenuItemLink\n    ref={ref}\n    to={`/Person/${encodeURIComponent(webId)}/edit`}\n    primaryText=\"Editer mon profil\"\n    leftIcon={<EditIcon />}\n    onClick={onClick}\n  />\n));\n\nconst LoginMenu = forwardRef(({ onClick }, ref) => (\n  <MenuItemLink ref={ref} to=\"/login\" primaryText=\"Se connecter\" onClick={onClick} />\n));\n\nconst UserMenu = ({ logout, ...otherProps }) => {\n  const { identity } = useGetIdentity();\n  return (\n    <RaUserMenu {...otherProps}>\n      {identity && identity.id !== '' ? (\n        [\n          <ViewProfileMenu webId={identity.id} key=\"view\" />,\n          <EditProfileMenu webId={identity.id} key=\"edit\" />,\n          React.cloneElement(logout, { key: 'logout' })\n        ]\n      ) : (\n        <LoginMenu />\n      )}\n    </RaUserMenu>\n  );\n};\n\nexport default UserMenu;\n","import { ACL_APPEND, ACL_CONTROL, ACL_READ, ACL_WRITE } from '../constants';\n\nconst frenchMessages = {\n  auth: {\n    dialog: {\n      container_permissions: 'Permissions sur le container',\n      resource_permissions: 'Permissions sur la resource'\n    },\n    action: {\n      permissions: 'Permissions'\n    },\n    right: {\n      resource: {\n        read: 'Lire',\n        append: 'Enrichir',\n        write: 'Modifier',\n        control: 'Administrer'\n      },\n      container: {\n        read: 'Lister',\n        append: 'Ajouter',\n        write: 'Ajouter',\n        control: 'Administrer'\n      }\n    },\n    agent: {\n      anonymous: 'Tous les utilisateurs',\n      authenticated: 'Utilisateurs connectés'\n    },\n    input: {\n      agent_select: 'Ajouter un utilisateur...'\n    }\n  }\n};\n\nexport default frenchMessages;\n"],"names":["e","this","message","prototype","Error","name","r","window","atob","bind","t","String","replace","length","n","o","a","i","c","charAt","fromCharCode","indexOf","decodeURIComponent","charCodeAt","toString","toUpperCase","header","JSON","parse","split","context","definition","normalize","strArray","resultArray","TypeError","match","first","shift","component","push","str","join","parts","arguments","slice","call","module","exports","defaultToArray","value","Array","isArray","undefined","getAclUri","middlewareUri","resourceUri","urlJoin","getAclContext","baseUri","acl","foaf","authProvider","httpClient","checkPermissions","resources","login","params","location","href","encodeURIComponent","Promise","resolve","logout","url","URL","origin","checkAuth","localStorage","getItem","checkError","error","getPermissions","resourceId","containerUri","aclUri","json","addPermission","agentId","predicate","mode","authorization","method","body","stringify","removePermission","updatedPermissions","filter","includes","map","modes","agents","agent","getIdentity","token","jwtDecode","id","webId","fullName","CLASS_AGENT","rightsToCreate","rightsToEdit","rightsToDelete","rightsToControl","resourceRightsLabels","containerRightsLabels","useStyles","makeStyles","list","padding","width","option","AddPermissionsForm","classes","translate","useTranslate","useState","setValue","inputValue","setInputValue","options","setOptions","useGetList","page","perPage","field","order","q","enabled","ids","data","useEffect","Object","values","React","Autocomplete","getOptionLabel","filterOptions","x","keys","noOptionsText","autoComplete","blurOnSelect","clearOnBlur","disableClearable","onChange","event","record","onInputChange","newInputValue","renderInput","TextField","label","variant","margin","fullWidth","renderOption","List","dense","className","ListItem","button","ListItemAvatar","Avatar","src","image","PersonIcon","ListItemText","primary","AgentIcon","PublicIcon","VpnLockIcon","GroupIcon","listItem","paddingLeft","paddingRight","primaryText","whiteSpace","overflow","textOverflow","secondaryText","textAlign","fontStyle","color","AgentItem","isContainer","dataProvider","useDataProvider","anchorEl","setAnchorEl","user","setUser","loading","setLoading","setError","getOne","then","closeMenu","labels","Loading","permissions","p","ListItemSecondaryAction","IconButton","onClick","currentTarget","EditIcon","Menu","keepMounted","open","Boolean","onClose","entries","rightKey","rightLabel","hasPermission","MenuItem","key","ListItemIcon","CheckIcon","theme","maxWidth","backgroundColor","palette","background","paper","EditPermissionsForm","useAgents","usePermissionsOptimized","useAuthProvider","setAgents","result","appendPermission","forEach","userUri","groupUri","useCallback","prevAgents","_agents$agentId","fromEntries","m","title","paddingBottom","actions","addForm","paddingTop","listForm","maxHeight","PermissionsDialog","Dialog","DialogTitle","DialogContent","DialogActions","Button","PermissionsButton","resource","showDialog","setShowDialog","ShareIcon","EditActions","basePath","hasList","hasShow","hasControl","otherProps","TopToolbar","ListButton","ShowButton","toolbar","flex","display","justifyContent","EditToolbarWithPermissions","hasDelete","rest","Toolbar","SaveButton","DeleteButton","undoable","EditWithPermissions","props","RaEdit","some","cloneElement","children","ListWithPermissions","hasCreate","bulkActions","defaultProps","ListActions","ShowActions","hasEdit","EditButton","ShowWithPermissions","RaShow","main","flexDirection","minHeight","alignItems","card","minWidth","marginTop","lockIconAvatar","lockIcon","secondary","LoginPage","history","buttons","userResource","notify","useNotify","useLogin","searchParams","URLSearchParams","search","has","setItem","get","removeItem","ThemeProvider","createMuiTheme","Card","LockIcon","CardActions","type","Notification","startIcon","LogoutButton","forwardRef","ref","useLogout","ExitIcon","ResourceWithPermission","create","Resource","ViewProfileMenu","MenuItemLink","to","leftIcon","AccountCircleIcon","EditProfileMenu","LoginMenu","UserMenu","identity","useGetIdentity","RaUserMenu","frenchMessages","auth","dialog","container_permissions","resource_permissions","action","right","read","append","write","control","container","anonymous","authenticated","input","agent_select"],"mappings":"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"}