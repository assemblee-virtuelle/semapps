import*as e from"react";import t,{useEffect as r,useState as n,useCallback as a,useMemo as o,forwardRef as i}from"react";import{useGetIdentity as c,usePermissionsOptimized as s,useNotify as u,useRedirect as l,Create as d,CreateActions as p,useTranslate as m,useGetList as f,useDataProvider as h,Loading as g,Error as v,useAuthProvider as b,Button as y,TopToolbar as w,ListButton as _,ShowButton as E,useRecordContext as x,DeleteButton as j,Toolbar as k,SaveButton as P,Edit as O,useResourceDefinition as C,CreateButton as S,ExportButton as A,List as R,EditButton as I,Show as T,useLogin as N,Notification as U,useLocale as z,useSafeSetState as L,LoginForm as W,useLogout as D,Resource as V,UserMenu as F,MenuItemLink as B,useGetPermissions as q}from"react-admin";import{useCreateContainer as M}from"@semapps/semantic-data-provider";import $ from"@material-ui/icons/Share";import{makeStyles as Y,TextField as H,List as J,ListItem as G,ListItemAvatar as K,Avatar as Q,ListItemText as X,ListItemSecondaryAction as Z,IconButton as ee,Menu as te,MenuItem as re,ListItemIcon as ne,Dialog as ae,DialogTitle as oe,DialogContent as ie,DialogActions as ce,useMediaQuery as se,DialogContentText as ue,Button as le,Card as de,Typography as pe,CardActions as me,Box as fe,Divider as he,createTheme as ge,ThemeProvider as ve,CircularProgress as be}from"@material-ui/core";import ye from"@material-ui/lab/Autocomplete";import we from"@material-ui/icons/Person";import _e from"@material-ui/icons/Edit";import Ee from"@material-ui/icons/Check";import xe from"@material-ui/icons/Public";import je from"@material-ui/icons/VpnLock";import ke from"@material-ui/icons/Group";import{ThemeProvider as Pe}from"@material-ui/styles";import{makeStyles as Oe,createTheme as Ce}from"@material-ui/core/styles";import Se from"@material-ui/icons/Lock";import Ae from"@material-ui/icons/Storage";import{useLocation as Re,Redirect as Ie,Link as Te}from"react-router-dom";import{Form as Ne,Field as Ue}from"react-final-form";import ze from"@material-ui/icons/PowerSettingsNew";import Le from"@material-ui/icons/AccountCircle";function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach((function(t){Be(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ve(e,t,r,n,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function Fe(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Ve(o,n,a,i,c,"next",e)}function c(e){Ve(o,n,a,i,c,"throw",e)}i(void 0)}))}}function Be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Me(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function $e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,o=[],i=!0,c=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(c)throw a}}return o}(e,t)||He(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e){return function(e){if(Array.isArray(e))return Je(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||He(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){if(e){if("string"==typeof e)return Je(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Je(e,t):void 0}}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ge(e){this.message=e}Ge.prototype=new Error,Ge.prototype.name="InvalidCharacterError";var Ke="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Ge("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,a=0,o=0,i="";n=t.charAt(o++);~n&&(r=a%4?64*r+n:n,a++%4)?i+=String.fromCharCode(255&r>>(-2*a&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function Qe(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Ke(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Ke(t)}}function Xe(e){this.message=e}function Ze(e,t){if("string"!=typeof e)throw new Xe("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(Qe(e.split(".")[r]))}catch(e){throw new Xe("Invalid token specified: "+e.message)}}Xe.prototype=new Error,Xe.prototype.name="InvalidTokenError";var et="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function tt(e,t){return e(t={exports:{}},t.exports),t.exports}var rt,nt,at=tt((function(e){var t,r;t=et,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var a=e[n];if("string"!=typeof a)throw new TypeError("Url must be a string. Received "+a);""!==a&&(n>0&&(a=a.replace(/^[\/]+/,"")),a=n<e.length-1?a.replace(/[\/]+$/,""):a.replace(/[\/]+$/,"/"),t.push(a))}var o=t.join("/"),i=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),ot=function(e){return e?Array.isArray(e)?e:[e]:void 0},it=function(e){var t=new URL(e);return at(t.origin,"_acl",t.pathname)},ct=function(e){return{"@base":e,acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/","acl:agent":{"@type":"@id"},"acl:agentGroup":{"@type":"@id"},"acl:agentClass":{"@type":"@id"},"acl:mode":{"@type":"@id"},"acl:accessTo":{"@type":"@id"}}},st=function(){var e=Fe(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDataServers();case 2:if(r=e.sent,n=Object.values(r).find((function(e){return!0===e.authServer}))){e.next=6;break}throw new Error("Could not find a server with authServer: true. Check your dataServers config.");case 6:return e.abrupt("return",n.pod?new URL(n.baseUrl).origin:n.baseUrl);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ut=["username","email","password","domain"],lt=function(e){var t,r,n,a,o,i,c,s,u,l,d,p,m=e.dataProvider,f=e.allowAnonymous,h=void 0===f||f,g=e.localAccounts,v=void 0!==g&&g,b=e.checkUser,y=e.checkPermissions,w=void 0!==y&&y;return{login:(p=Fe(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(m);case 2:if(r=e.sent,!v){e.next=20;break}return n=t.username,a=t.password,e.prev=5,e.next=8,m.fetch(at(r,"auth/login"),{method:"POST",body:JSON.stringify({username:n.trim(),password:a.trim()}),headers:new Headers({"Content-Type":"application/json"})});case 8:o=e.sent,i=o.json,c=i.token,localStorage.setItem("token",c),window.location.reload(),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(5),new Error("ra.auth.sign_in_error");case 18:e.next=23;break;case 20:s=new URL(window.location.href).origin+"/login?login=true",t.redirect&&(s+="&redirect="+encodeURIComponent(t.redirect)),window.location.href=at(r,"auth?redirectUrl="+encodeURIComponent(s));case 23:case"end":return e.stop()}}),e,null,[[5,15]])}))),function(e){return p.apply(this,arguments)}),signup:(d=Fe(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,c,s,u,l,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(m);case 2:if(r=e.sent,!v){e.next=33;break}return n=t.username,a=t.email,o=t.password,i=Me(t,ut),e.prev=5,e.next=8,m.fetch(at(r,"auth/signup"),{method:"POST",body:JSON.stringify(De({username:n.trim(),email:a.trim(),password:o.trim()},i)),headers:new Headers({"Content-Type":"application/json"})});case 8:return c=e.sent,s=c.json,u=s.token,localStorage.setItem("token",u),l=Ze(u),d=l.webId,e.abrupt("return",d);case 16:if(e.prev=16,e.t0=e.catch(5),"email.already.exists"!==e.t0.message){e.next=22;break}throw new Error("auth.message.user_email_exist");case 22:if("username.already.exists"!==e.t0.message){e.next=26;break}throw new Error("auth.message.username_exist");case 26:if("username.invalid"!==e.t0.message){e.next=30;break}throw new Error("auth.message.username_invalid");case 30:throw new Error(e.t0.message||"ra.auth.sign_in_error");case 31:e.next=35;break;case 33:p=new URL(window.location.href).origin+"/login?login=true",window.location.href=at(r,"auth?redirectUrl="+encodeURIComponent(p));case 35:case"end":return e.stop()}}),e,null,[[5,16]])}))),function(e){return d.apply(this,arguments)}),logout:(l=Fe(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(m);case 2:return t=e.sent,localStorage.clear(),v?(window.location.reload(),window.location.href="/"):(r=new URL(window.location.href).origin,window.location.href=at(t,h?"auth/logout?redirectUrl="+encodeURIComponent(r+"/login?logout=true"):"auth/logout?redirectUrl="+encodeURIComponent(r+"/login"))),e.abrupt("return","/");case 6:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),checkAuth:(u=Fe(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("token")||h){e.next=3;break}throw new Error;case 3:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)}),checkUser:function(e){return!b||b(e)},checkError:function(e){return Promise.resolve()},getPermissions:(s=Fe(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w){e.next=2;break}return e.abrupt("return",!0);case 2:if(t&&t.startsWith("http")){e.next=4;break}throw new Error("The first parameter passed to getPermissions must be an URL");case 4:return r=it(t),e.prev=5,e.next=8,m.fetch(r);case 8:return n=e.sent,a=n.json,e.abrupt("return",a["@graph"]);case 13:return e.prev=13,e.t0=e.catch(5),console.warn("Could not fetch ACL URI ".concat(t)),e.abrupt("return",[]);case 17:case"end":return e.stop()}}),e,null,[[5,13]])}))),function(e){return s.apply(this,arguments)}),addPermission:(c=Fe(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.startsWith("http")){e.next=2;break}throw new Error("The first parameter passed to addPermission must be an URL");case 2:return i=it(t),Be(o={"@id":"#"+a.replace("acl:",""),"@type":"acl:Authorization"},n,r),Be(o,"acl:accessTo",t),Be(o,"acl:mode",a),c=o,e.next=6,m.fetch(i,{method:"PATCH",body:JSON.stringify({"@context":ct(i),"@graph":[c]})});case 6:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return c.apply(this,arguments)}),removePermission:(i=Fe(regeneratorRuntime.mark((function e(t,r,n,a){var o,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.startsWith("http")){e.next=2;break}throw new Error("The first parameter passed to removePermission must be an URL");case 2:return o=it(t),e.next=5,m.fetch(o);case 5:return i=e.sent,c=i.json,s=c["@graph"].filter((function(e){return!e["@id"].includes("#Default")})).map((function(e){var t=ot(e["acl:mode"]),o=ot(e[n]);return a&&t.includes(a)&&o&&o.includes(r)&&(o=o.filter((function(e){return e!==r}))),De(De({},e),{},Be({},n,o))})),e.next=10,m.fetch(o,{method:"PUT",body:JSON.stringify({"@context":ct(o),"@graph":s})});case 10:case"end":return e.stop()}}),e)}))),function(e,t,r,n){return i.apply(this,arguments)}),getIdentity:(o=Fe(regeneratorRuntime.mark((function e(){var t,r,n,a,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("token"))){e.next=17;break}return r=Ze(t),n=r.webId,e.next=5,m.fetch(n);case 5:if(a=e.sent,!(o=a.json).url){e.next=13;break}return e.next=10,m.fetch(o.url);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0={};case 14:return i=e.t0,c=i.json,e.abrupt("return",{id:n,fullName:(null==c?void 0:c["vcard:given-name"])||(null==c?void 0:c["pair:label"])||o["foaf:name"],profileData:c,webIdData:o});case 17:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)}),resetPassword:(a=Fe(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,e.next=3,st(m);case 3:return n=e.sent,e.prev=4,e.next=7,m.fetch(at(n,"auth/reset_password"),{method:"POST",body:JSON.stringify({email:r.trim()}),headers:new Headers({"Content-Type":"application/json"})});case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),new Error("app.notification.reset_password_error");case 12:case"end":return e.stop()}}),e,null,[[4,9]])}))),function(e){return a.apply(this,arguments)}),setNewPassword:(n=Fe(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.email,n=t.token,a=t.password,e.next=3,st(m);case 3:return o=e.sent,e.prev=4,e.next=7,m.fetch(at(o,"auth/new_password"),{method:"POST",body:JSON.stringify({email:r.trim(),token:n,password:a}),headers:new Headers({"Content-Type":"application/json"})});case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),new Error("app.notification.new_password_error");case 12:case"end":return e.stop()}}),e,null,[[4,9]])}))),function(e){return n.apply(this,arguments)}),getAccountSettings:(r=Fe(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(m);case 2:return r=e.sent,e.prev=3,e.next=6,m.fetch(at(r,"auth/account"));case 6:return n=e.sent,a=n.json,e.abrupt("return",a);case 11:throw e.prev=11,e.t0=e.catch(3),new Error("app.notification.get_settings_error");case 14:case"end":return e.stop()}}),e,null,[[3,11]])}))),function(e){return r.apply(this,arguments)}),updateAccountSettings:(t=Fe(regeneratorRuntime.mark((function e(t){var r,n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(m);case 2:return r=e.sent,e.prev=3,n=t.email,a=t.currentPassword,o=t.newPassword,e.next=7,m.fetch(at(r,"auth/account"),{method:"POST",body:JSON.stringify({currentPassword:a,email:n.trim(),newPassword:o}),headers:new Headers({"Content-Type":"application/json"})});case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(3),"auth.account.invalid_password"!==e.t0.message){e.next=13;break}throw new Error("app.notification.invalid_password");case 13:throw new Error("app.notification.update_settings_error");case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),function(e){return t.apply(this,arguments)})}},dt="acl:agentClass",pt=["acl:Append","acl:Write","acl:Control"],mt=["acl:Append","acl:Write","acl:Control"],ft=["acl:Write","acl:Control"],ht=["acl:Control"],gt={show:["acl:Read","acl:Append","acl:Write","acl:Control"],list:["acl:Read","acl:Append","acl:Write","acl:Control"],create:pt,edit:mt,delete:ft,control:ht},vt={show:"auth.message.resource_show_forbidden",edit:"auth.message.resource_edit_forbidden",delete:"auth.message.resource_delete_forbidden",control:"auth.message.resource_control_forbidden",list:"auth.message.container_list_forbidden",create:"auth.message.container_create_forbidden"},bt=(Be(rt={},"acl:Read","auth.right.resource.read"),Be(rt,"acl:Append","auth.right.resource.append"),Be(rt,"acl:Write","auth.right.resource.write"),Be(rt,"acl:Control","auth.right.resource.control"),rt),yt=(Be(nt={},"acl:Read","auth.right.container.read"),Be(nt,"acl:Write","auth.right.container.write"),Be(nt,"acl:Control","auth.right.container.control"),nt),wt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",a=c(),o=a.identity,i=a.loading,d=s(e),p=d.permissions,m=u(),f=l();return r((function(){!i&&o&&p&&!p.some((function(e){return gt[t].includes(e["acl:mode"])}))&&(m(vt[t],"error"),f(n))}),[p,o,f,m,i]),p},_t=function(e){var r=M(e.resource);return wt(r,"create"),t.createElement(d,e)};_t.defaultProps={actions:t.createElement(p,null)};var Et=Y((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),xt=function(e){var a=e.agents,o=e.addPermission,i=Et(),c=m(),s=$e(n(null),2),u=s[0],l=s[1],d=$e(n(""),2),p=d[0],h=d[1],g=$e(n([]),2),v=g[0],b=g[1],y=f("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:p},{enabled:p.length>0}),w=y.ids,_=y.data;return r((function(){b(w.length>0?Object.values(_):[])}),[w,_]),t.createElement(ye,{classes:{option:i.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e.filter((function(e){return!Object.keys(a).includes(e.id)}))},options:v,noOptionsText:c("ra.navigation.no_results"),autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:u,onChange:function(e,t){o(t.id||t["@id"],"acl:agent","acl:Read"),l(null),h(""),b([])},onInputChange:function(e,t){h(t)},renderInput:function(e){return t.createElement(H,qe({},e,{label:c("auth.input.agent_select"),variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(e){return t.createElement(J,{dense:!0,className:i.list},t.createElement(G,{button:!0},t.createElement(K,null,t.createElement(Q,{src:e.image},t.createElement(we,null))),t.createElement(X,{primary:e["pair:label"]})))}})},jt=function(e){var r=e.agent;switch(r.predicate){case dt:return"foaf:Agent"===r.id?t.createElement(xe,null):t.createElement(je,null);case"acl:agent":return t.createElement(we,null);case"acl:agentGroup":return t.createElement(ke,null);default:throw new Error("Unknown agent predicate: "+r.predicate)}},kt=Y((function(){return{listItem:{paddingLeft:4,paddingRight:36},primaryText:{width:"30%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},secondaryText:{textAlign:"center",width:"60%",fontStyle:"italic",color:"grey"}}})),Pt=function(e){var a=e.isContainer,o=e.agent,i=e.addPermission,c=e.removePermission,s=kt(),u=m(),l=h(),d=$e(t.useState(null),2),p=d[0],f=d[1],b=$e(n(),2),y=b[0],w=b[1],_=$e(n(!0),2),E=_[0],x=_[1],j=$e(n(),2),k=j[0],P=j[1];if(r((function(){"acl:agent"===o.predicate?l.getOne("Person",{id:o.id}).then((function(e){var t=e.data;w(t),x(!1)})).catch((function(e){P(e),x(!1)})):x(!1)}),[o.id,o.predicate]),"acl:agentGroup"===o.predicate)return null;var O=function(){return f(null)},C=a?yt:bt;return E?t.createElement(g,null):k?t.createElement(v,null):t.createElement(G,{className:s.listItem},t.createElement(K,null,t.createElement(Q,{src:null==y?void 0:y.image},t.createElement(jt,{agent:o}))),t.createElement(X,{className:s.primaryText,primary:y?y["pair:label"]:u("foaf:Agent"===o.id?"auth.agent.anonymous":"auth.agent.authenticated")}),t.createElement(X,{className:s.secondaryText,primary:o.permissions&&o.permissions.map((function(e){return u(C[e])})).join(", ")}),t.createElement(Z,null,t.createElement(ee,{onClick:function(e){return f(e.currentTarget)}},t.createElement(_e,null)),t.createElement(te,{anchorEl:p,keepMounted:!0,open:Boolean(p),onClose:O},Object.entries(C).map((function(e){var r=$e(e,2),n=r[0],a=r[1],s=o.permissions&&o.permissions.includes(n);return t.createElement(re,{key:n,onClick:function(){s?c(o.id,o.predicate,n):i(o.id,o.predicate,n),O()}},t.createElement(ne,null,s?t.createElement(Ee,null):null),t.createElement(X,{primary:u(a)}))})))))},Ot=Y((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),Ct=function(e){var r=e.isContainer,n=e.agents,a=e.addPermission,o=e.removePermission,i=Ot();return t.createElement(J,{dense:!0,className:i.list},Object.entries(n).map((function(e){var n=$e(e,2),i=n[0],c=n[1];return t.createElement(Pt,{key:i,isContainer:r,agent:c,addPermission:a,removePermission:o})})))},St=function(e){var t=s(e).permissions,o=b(),i=$e(n({}),2),c=i[0],u=i[1];r((function(){var e,r=(Be(e={},"foaf:Agent",{id:"foaf:Agent",predicate:dt,permissions:[]}),Be(e,"acl:AuthenticatedAgent",{id:"acl:AuthenticatedAgent",predicate:dt,permissions:[]}),e),n=function(e,t,n){r[e]?r[e].permissions.push(n):r[e]={id:e,predicate:t,permissions:[n]}};if(t){var a,o=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=He(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}(t);try{var i=function(){var e=a.value;e[dt]&&ot(e[dt]).forEach((function(t){return n(t,dt,e["acl:mode"])})),e["acl:agent"]&&ot(e["acl:agent"]).forEach((function(t){return n(t,"acl:agent",e["acl:mode"])})),e["acl:agentGroup"]&&ot(e["acl:agentGroup"]).forEach((function(t){return n(t,"acl:agentGroup",e["acl:mode"])}))};for(o.s();!(a=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}u(r)}}),[t]);var l=a((function(t,r,n){var a,i=De({},c);u(De(De({},c),{},Be({},t,{id:t,predicate:r,permissions:c[t]?[].concat(Ye(null===(a=c[t])||void 0===a?void 0:a.permissions),[n]):[n]}))),o.addPermission(e,t,r,n).catch((function(e){u(i)}))}),[c,u,e,o]),d=a((function(t,r,n){var a=De({},c);u(Object.fromEntries(Object.entries(c).map((function(e){var r=$e(e,2),a=r[0],o=r[1];return o.id===t&&(o.permissions=o.permissions.filter((function(e){return e!==n}))),[a,o]})).filter((function(e){var t=$e(e,2);t[0];var r=t[1];return r.predicate===dt||r.permissions.length>0})))),o.removePermission(e,t,r,n).catch((function(e){u(a)}))}),[c,u,e,o]);return{agents:c,addPermission:l,removePermission:d}},At=Y((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),Rt=function(e){var r=e.open,n=e.onClose,a=e.uri,o=e.isContainer,i=At(),c=m(),s=St(a),u=s.agents,l=s.addPermission,d=s.removePermission;return t.createElement(ae,{fullWidth:!0,open:r,onClose:n},t.createElement(oe,{className:i.title},c(o?"auth.dialog.container_permissions":"auth.dialog.resource_permissions")),t.createElement(ie,{className:i.addForm},t.createElement(xt,{agents:u,addPermission:l})),t.createElement(ie,{className:i.listForm},t.createElement(Ct,{isContainer:o,agents:u,addPermission:l,removePermission:d})),t.createElement(ce,{className:i.actions},t.createElement(y,{label:"ra.action.close",variant:"text",onClick:n})))},It=function(e){var r=e.record,a=e.resource,o=$e(n(!1),2),i=o[0],c=o[1],s=M(a),u=!!a,l=u?s:r.id||r["@id"];return t.createElement(t.Fragment,null,t.createElement(y,{label:"auth.action.permissions",onClick:function(){return c(!0)}},t.createElement($,null)),t.createElement(Rt,{uri:l,isContainer:!!u,open:i,onClose:function(){return c(!1)}}))},Tt=function(e){var r=e.basePath,n=e.record,a=e.hasList,o=e.hasShow,i=s(null==n?void 0:n.id).permissions;return t.createElement(w,null,a&&t.createElement(_,{basePath:r,record:n}),o&&t.createElement(E,{basePath:r,record:n}),!!i&&i.some((function(e){return ht.includes(e["acl:mode"])}))&&t.createElement(It,{basePath:r,record:n}))},Nt=function(e){var r=x(),n=s(null==r?void 0:r.id).permissions;return n&&n.some((function(e){return ft.includes(e["acl:mode"])}))?t.createElement(j,e):null},Ut=Y((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),zt=function(e){var r=Ut();return t.createElement(k,qe({},e,{className:r.toolbar}),t.createElement(P,null),t.createElement(Nt,{undoable:!1}),"}")},Lt=function(e){return wt(e.id,"edit"),t.createElement(O,e,t.cloneElement(e.children,De({toolbar:t.createElement(zt,null)},e.children.props)))};Lt.defaultProps={actions:t.createElement(Tt,null)};var Wt=["bulkActions","basePath","currentSort","displayedFilters","exporter","filters","filterValues","onUnselectItems","resource","selectedIds","showFilter","total"],Dt=function(e){var r=e.bulkActions,n=e.basePath,a=e.currentSort,o=e.displayedFilters,i=e.exporter,c=e.filters,u=e.filterValues,l=e.onUnselectItems,d=e.resource,p=e.selectedIds,m=e.showFilter,f=e.total,h=Me(e,Wt),g=se((function(e){return e.breakpoints.down("xs")})),v=C(h),b=M(d),y=s(b).permissions;return t.createElement(w,null,c&&t.cloneElement(c,{resource:d,showFilter:m,displayedFilters:o,filterValues:u,context:"button"}),v.hasCreate&&y&&y.some((function(e){return pt.includes(e["acl:mode"])}))&&t.createElement(S,{basePath:n}),y&&y.some((function(e){return ht.includes(e["acl:mode"])}))&&t.createElement(It,{basePath:n,record:b}),!g&&!1!==i&&t.createElement(A,{disabled:0===f,resource:d,sort:a,filter:u,exporter:i}),r&&t.cloneElement(r,{basePath:n,filterValues:u,resource:d,selectedIds:p,onUnselectItems:l}))},Vt=function(e){return t.createElement(R,e)};Vt.defaultProps={actions:t.createElement(Dt,null)};var Ft=function(e){var r=e.basePath,n=e.record,a=e.hasList,o=e.hasEdit,i=s(null==n?void 0:n.id).permissions;return t.createElement(w,null,a&&t.createElement(_,{basePath:r,record:n}),o&&i&&i.some((function(e){return mt.includes(e["acl:mode"])}))&&t.createElement(I,{basePath:r,record:n}),i&&i.some((function(e){return ht.includes(e["acl:mode"])}))&&t.createElement(It,{basePath:r,record:n}))},Bt=function(e){return wt(e.id,"edit"),t.createElement(T,e)};Bt.defaultProps={actions:t.createElement(Ft,null)};var qt=["open","onClose","title","message","redirect"],Mt=function(e){var r=e.open,n=e.onClose,a=e.title,o=e.message,i=e.redirect,c=Me(e,qt),s=N(),u=m();return t.createElement(ae,qe({open:r,onClose:n},c),t.createElement(oe,null,u(a)),t.createElement(ie,null,t.createElement(ue,null,u(o))),t.createElement(ce,null,t.createElement(le,{onClick:n},u("ra.action.cancel")),t.createElement(le,{onClick:function(){return s({redirect:i||window.location.pathname+window.location.search})},color:"primary",variant:"contained"},u("auth.action.login"))))};Mt.defaultProps={title:"auth.dialog.login_required",message:"auth.message.login_to_continue"};var $t=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Yt=Oe((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.grey[300]},text:{maxWidth:300,textAlign:"center",padding:"4px 8px 8px"},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.grey[500]}}})),Ht=function(e){var n=e.theme,a=e.history,o=e.location,i=e.buttons,c=e.userResource,s=e.propertiesExist,l=e.text,d=Yt(),p=u(),m=N(),f=h(),g=b();return r((function(){Fe(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=new URLSearchParams(o.search)).has("login")){e.next=8;break}if(!t.has("error")){e.next=6;break}"registration.not-allowed"===t.get("error")?p("auth.message.user_email_not_found","error"):p("auth.message.bad_request","error",{error:t.get("error")}),e.next=8;break;case 6:if(!t.has("token")){e.next=8;break}return e.delegateYield(regeneratorRuntime.mark((function e(){var r,n,o,i,u,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.get("token"),n=Ze(r),o=n.webId,localStorage.setItem("token",r),e.next=5,f.getOne(c,{id:o});case 5:if(u=e.sent,i=u.data,!(s.length>0)){e.next=20;break}l=s.every((function(e){return i[e]}));case 9:if(l){e.next=20;break}return console.log("Waiting for all properties to have been created",s),e.next=13,$t(500);case 13:return e.next=15,f.getOne(c,{id:o});case 15:d=e.sent,i=d.data,l=s.every((function(e){return i[e]})),e.next=9;break;case 20:g.checkUser(i)?t.has("redirect")?(p("auth.message.user_connected","info"),a.push(t.get("redirect"))):t.has("new")&&"true"===t.get("new")?(p("auth.message.new_user_created","info"),a.push("/"+c+"/"+encodeURIComponent(o)+"/edit")):(p("auth.message.user_connected","info"),a.push("/")):(localStorage.removeItem("token"),p("auth.message.user_not_allowed_to_login","error"),a.replace("/login"));case 21:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:t.has("logout")&&(localStorage.clear(),p("auth.message.user_disconnected","info"),a.push("/"));case 9:case"end":return e.stop()}}),e)})))()}),[o.search]),t.createElement(Pe,{theme:Ce(n)},t.createElement("div",{className:d.main},t.createElement(de,{className:d.card},t.createElement("div",{className:d.lockIconAvatar},t.createElement(Q,{className:d.lockIcon},t.createElement(Se,null))),l&&t.createElement(pe,{variant:"body2",className:d.text},l),i&&i.map((function(e,r){return t.createElement(me,{key:r},t.cloneElement(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return m({},"/login")}}))})))),t.createElement(U,null))};Ht.defaultProps={propertiesExist:[],buttons:[t.createElement(le,{startIcon:t.createElement(Q,{src:"/lescommuns.jpg"})},"Les Communs")],userResource:"Person"};var Jt=Y((function(e){return{"@global":{body:{backgroundColor:e.palette.primary.main}},text:{textAlign:"center",padding:"4px 8px 8px"},card:Be({minWidth:300,maxWidth:350,marginTop:"6em"},e.breakpoints.down("sm"),{margin:"1em"}),lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.grey[500]},list:{paddingTop:0,paddingBottom:0},listItem:{paddingTop:5,paddingBottom:5}}})),Gt=function(e){var a=e.history,o=e.location,i=e.text,c=e.customPodProviders,s=Jt(),l=u(),d=z(),p=m(),f=b(),g=h(),v=$e(n(c||[]),2),y=v[0],w=v[1],_=new URLSearchParams(o.search);return r((function(){Fe(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==y.length){e.next=13;break}return e.next=3,fetch("https://data.activitypods.org/pod-providers",{headers:{Accept:"application/ld+json"}});case 3:if(!(t=e.sent).ok){e.next=12;break}return e.next=7,t.json();case 7:r=e.sent,n=r["ldp:contains"].filter((function(e){return Array.isArray(e["apods:locales"])?e["apods:locales"].includes(d):e["apods:locales"]===d})),w(n),e.next=13;break;case 12:l("auth.message.pod_providers_not_loaded","error");case 13:case"end":return e.stop()}}),e)})))()}),[y,w,l,d]),r((function(){Fe(regeneratorRuntime.mark((function e(){var t,r,n,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_.has("token")){e.next=16;break}return t=_.get("token"),r=Ze(t),n=r.webId,e.next=5,fetch(n,{headers:{Accept:"application/json"}});case 5:if((o=e.sent).ok){e.next=10;break}l("auth.message.unable_to_fetch_user_data","error"),e.next=14;break;case 10:return e.next=12,o.json();case 12:i=e.sent,f.checkUser(i)?(localStorage.setItem("token",t),l("auth.message.user_connected","info"),window.location.reload(),window.location.href="/?addUser=true"):(l("auth.message.user_not_allowed_to_login","error"),a.replace("/login"));case 14:e.next=17;break;case 16:_.has("logout")&&(localStorage.clear(),l("auth.message.user_disconnected","info"),a.push("/"));case 17:case"end":return e.stop()}}),e)})))()}),[_,g]),_.has("token")||_.has("addUser")||_.has("logout")?null:t.createElement(fe,{display:"flex",flexDirection:"column",alignItems:"center"},t.createElement(de,{className:s.card},t.createElement("div",{className:s.lockIconAvatar},t.createElement(Q,{className:s.lockIcon},t.createElement(Se,null))),t.createElement(fe,{pl:2,pr:2},t.createElement(pe,{variant:"body2",className:s.text},i||p("auth.message.choose_pod_provider"))),t.createElement(fe,{m:2},t.createElement(J,{className:s.list},y.map((function(e,r){var n=new URL("/auth",(e["apods:domainName"].includes(":")?"http://":"https://")+e["apods:domainName"]);return _.has("signup")&&n.searchParams.set("signup","true"),n.searchParams.set("redirect",window.location.href),t.createElement(t.Fragment,{key:r},t.createElement(he,null),t.createElement(G,{key:r,button:!0,onClick:function(){return window.location.href=n.toString()},className:s.listItem},t.createElement(K,null,t.createElement(Q,null,t.createElement(Ae,null))),t.createElement(X,{primary:e["apods:domainName"],secondary:e["apods:area"]})))}))))))},Kt=function(e){var r=o((function(){return ge(e.theme)}),[e.theme]);return t.createElement(ve,{theme:r},t.createElement(Gt,e),t.createElement(U,null))};function Qt(){}function Xt(){}Xt.resetWarningCache=Qt;var Zt=function(){function e(e,t,r,n,a,o){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==o){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Xt,resetWarningCache:Qt};return r.PropTypes=r,r},er=tt((function(e){e.exports=Zt()})),tr=tt((function(e){
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){var t={}.hasOwnProperty;function r(){for(var e=[],n=0;n<arguments.length;n++){var a=arguments[n];if(a){var o=typeof a;if("string"===o||"number"===o)e.push(a);else if(Array.isArray(a)){if(a.length){var i=r.apply(null,a);i&&e.push(i)}}else if("object"===o)if(a.toString===Object.prototype.toString)for(var c in a)t.call(a,c)&&a[c]&&e.push(c);else e.push(a.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r}()})),rr=function(){var e=b();return a((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.signup(t)}),[e])},nr=["meta","input"],ar=Y((function(e){return{form:{padding:"0 1em 1em 1em"},input:{marginTop:"1em"},button:{width:"100%"},icon:{marginRight:e.spacing(1)}}})),or=function(t){var r=t.meta,n=r.touched,a=r.error,o=t.input,i=Me(t,nr);return e.createElement(H,qe({error:!(!n||!a),helperText:n&&a},o,i,{fullWidth:!0}))},ir=function(t){var r=t.redirectTo,n=t.delayBeforeRedirect,a=$e(L(!1),2),o=a[0],i=a[1],c=rr(),s=m(),l=u(),d=ar(),p=Re(),f=new URLSearchParams(p.search);return e.createElement(Ne,{onSubmit:function(e){i(!0),c(e).then((function(e){n?setTimeout((function(){window.location.reload(),window.location.href=r||"/",i(!1)}),n):(window.location.reload(),window.location.href=r||"/",i(!1)),l("auth.message.new_user_created","info")})).catch((function(e){i(!1),l("string"==typeof e?e:void 0!==e&&e.message?e.message:"ra.auth.sign_in_error","warning",{_:"string"==typeof e?e:e&&e.message?e.message:void 0})}))},validate:function(e){var t={email:void 0,password:void 0};return e.email||(t.email=s("ra.validation.required")),e.password||(t.password=s("ra.validation.required")),t},initialValues:{email:f.get("email")},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r,noValidate:!0},e.createElement("div",{className:d.form},e.createElement("div",{className:d.input},e.createElement(Ue,{id:"username",name:"username",component:or,label:s("auth.input.username"),disabled:o})),e.createElement("div",{className:d.input},e.createElement(Ue,{id:"email",name:"email",component:or,label:s("auth.input.email"),disabled:o||f.has("email")&&f.has("force-email")})),e.createElement("div",{className:d.input},e.createElement(Ue,{id:"password",name:"password",component:or,label:s("ra.auth.password"),type:"password",disabled:o}))),e.createElement(me,null,e.createElement(le,{variant:"contained",type:"submit",color:"primary",disabled:o,className:d.button},o&&e.createElement(be,{className:d.icon,size:18,thickness:2}),s("auth.action.signup"))))}})};ir.propTypes={redirectTo:er.string};var cr=["theme","title","classes","className"],sr=Y((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",height:"1px",alignItems:"center",justifyContent:"flex-start",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundImage:"radial-gradient(circle at 50% 14em, #313264 0%, #00023b 60%, #00023b 100%)"},card:{minWidth:300,marginTop:"6em"},avatar:{margin:"1em",display:"flex",justifyContent:"center"},icon:{backgroundColor:e.palette.secondary[500]},switch:{margin:"1em",display:"flex",justifyContent:"center"}}})),ur=function(e){var r=e.theme;e.title,e.classes;var n=e.className,a=Me(e,cr),i=sr(e),s=Re(),u=m(),l=o((function(){return ge(r)}),[r]),d=new URLSearchParams(s.search),p=d.has("signup"),f=d.get("redirect"),h=c(),g=h.identity;return h.loading?null:null!=g&&g.id?t.createElement(Ie,{to:f||"/"}):t.createElement(ve,{theme:l},t.createElement("div",qe({className:tr(i.main,n)},a),t.createElement(de,{className:i.card},t.createElement("div",{className:i.avatar},t.createElement(Q,{className:i.icon},t.createElement(Se,null))),p?t.createElement(ir,{redirectTo:f,delayBeforeRedirect:3e3}):t.createElement(W,{redirectTo:f}),t.createElement("div",{className:i.switch},p?t.createElement(Te,{to:"/login"},t.createElement(pe,{variant:"body2"},u("auth.action.login"))):t.createElement(Te,{to:"/login?signup=true"},t.createElement(pe,{variant:"body2"},u("auth.action.signup"))))),t.createElement(U,null)))};ur.propTypes={children:er.node,classes:er.object,className:er.string,theme:er.object};var lr=Y((function(e){return{root:{color:e.palette.text.secondary},active:{color:e.palette.text.primary},icon:{minWidth:e.spacing(5)}}})),dr=i((function(e,r){var n=lr(),a=D(),o=m();return t.createElement(re,{onClick:function(){return a()},ref:r,className:n.root,activeClassName:n.active},t.createElement(ne,{className:n.icon},t.createElement(ze,null)),o("auth.action.logout"))})),pr=["name","create"],mr=function(e){var r=e.name,n=e.create,a=Me(e,pr),o=M(r),i=s(o).permissions;return t.createElement(V,qe({},a,{name:r,create:i&&i.some((function(e){return pt.includes(e["acl:mode"])}))?n:void 0}))},fr=["logout","profileResource"],hr=i((function(e,r){var n=e.onClick,a=e.profileResource,o=e.label,i=e.webId;return t.createElement(B,{ref:r,to:"/".concat(a,"/").concat(encodeURIComponent(i),"/show"),primaryText:o,leftIcon:t.createElement(Le,null),onClick:n})})),gr=i((function(e,r){var n=e.onClick,a=e.profileResource,o=e.label,i=e.webId;return t.createElement(B,{ref:r,to:"/".concat(a,"/").concat(encodeURIComponent(i)),primaryText:o,leftIcon:t.createElement(_e,null),onClick:n})})),vr=i((function(e,r){var n=e.onClick,a=e.label;return t.createElement(B,{ref:r,to:"/login",primaryText:a,onClick:n})})),br=i((function(e,r){var n=e.onClick,a=e.label;return t.createElement(B,{ref:r,to:"/login?signup=true",primaryText:a,onClick:n})})),yr=function(e){var r,n,a=e.logout,o=e.profileResource,i=Me(e,fr),s=c().identity,u=m();return t.createElement(F,i,s&&""!==s.id?[t.createElement(hr,{webId:(null==s||null===(r=s.profileData)||void 0===r?void 0:r.id)||s.id,label:u("auth.action.view_my_profile"),profileResource:o,key:"view"}),t.createElement(gr,{webId:(null==s||null===(n=s.profileData)||void 0===n?void 0:n.id)||s.id,label:u("auth.action.edit_my_profile"),profileResource:o,key:"edit"}),t.cloneElement(a,{key:"logout"})]:[t.createElement(br,{label:u("auth.action.signup"),key:"signup"}),t.createElement(vr,{label:u("auth.action.login"),key:"login"})])};yr.defaultProps={profileResource:"Person"};var wr=function(e){var t=c(),n=t.identity,a=t.loading,o=u(),i=l(),s=Re();return r((function(){a||null!=n&&n.id||(o(e||"ra.auth.auth_check_error","error"),i("/login?redirect="+encodeURIComponent(s.pathname+s.search)))}),[a,n,i,o,s]),{identity:n,loading:a}};var _r=function(){this.__data__=[],this.size=0};var Er=function(e,t){return e===t||e!=e&&t!=t};var xr=function(e,t){for(var r=e.length;r--;)if(Er(e[r][0],t))return r;return-1},jr=Array.prototype.splice;var kr=function(e){var t=this.__data__,r=xr(t,e);return!(r<0)&&(r==t.length-1?t.pop():jr.call(t,r,1),--this.size,!0)};var Pr=function(e){var t=this.__data__,r=xr(t,e);return r<0?void 0:t[r][1]};var Or=function(e){return xr(this.__data__,e)>-1};var Cr=function(e,t){var r=this.__data__,n=xr(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function Sr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Sr.prototype.clear=_r,Sr.prototype.delete=kr,Sr.prototype.get=Pr,Sr.prototype.has=Or,Sr.prototype.set=Cr;var Ar=Sr;var Rr=function(){this.__data__=new Ar,this.size=0};var Ir=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var Tr=function(e){return this.__data__.get(e)};var Nr=function(e){return this.__data__.has(e)},Ur="object"==typeof et&&et&&et.Object===Object&&et,zr="object"==typeof self&&self&&self.Object===Object&&self,Lr=Ur||zr||Function("return this")(),Wr=Lr.Symbol,Dr=Object.prototype,Vr=Dr.hasOwnProperty,Fr=Dr.toString,Br=Wr?Wr.toStringTag:void 0;var qr=function(e){var t=Vr.call(e,Br),r=e[Br];try{e[Br]=void 0;var n=!0}catch(e){}var a=Fr.call(e);return n&&(t?e[Br]=r:delete e[Br]),a},Mr=Object.prototype.toString;var $r=function(e){return Mr.call(e)},Yr=Wr?Wr.toStringTag:void 0;var Hr=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Yr&&Yr in Object(e)?qr(e):$r(e)};var Jr=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Gr,Kr=function(e){if(!Jr(e))return!1;var t=Hr(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Qr=Lr["__core-js_shared__"],Xr=(Gr=/[^.]+$/.exec(Qr&&Qr.keys&&Qr.keys.IE_PROTO||""))?"Symbol(src)_1."+Gr:"";var Zr=function(e){return!!Xr&&Xr in e},en=Function.prototype.toString;var tn=function(e){if(null!=e){try{return en.call(e)}catch(e){}try{return e+""}catch(e){}}return""},rn=/^\[object .+?Constructor\]$/,nn=Function.prototype,an=Object.prototype,on=nn.toString,cn=an.hasOwnProperty,sn=RegExp("^"+on.call(cn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var un=function(e){return!(!Jr(e)||Zr(e))&&(Kr(e)?sn:rn).test(tn(e))};var ln=function(e,t){return null==e?void 0:e[t]};var dn=function(e,t){var r=ln(e,t);return un(r)?r:void 0},pn=dn(Lr,"Map"),mn=dn(Object,"create");var fn=function(){this.__data__=mn?mn(null):{},this.size=0};var hn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},gn=Object.prototype.hasOwnProperty;var vn=function(e){var t=this.__data__;if(mn){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return gn.call(t,e)?t[e]:void 0},bn=Object.prototype.hasOwnProperty;var yn=function(e){var t=this.__data__;return mn?void 0!==t[e]:bn.call(t,e)};var wn=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=mn&&void 0===t?"__lodash_hash_undefined__":t,this};function _n(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}_n.prototype.clear=fn,_n.prototype.delete=hn,_n.prototype.get=vn,_n.prototype.has=yn,_n.prototype.set=wn;var En=_n;var xn=function(){this.size=0,this.__data__={hash:new En,map:new(pn||Ar),string:new En}};var jn=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var kn=function(e,t){var r=e.__data__;return jn(t)?r["string"==typeof t?"string":"hash"]:r.map};var Pn=function(e){var t=kn(this,e).delete(e);return this.size-=t?1:0,t};var On=function(e){return kn(this,e).get(e)};var Cn=function(e){return kn(this,e).has(e)};var Sn=function(e,t){var r=kn(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function An(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}An.prototype.clear=xn,An.prototype.delete=Pn,An.prototype.get=On,An.prototype.has=Cn,An.prototype.set=Sn;var Rn=An;var In=function(e,t){var r=this.__data__;if(r instanceof Ar){var n=r.__data__;if(!pn||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Rn(n)}return r.set(e,t),this.size=r.size,this};function Tn(e){var t=this.__data__=new Ar(e);this.size=t.size}Tn.prototype.clear=Rr,Tn.prototype.delete=Ir,Tn.prototype.get=Tr,Tn.prototype.has=Nr,Tn.prototype.set=In;var Nn=Tn;var Un=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var zn=function(e){return this.__data__.has(e)};function Ln(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Rn;++t<r;)this.add(e[t])}Ln.prototype.add=Ln.prototype.push=Un,Ln.prototype.has=zn;var Wn=Ln;var Dn=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Vn=function(e,t){return e.has(t)};var Fn=function(e,t,r,n,a,o){var i=1&r,c=e.length,s=t.length;if(c!=s&&!(i&&s>c))return!1;var u=o.get(e),l=o.get(t);if(u&&l)return u==t&&l==e;var d=-1,p=!0,m=2&r?new Wn:void 0;for(o.set(e,t),o.set(t,e);++d<c;){var f=e[d],h=t[d];if(n)var g=i?n(h,f,d,t,e,o):n(f,h,d,e,t,o);if(void 0!==g){if(g)continue;p=!1;break}if(m){if(!Dn(t,(function(e,t){if(!Vn(m,t)&&(f===e||a(f,e,r,n,o)))return m.push(t)}))){p=!1;break}}else if(f!==h&&!a(f,h,r,n,o)){p=!1;break}}return o.delete(e),o.delete(t),p},Bn=Lr.Uint8Array;var qn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var Mn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},$n=Wr?Wr.prototype:void 0,Yn=$n?$n.valueOf:void 0;var Hn=function(e,t,r,n,a,o,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Bn(e),new Bn(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Er(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=qn;case"[object Set]":var s=1&n;if(c||(c=Mn),e.size!=t.size&&!s)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var l=Fn(c(e),c(t),n,a,o,i);return i.delete(e),l;case"[object Symbol]":if(Yn)return Yn.call(e)==Yn.call(t)}return!1};var Jn=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},Gn=Array.isArray;var Kn=function(e,t,r){var n=t(e);return Gn(e)?n:Jn(n,r(e))};var Qn=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[a++]=i)}return o};var Xn=function(){return[]},Zn=Object.prototype.propertyIsEnumerable,ea=Object.getOwnPropertySymbols,ta=ea?function(e){return null==e?[]:(e=Object(e),Qn(ea(e),(function(t){return Zn.call(e,t)})))}:Xn;var ra=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var na=function(e){return null!=e&&"object"==typeof e};var aa=function(e){return na(e)&&"[object Arguments]"==Hr(e)},oa=Object.prototype,ia=oa.hasOwnProperty,ca=oa.propertyIsEnumerable,sa=aa(function(){return arguments}())?aa:function(e){return na(e)&&ia.call(e,"callee")&&!ca.call(e,"callee")};var ua=function(){return!1},la=tt((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?Lr.Buffer:void 0,o=(a?a.isBuffer:void 0)||ua;e.exports=o})),da=/^(?:0|[1-9]\d*)$/;var pa=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&da.test(e))&&e>-1&&e%1==0&&e<t};var ma=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},fa={};fa["[object Float32Array]"]=fa["[object Float64Array]"]=fa["[object Int8Array]"]=fa["[object Int16Array]"]=fa["[object Int32Array]"]=fa["[object Uint8Array]"]=fa["[object Uint8ClampedArray]"]=fa["[object Uint16Array]"]=fa["[object Uint32Array]"]=!0,fa["[object Arguments]"]=fa["[object Array]"]=fa["[object ArrayBuffer]"]=fa["[object Boolean]"]=fa["[object DataView]"]=fa["[object Date]"]=fa["[object Error]"]=fa["[object Function]"]=fa["[object Map]"]=fa["[object Number]"]=fa["[object Object]"]=fa["[object RegExp]"]=fa["[object Set]"]=fa["[object String]"]=fa["[object WeakMap]"]=!1;var ha=function(e){return na(e)&&ma(e.length)&&!!fa[Hr(e)]};var ga=function(e){return function(t){return e(t)}},va=tt((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&Ur.process,o=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o})),ba=va&&va.isTypedArray,ya=ba?ga(ba):ha,wa=Object.prototype.hasOwnProperty;var _a=function(e,t){var r=Gn(e),n=!r&&sa(e),a=!r&&!n&&la(e),o=!r&&!n&&!a&&ya(e),i=r||n||a||o,c=i?ra(e.length,String):[],s=c.length;for(var u in e)!t&&!wa.call(e,u)||i&&("length"==u||a&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||pa(u,s))||c.push(u);return c},Ea=Object.prototype;var xa=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ea)};var ja=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),ka=Object.prototype.hasOwnProperty;var Pa=function(e){if(!xa(e))return ja(e);var t=[];for(var r in Object(e))ka.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Oa=function(e){return null!=e&&ma(e.length)&&!Kr(e)};var Ca=function(e){return Oa(e)?_a(e):Pa(e)};var Sa=function(e){return Kn(e,Ca,ta)},Aa=Object.prototype.hasOwnProperty;var Ra=function(e,t,r,n,a,o){var i=1&r,c=Sa(e),s=c.length;if(s!=Sa(t).length&&!i)return!1;for(var u=s;u--;){var l=c[u];if(!(i?l in t:Aa.call(t,l)))return!1}var d=o.get(e),p=o.get(t);if(d&&p)return d==t&&p==e;var m=!0;o.set(e,t),o.set(t,e);for(var f=i;++u<s;){var h=e[l=c[u]],g=t[l];if(n)var v=i?n(g,h,l,t,e,o):n(h,g,l,e,t,o);if(!(void 0===v?h===g||a(h,g,r,n,o):v)){m=!1;break}f||(f="constructor"==l)}if(m&&!f){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(m=!1)}return o.delete(e),o.delete(t),m},Ia=dn(Lr,"DataView"),Ta=dn(Lr,"Promise"),Na=dn(Lr,"Set"),Ua=dn(Lr,"WeakMap"),za=tn(Ia),La=tn(pn),Wa=tn(Ta),Da=tn(Na),Va=tn(Ua),Fa=Hr;(Ia&&"[object DataView]"!=Fa(new Ia(new ArrayBuffer(1)))||pn&&"[object Map]"!=Fa(new pn)||Ta&&"[object Promise]"!=Fa(Ta.resolve())||Na&&"[object Set]"!=Fa(new Na)||Ua&&"[object WeakMap]"!=Fa(new Ua))&&(Fa=function(e){var t=Hr(e),r="[object Object]"==t?e.constructor:void 0,n=r?tn(r):"";if(n)switch(n){case za:return"[object DataView]";case La:return"[object Map]";case Wa:return"[object Promise]";case Da:return"[object Set]";case Va:return"[object WeakMap]"}return t});var Ba=Fa,qa="[object Object]",Ma=Object.prototype.hasOwnProperty;var $a=function(e,t,r,n,a,o){var i=Gn(e),c=Gn(t),s=i?"[object Array]":Ba(e),u=c?"[object Array]":Ba(t),l=(s="[object Arguments]"==s?qa:s)==qa,d=(u="[object Arguments]"==u?qa:u)==qa,p=s==u;if(p&&la(e)){if(!la(t))return!1;i=!0,l=!1}if(p&&!l)return o||(o=new Nn),i||ya(e)?Fn(e,t,r,n,a,o):Hn(e,t,s,r,n,a,o);if(!(1&r)){var m=l&&Ma.call(e,"__wrapped__"),f=d&&Ma.call(t,"__wrapped__");if(m||f){var h=m?e.value():e,g=f?t.value():t;return o||(o=new Nn),a(h,g,r,n,o)}}return!!p&&(o||(o=new Nn),Ra(e,t,r,n,a,o))};var Ya=function e(t,r,n,a,o){return t===r||(null==t||null==r||!na(t)&&!na(r)?t!=t&&r!=r:$a(t,r,n,a,e,o))};var Ha=function(e,t){return Ya(e,t)},Ja={},Ga={"{}":void 0},Ka=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ja,t=JSON.stringify(e),n=L({permissions:Ga[t]}),o=$e(n,2),i=o[0],c=o[1],s=q(),u=a((function(){return s(e).then((function(e){Ha(e,i.permissions)||(Ga[t]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[t,e,s]);return r((function(){u()}),[t]),De(De({},i),{},{refetch:u})},Qa={auth:{dialog:{container_permissions:"Container permissions",resource_permissions:"Resource permissions",login_required:"Login required"},action:{permissions:"Permissions",signup:"Signup",logout:"Logout",login:"Login",view_my_profile:"View my profile",edit_my_profile:"Edit my profile"},right:{resource:{read:"Read",append:"Append",write:"Write",control:"Control"},container:{read:"List",append:"Add",write:"Add",control:"Control"}},agent:{anonymous:"All users",authenticated:"Connected users"},input:{agent_select:"Add an user...",name:"Surname",username:"User ID",email:"Email address",username_or_email:"User ID or email address"},message:{resource_show_forbidden:"You are not allowed to view this resource",resource_edit_forbidden:"You are not allowed to edit this resource",resource_delete_forbidden:"You are not allowed to delete this resource",resource_control_forbidden:"You are not allowed to control this resource",container_create_forbidden:"You are not allowed to create new resource",container_list_forbidden:"You are not allowed to list these resources",user_not_allowed_to_login:"You are not allowed to login with this account",user_email_not_found:"No account found with this email address",user_email_exist:"An account already exist with this email address",username_exist:"An account already exist with this user ID",username_invalid:"This username is invalid. Only lowercase characters, numbers, dots and hyphens are authorized",new_user_created:"Your account has been successfully created",user_connected:"You are now connected",user_disconnected:"You are now disconnected",bad_request:"Bad request (Error message returned by the server: %{error})",account_settings_updated:"Your account settings have been successfully updated",login_to_continue:"Please login to continue",choose_pod_provider:"Please choose a POD provider in the list below. All application data will be saved on your POD."}}},Xa={auth:{dialog:{container_permissions:"Permissions sur le container",resource_permissions:"Permissions sur la resource",login_required:"Connexion requise"},action:{permissions:"Permissions",signup:"S'inscrire",logout:"Se déconnecter",login:"Se connecter",view_my_profile:"Voir mon profil",edit_my_profile:"Éditer mon profil"},right:{resource:{read:"Lire",append:"Enrichir",write:"Modifier",control:"Administrer"},container:{read:"Lister",append:"Ajouter",write:"Ajouter",control:"Administrer"}},agent:{anonymous:"Tous les utilisateurs",authenticated:"Utilisateurs connectés"},input:{agent_select:"Ajouter un utilisateur...",name:"Prénom",username:"Identifiant unique",email:"Adresse e-mail",username_or_email:"Identifiant ou adresse e-mail"},message:{resource_show_forbidden:"Vous n'avez pas la permission de voir cette ressource",resource_edit_forbidden:"Vous n'avez pas la permission d'éditer cette ressource",resource_delete_forbidden:"Vous n'avez pas la permission d'effacer cette ressource",resource_control_forbidden:"Vous n'avez pas la permission d'administrer cette ressource",container_create_forbidden:"Vous n'avez pas la permission de créer des ressources",container_list_forbidden:"Vous n'avez pas la permission de voir ces ressources",user_not_allowed_to_login:"Vous n'avez pas le droit de vous connecter avec ce compte",user_email_not_found:"Aucun compte trouvé avec cette adresse mail",user_email_exist:"Un compte existe déjà avec cette adresse mail",username_exist:"Un compte existe déjà avec cet identifiant",username_invalid:"Cet identifiant n'est pas valide. Seuls les lettres minuscules, les chiffres, les points et les tirets sont autorisés",new_user_created:"Votre compte a été créé avec succès",user_connected:"Vous êtes maintenant connecté",user_disconnected:"Vous êtes maintenant déconnecté",bad_request:"Requête erronée (Message d'erreur renvoyé par le serveur: %{error})",account_settings_updated:"Les paramètres de votre compte ont été mis à jour avec succès",login_to_continue:"Veuillez vous connecter pour continuer",choose_pod_provider:"Veuillez choisir un fournisseur de PODs dans la liste ci-dessous. Toutes les données de l'application seront enregistrées sur votre POD."}}};export{Mt as AuthDialog,_t as CreateWithPermissions,Nt as DeleteButtonWithPermissions,Tt as EditActionsWithPermissions,zt as EditToolbarWithPermissions,Lt as EditWithPermissions,Dt as ListActionsWithPermissions,Vt as ListWithPermissions,ur as LocalLoginPage,Ht as LoginPage,dr as LogoutButton,It as PermissionsButton,Kt as PodLoginPage,mr as ResourceWithPermissions,Ft as ShowActionsWithPermissions,Bt as ShowWithPermissions,Ht as SsoLoginPage,yr as UserMenu,lt as authProvider,Qa as englishMessages,Xa as frenchMessages,St as useAgents,wr as useCheckAuthenticated,wt as useCheckPermissions,Ka as usePermissionsWithRefetch,rr as useSignup};
//# sourceMappingURL=index.es.js.map
