import e,{createElement as t,cloneElement as r,forwardRef as n,useState as o,useEffect as a,useCallback as i,useMemo as c}from"react";import{TopToolbar as u,ListButton as l,ShowButton as s,Toolbar as f,SaveButton as p,DeleteButton as m,usePermissionsOptimized as d,Edit as h,useNotify as v,useLogin as y,Notification as b,useLogout as g,Resource as j,useDataProvider as _,Loading as w,Error as E,useSafeSetState as O,useGetPermissions as k,useAuthProvider as A,Button as P,EditButton as C,Show as S,MenuItemLink as I,useGetIdentity as x,UserMenu as T}from"react-admin";import{makeStyles as U,Card as N,Avatar as z,CardActions as R,Button as L,ListItem as D,ListItemAvatar as M,ListItemText as W,ListItemSecondaryAction as F,IconButton as $,Menu as B,MenuItem as V,ListItemIcon as G,List as H,Dialog as J,DialogTitle as q,DialogContent as K,TextField as Q,DialogActions as X}from"@material-ui/core";import Y from"@material-ui/icons/Public";import Z from"@material-ui/icons/VpnLock";import ee from"@material-ui/icons/Person";import te from"@material-ui/icons/Group";import{ThemeProvider as re}from"@material-ui/styles";import{makeStyles as ne,createMuiTheme as oe}from"@material-ui/core/styles";import ae from"@material-ui/icons/Lock";import ie from"@material-ui/core/MenuItem";import ce from"@material-ui/icons/PowerSettingsNew";import ue from"@material-ui/icons/Share";import le from"@material-ui/icons/Edit";import se from"@material-ui/icons/Check";import fe from"@material-ui/icons/AccountCircle";function pe(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function me(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){pe(a,n,o,i,c,"next",e)}function c(e){pe(a,n,o,i,c,"throw",e)}i(void 0)}))}}function de(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(r),!0).forEach((function(t){de(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function be(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||je(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){if(e){if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_e(e,t):void 0}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(e){this.message=e}we.prototype=new Error,we.prototype.name="InvalidCharacterError";var Ee="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new we("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function Oe(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Ee(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Ee(t)}}function ke(e){this.message=e}ke.prototype=new Error,ke.prototype.name="InvalidTokenError";var Ae="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Pe(e,t){return e(t={exports:{}},t.exports),t.exports}var Ce,Se=Pe((function(e){var t,r;t=Ae,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),Ie=function(e,t){return Se(e,t.replace(e,"_acl/"))},xe=function(e){var t,r,n=e.middlewareUri,o=e.httpClient,a=e.checkPermissions,i=e.resources;return{login:function(e){return window.location.href="".concat(n,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var e=new URL(window.location.href);return window.location.href="".concat(n,"auth/logout?redirectUrl=")+encodeURIComponent(e.origin+"/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:(r=me(regeneratorRuntime.mark((function e(t){var r,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",!0);case 2:return r=i[t]?i[t].containerUri:t,c=Ie(n,r),e.next=6,o(c);case 6:return u=e.sent,l=u.json,e.abrupt("return",l["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),addPermission:(t=me(regeneratorRuntime.mark((function e(t,r,a,c){var u,l,s,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=i[t]?i[t].containerUri:t,l=Ie(n,u),s={"@id":l+"#"+c.replace("acl:",""),"@type":"acl:Authorization","acl:accessTo":u,"acl:mode":c},e.t0=a,e.next="user"===e.t0?6:"group"===e.t0?8:"anon"===e.t0||"anyUser"===e.t0?10:12;break;case 6:return s["acl:agent"]=r,e.abrupt("break",13);case 8:return s["acl:agentGroup"]=r,e.abrupt("break",13);case 10:return s["acl:agentClass"]=r,e.abrupt("break",13);case 12:throw new Error("Unknown agent type: "+a);case 13:return e.next=15,o(l,{method:"PATCH",body:JSON.stringify({"@context":{acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/"},"@graph":[s]})});case 15:return f=e.sent,e.abrupt("return",204===f.status);case 17:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new ke("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(Oe(e.split(".")[r]))}catch(e){throw new ke("Invalid token specified: "+e.message)}}(e);return{id:t.webId,fullName:t.name}}}}},Te=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasShow,c=be(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(u,he({className:n},c),a&&e.createElement(l,{basePath:r,record:o}),i&&e.createElement(s,{basePath:r,record:o}))},Ue=U((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),Ne=function(t){var r=t.hasDelete,n=be(t,["hasDelete"]),o=Ue();return e.createElement(f,he({},n,{className:o.toolbar}),e.createElement(p,null),r&&e.createElement(m,{undoable:!1}))},ze=["acl:Read","acl:Append","acl:Write","acl:Control"],Re=["acl:Append","acl:Write","acl:Control"],Le=["acl:Append","acl:Write","acl:Control"],De=["acl:Write","acl:Control"],Me=["acl:Control"],We=(de(Ce={},"acl:Read","Lire"),de(Ce,"acl:Append","Enrichir"),de(Ce,"acl:Write","Modifier"),de(Ce,"acl:Control","Administrer"),Ce),Fe={anon:{label:"Tous les utilisateurs",icon:e.createElement(Y,null)},anyUser:{label:"Utilisateurs connectés",icon:e.createElement(Z,null)},user:{icon:e.createElement(ee,null)},group:{icon:e.createElement(te,null)}},$e=function(t){var r=d(t.id).permissions;return e.createElement(h,he({actions:e.createElement(Te,null)},t,{permissions:r}),e.cloneElement(t.children,{toolbar:e.createElement(Ne,{hasDelete:r&&r.some((function(e){return De.includes(e["acl:mode"])}))})}))},Be=ne((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),Ve=function(e){var n=e.theme,o=e.history,a=e.location,i=e.buttons,c=Be(),u=v(),l=y(),s=new URLSearchParams(a.search);return s.has("token")&&(localStorage.setItem("token",s.get("token")),u("Vous êtes maintenant connecté","info"),o.push("/")),s.has("logout")&&(localStorage.removeItem("token"),u("Vous êtes maintenant déconnecté","info"),o.push("/")),t(re,{theme:oe(n)},t("div",{className:c.main},t(N,{className:c.card},t("div",{className:c.lockIconAvatar},t(z,{className:c.lockIcon},t(ae,null))),i&&i.map((function(e){return t(R,null,r(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return l({},"/login")}}))})))),t(b,null))};Ve.defaultProps={buttons:[t(L,{startIcon:t(z,{src:"/lescommuns.jpg"})},"Les Communs")]};var Ge=n((function(t,r){var n=g();return e.createElement(ie,{onClick:function(){return n()},ref:r},e.createElement(ce,null),"   Se déconnecter")})),He=function(t){var r=t.name,n=t.list,o=t.create,a=be(t,["name","list","create"]),i=d(r).permissions;return e.createElement(j,he({},a,{name:r,list:i&&i.some((function(e){return ze.includes(e["acl:mode"])}))?n:void 0,create:i&&i.some((function(e){return Re.includes(e["acl:mode"])}))?o:void 0}))},Je=U((function(){return{listItem:{paddingLeft:4,paddingRight:36},secondaryText:{textAlign:"center",width:"50%",fontStyle:"italic",color:"grey"}}})),qe=function(t){var r=t.agent,n=t.addPermission,i=Je(),c=_(),u=ge(e.useState(null),2),l=u[0],s=u[1],f=ge(o(),2),p=f[0],m=f[1],d=ge(o(!0),2),h=d[0],v=d[1],y=ge(o(),2),b=y[0],g=y[1];if(a((function(){"user"===r.type?c.getOne("Person",{id:r.id}).then((function(e){var t=e.data;m(t),v(!1)})).catch((function(e){g(e),v(!1)})):v(!1)}),[r.id,r.type]),"group"===r.type)return null;var j=function(){return s(null)};return h?e.createElement(w,null):b?e.createElement(E,null):e.createElement(D,{button:!0,className:i.listItem},e.createElement(M,null,e.createElement(z,{src:null==p?void 0:p.image},r.icon)),e.createElement(W,{primary:r.label||(null==p?void 0:p.name)}),e.createElement(W,{className:i.secondaryText,primary:r.permissions&&r.permissions.map((function(e){return We[e]})).join(", ")}),e.createElement(F,null,e.createElement($,{onClick:function(e){return s(e.currentTarget)}},e.createElement(le,null)),e.createElement(B,{anchorEl:l,keepMounted:!0,open:Boolean(l),onClose:j},Object.entries(We).map((function(t){var o=ge(t,2),a=o[0],i=o[1];return e.createElement(V,{onClick:function(){n(r.id,r.type,a),j()}},e.createElement(G,null,r.permissions&&r.permissions.includes(a)?e.createElement(se,null):null),e.createElement(W,{primary:i}))})))))};var Ke=function(){this.__data__=[],this.size=0};var Qe=function(e,t){return e===t||e!=e&&t!=t};var Xe=function(e,t){for(var r=e.length;r--;)if(Qe(e[r][0],t))return r;return-1},Ye=Array.prototype.splice;var Ze=function(e){var t=this.__data__,r=Xe(t,e);return!(r<0)&&(r==t.length-1?t.pop():Ye.call(t,r,1),--this.size,!0)};var et=function(e){var t=this.__data__,r=Xe(t,e);return r<0?void 0:t[r][1]};var tt=function(e){return Xe(this.__data__,e)>-1};var rt=function(e,t){var r=this.__data__,n=Xe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function nt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}nt.prototype.clear=Ke,nt.prototype.delete=Ze,nt.prototype.get=et,nt.prototype.has=tt,nt.prototype.set=rt;var ot=nt;var at=function(){this.__data__=new ot,this.size=0};var it=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var ct=function(e){return this.__data__.get(e)};var ut=function(e){return this.__data__.has(e)},lt="object"==typeof Ae&&Ae&&Ae.Object===Object&&Ae,st="object"==typeof self&&self&&self.Object===Object&&self,ft=lt||st||Function("return this")(),pt=ft.Symbol,mt=Object.prototype,dt=mt.hasOwnProperty,ht=mt.toString,vt=pt?pt.toStringTag:void 0;var yt=function(e){var t=dt.call(e,vt),r=e[vt];try{e[vt]=void 0;var n=!0}catch(e){}var o=ht.call(e);return n&&(t?e[vt]=r:delete e[vt]),o},bt=Object.prototype.toString;var gt=function(e){return bt.call(e)},jt=pt?pt.toStringTag:void 0;var _t=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":jt&&jt in Object(e)?yt(e):gt(e)};var wt=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Et,Ot=function(e){if(!wt(e))return!1;var t=_t(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},kt=ft["__core-js_shared__"],At=(Et=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||""))?"Symbol(src)_1."+Et:"";var Pt=function(e){return!!At&&At in e},Ct=Function.prototype.toString;var St=function(e){if(null!=e){try{return Ct.call(e)}catch(e){}try{return e+""}catch(e){}}return""},It=/^\[object .+?Constructor\]$/,xt=Function.prototype,Tt=Object.prototype,Ut=xt.toString,Nt=Tt.hasOwnProperty,zt=RegExp("^"+Ut.call(Nt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Rt=function(e){return!(!wt(e)||Pt(e))&&(Ot(e)?zt:It).test(St(e))};var Lt=function(e,t){return null==e?void 0:e[t]};var Dt=function(e,t){var r=Lt(e,t);return Rt(r)?r:void 0},Mt=Dt(ft,"Map"),Wt=Dt(Object,"create");var Ft=function(){this.__data__=Wt?Wt(null):{},this.size=0};var $t=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Bt=Object.prototype.hasOwnProperty;var Vt=function(e){var t=this.__data__;if(Wt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Bt.call(t,e)?t[e]:void 0},Gt=Object.prototype.hasOwnProperty;var Ht=function(e){var t=this.__data__;return Wt?void 0!==t[e]:Gt.call(t,e)};var Jt=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Wt&&void 0===t?"__lodash_hash_undefined__":t,this};function qt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}qt.prototype.clear=Ft,qt.prototype.delete=$t,qt.prototype.get=Vt,qt.prototype.has=Ht,qt.prototype.set=Jt;var Kt=qt;var Qt=function(){this.size=0,this.__data__={hash:new Kt,map:new(Mt||ot),string:new Kt}};var Xt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Yt=function(e,t){var r=e.__data__;return Xt(t)?r["string"==typeof t?"string":"hash"]:r.map};var Zt=function(e){var t=Yt(this,e).delete(e);return this.size-=t?1:0,t};var er=function(e){return Yt(this,e).get(e)};var tr=function(e){return Yt(this,e).has(e)};var rr=function(e,t){var r=Yt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function nr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}nr.prototype.clear=Qt,nr.prototype.delete=Zt,nr.prototype.get=er,nr.prototype.has=tr,nr.prototype.set=rr;var or=nr;var ar=function(e,t){var r=this.__data__;if(r instanceof ot){var n=r.__data__;if(!Mt||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new or(n)}return r.set(e,t),this.size=r.size,this};function ir(e){var t=this.__data__=new ot(e);this.size=t.size}ir.prototype.clear=at,ir.prototype.delete=it,ir.prototype.get=ct,ir.prototype.has=ut,ir.prototype.set=ar;var cr=ir;var ur=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var lr=function(e){return this.__data__.has(e)};function sr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new or;++t<r;)this.add(e[t])}sr.prototype.add=sr.prototype.push=ur,sr.prototype.has=lr;var fr=sr;var pr=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var mr=function(e,t){return e.has(t)};var dr=function(e,t,r,n,o,a){var i=1&r,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var s=-1,f=!0,p=2&r?new fr:void 0;for(a.set(e,t),a.set(t,e);++s<c;){var m=e[s],d=t[s];if(n)var h=i?n(d,m,s,t,e,a):n(m,d,s,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(p){if(!pr(t,(function(e,t){if(!mr(p,t)&&(m===e||o(m,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(m!==d&&!o(m,d,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},hr=ft.Uint8Array;var vr=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var yr=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},br=pt?pt.prototype:void 0,gr=br?br.valueOf:void 0;var jr=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new hr(e),new hr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Qe(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=vr;case"[object Set]":var u=1&n;if(c||(c=yr),e.size!=t.size&&!u)return!1;var l=i.get(e);if(l)return l==t;n|=2,i.set(e,t);var s=dr(c(e),c(t),n,o,a,i);return i.delete(e),s;case"[object Symbol]":if(gr)return gr.call(e)==gr.call(t)}return!1};var _r=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},wr=Array.isArray;var Er=function(e,t,r){var n=t(e);return wr(e)?n:_r(n,r(e))};var Or=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var kr=function(){return[]},Ar=Object.prototype.propertyIsEnumerable,Pr=Object.getOwnPropertySymbols,Cr=Pr?function(e){return null==e?[]:(e=Object(e),Or(Pr(e),(function(t){return Ar.call(e,t)})))}:kr;var Sr=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Ir=function(e){return null!=e&&"object"==typeof e};var xr=function(e){return Ir(e)&&"[object Arguments]"==_t(e)},Tr=Object.prototype,Ur=Tr.hasOwnProperty,Nr=Tr.propertyIsEnumerable,zr=xr(function(){return arguments}())?xr:function(e){return Ir(e)&&Ur.call(e,"callee")&&!Nr.call(e,"callee")};var Rr=function(){return!1},Lr=Pe((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?ft.Buffer:void 0,a=(o?o.isBuffer:void 0)||Rr;e.exports=a})),Dr=/^(?:0|[1-9]\d*)$/;var Mr=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Dr.test(e))&&e>-1&&e%1==0&&e<t};var Wr=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Fr={};Fr["[object Float32Array]"]=Fr["[object Float64Array]"]=Fr["[object Int8Array]"]=Fr["[object Int16Array]"]=Fr["[object Int32Array]"]=Fr["[object Uint8Array]"]=Fr["[object Uint8ClampedArray]"]=Fr["[object Uint16Array]"]=Fr["[object Uint32Array]"]=!0,Fr["[object Arguments]"]=Fr["[object Array]"]=Fr["[object ArrayBuffer]"]=Fr["[object Boolean]"]=Fr["[object DataView]"]=Fr["[object Date]"]=Fr["[object Error]"]=Fr["[object Function]"]=Fr["[object Map]"]=Fr["[object Number]"]=Fr["[object Object]"]=Fr["[object RegExp]"]=Fr["[object Set]"]=Fr["[object String]"]=Fr["[object WeakMap]"]=!1;var $r=function(e){return Ir(e)&&Wr(e.length)&&!!Fr[_t(e)]};var Br=function(e){return function(t){return e(t)}},Vr=Pe((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&lt.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),Gr=Vr&&Vr.isTypedArray,Hr=Gr?Br(Gr):$r,Jr=Object.prototype.hasOwnProperty;var qr=function(e,t){var r=wr(e),n=!r&&zr(e),o=!r&&!n&&Lr(e),a=!r&&!n&&!o&&Hr(e),i=r||n||o||a,c=i?Sr(e.length,String):[],u=c.length;for(var l in e)!t&&!Jr.call(e,l)||i&&("length"==l||o&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Mr(l,u))||c.push(l);return c},Kr=Object.prototype;var Qr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Kr)};var Xr=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Yr=Object.prototype.hasOwnProperty;var Zr=function(e){if(!Qr(e))return Xr(e);var t=[];for(var r in Object(e))Yr.call(e,r)&&"constructor"!=r&&t.push(r);return t};var en=function(e){return null!=e&&Wr(e.length)&&!Ot(e)};var tn=function(e){return en(e)?qr(e):Zr(e)};var rn=function(e){return Er(e,tn,Cr)},nn=Object.prototype.hasOwnProperty;var on=function(e,t,r,n,o,a){var i=1&r,c=rn(e),u=c.length;if(u!=rn(t).length&&!i)return!1;for(var l=u;l--;){var s=c[l];if(!(i?s in t:nn.call(t,s)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var m=i;++l<u;){var d=e[s=c[l]],h=t[s];if(n)var v=i?n(h,d,s,t,e,a):n(d,h,s,e,t,a);if(!(void 0===v?d===h||o(d,h,r,n,a):v)){p=!1;break}m||(m="constructor"==s)}if(p&&!m){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(p=!1)}return a.delete(e),a.delete(t),p},an=Dt(ft,"DataView"),cn=Dt(ft,"Promise"),un=Dt(ft,"Set"),ln=Dt(ft,"WeakMap"),sn=St(an),fn=St(Mt),pn=St(cn),mn=St(un),dn=St(ln),hn=_t;(an&&"[object DataView]"!=hn(new an(new ArrayBuffer(1)))||Mt&&"[object Map]"!=hn(new Mt)||cn&&"[object Promise]"!=hn(cn.resolve())||un&&"[object Set]"!=hn(new un)||ln&&"[object WeakMap]"!=hn(new ln))&&(hn=function(e){var t=_t(e),r="[object Object]"==t?e.constructor:void 0,n=r?St(r):"";if(n)switch(n){case sn:return"[object DataView]";case fn:return"[object Map]";case pn:return"[object Promise]";case mn:return"[object Set]";case dn:return"[object WeakMap]"}return t});var vn=hn,yn=Object.prototype.hasOwnProperty;var bn=function(e,t,r,n,o,a){var i=wr(e),c=wr(t),u=i?"[object Array]":vn(e),l=c?"[object Array]":vn(t),s="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l),p=u==l;if(p&&Lr(e)){if(!Lr(t))return!1;i=!0,s=!1}if(p&&!s)return a||(a=new cr),i||Hr(e)?dr(e,t,r,n,o,a):jr(e,t,u,r,n,o,a);if(!(1&r)){var m=s&&yn.call(e,"__wrapped__"),d=f&&yn.call(t,"__wrapped__");if(m||d){var h=m?e.value():e,v=d?t.value():t;return a||(a=new cr),o(h,v,r,n,a)}}return!!p&&(a||(a=new cr),on(e,t,r,n,o,a))};var gn=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Ir(t)&&!Ir(r)?t!=t&&r!=r:bn(t,r,n,o,e,a))};var jn=function(e,t){return gn(e,t)},_n={},wn={"{}":void 0},En=U((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),On=function(e){return e?Array.isArray(e)?e:[e]:void 0},kn=function(e,t){return Array.isArray(e["acl:agentClass"])?e["acl:agentClass"].includes(t):e["acl:agentClass"]===t},An=function(e,t,r,n){e[t]?e[t].permissions.push(n):e[t]=ye(ye({id:t,type:r},Fe[r]),{},{permissions:[n]})},Pn=function(t){var r=t.resourceId,n=En(),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_n,t=JSON.stringify(e),r=O({permissions:wn[t]}),n=ge(r,2),o=n[0],c=n[1],u=k(),l=i((function(){return u(e).then((function(e){jn(e,o.permissions)||(wn[t]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[t,e,u]);return a((function(){l()}),[t]),ye(ye({},o),{},{refetch:l})}(r),u=o.permissions,l=o.refetch,s=A(),f=c((function(){var e={};if(u){var t,r=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=je(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(u);try{var n=function(){var r=t.value;kn(r,"foaf:Agent")&&An(e,"foaf:Agent","anon",r["acl:mode"]),kn(r,"acl:AuthenticatedAgent")&&An(e,"acl:AuthenticatedAgent","anyUser",r["acl:mode"]),r["acl:agent"]&&On(r["acl:agent"]).forEach((function(t){return An(e,t,"user",r["acl:mode"])})),r["acl:agentGroup"]&&On(r["acl:agentGroup"]).forEach((function(t){return An(e,t,"group",r["acl:mode"])}))};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}return e}),[u]),p=i((function(e,t,n){s.addPermission(r,e,t,n).then((function(e){e&&l()}))}),[r,s,l]);return e.createElement(H,{dense:!0,className:n.list},Object.entries(f).map((function(t){var r=ge(t,2),n=r[0],o=r[1];return e.createElement(qe,{key:n,agent:o,addPermission:p})})))},Cn=U((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:200}}})),Sn=function(t){var r=t.open,n=t.onClose,o=t.resourceId,a=Cn();return e.createElement(J,{fullWidth:!0,open:r,onClose:n},e.createElement(q,{className:a.title},"Permissions sur la ressource"),e.createElement(K,{className:a.addForm},e.createElement(Q,{label:"Ajouter un utilisateur ou un groupe...",variant:"filled",margin:"dense",fullWidth:!0})),e.createElement(K,{className:a.listForm},e.createElement(Pn,{resourceId:o})),e.createElement(X,{className:a.actions},e.createElement(P,{label:"ra.action.close",variant:"inlined",onClick:n})))},In=function(t){var r=t.record,n=ge(o(!1),2),a=n[0],i=n[1];return r?e.createElement(e.Fragment,null,e.createElement(P,{label:"Permissions",onClick:function(){return i(!0)}},e.createElement(ue,null)),e.createElement(Sn,{resourceId:r.id||r["@id"],open:a,onClose:function(){return i(!1)}})):null},xn=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasEdit,c=t.hasControl,s=be(t,["basePath","className","data","hasList","hasEdit","hasControl"]);return e.createElement(u,he({className:n},s),a&&e.createElement(l,{basePath:r,record:o}),i&&e.createElement(C,{basePath:r,record:o}),c&&e.createElement(In,{basePath:r,record:o}))},Tn=function(t){var r=d(t.id).permissions;return e.createElement(S,he({actions:e.createElement(xn,{hasControl:r&&r.some((function(e){return Me.includes(e["acl:mode"])}))})},t,{permissions:r,hasEdit:r&&r.some((function(e){return Le.includes(e["acl:mode"])}))}))},Un=n((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(I,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:"Voir mon profil",leftIcon:e.createElement(fe,null),onClick:n})})),Nn=n((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(I,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/edit"),primaryText:"Editer mon profil",leftIcon:e.createElement(le,null),onClick:n})})),zn=n((function(t,r){var n=t.onClick;return e.createElement(I,{ref:r,to:"/login",primaryText:"Se connecter",onClick:n})})),Rn=function(t){var r=t.logout,n=be(t,["logout"]),o=x().identity;return e.createElement(T,n,o&&""!==o.id?[e.createElement(Un,{webId:o.id,key:"view"}),e.createElement(Nn,{webId:o.id,key:"edit"}),e.cloneElement(r,{key:"logout"})]:e.createElement(zn,null))};export{Te as EditActions,$e as EditWithPermissions,Ve as LoginPage,Ge as LogoutButton,He as ResourceWithPermissions,xn as ShowActions,Tn as ShowWithPermissions,Rn as UserMenu,xe as authProvider};
