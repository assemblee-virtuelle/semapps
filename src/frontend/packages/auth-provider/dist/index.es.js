import e,{createElement as t,cloneElement as r,forwardRef as n,useState as o,useEffect as a,useCallback as i,useMemo as c}from"react";import u from"@material-ui/icons/Public";import l from"@material-ui/icons/VpnLock";import s from"@material-ui/icons/Person";import f from"@material-ui/icons/Group";import{TopToolbar as p,ListButton as m,ShowButton as d,Toolbar as h,SaveButton as v,DeleteButton as y,usePermissionsOptimized as b,Edit as g,useNotify as j,useLogin as _,Notification as w,useLogout as E,Resource as O,useDataProvider as k,Loading as P,Error as A,useSafeSetState as C,useGetPermissions as S,useAuthProvider as I,Button as x,EditButton as U,Show as T,MenuItemLink as N,useGetIdentity as z,UserMenu as R}from"react-admin";import{makeStyles as L,Card as D,Avatar as M,CardActions as W,Button as F,ListItem as $,ListItemAvatar as B,ListItemText as V,ListItemSecondaryAction as G,IconButton as J,Menu as H,MenuItem as q,ListItemIcon as K,List as Q,Dialog as X,DialogTitle as Y,DialogContent as Z,TextField as ee,DialogActions as te}from"@material-ui/core";import{ThemeProvider as re}from"@material-ui/styles";import{makeStyles as ne,createMuiTheme as oe}from"@material-ui/core/styles";import ae from"@material-ui/icons/Lock";import ie from"@material-ui/core/MenuItem";import ce from"@material-ui/icons/PowerSettingsNew";import ue from"@material-ui/icons/Share";import le from"@material-ui/icons/Edit";import se from"@material-ui/icons/Check";import fe from"@material-ui/icons/AccountCircle";function pe(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function me(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){pe(a,n,o,i,c,"next",e)}function c(e){pe(a,n,o,i,c,"throw",e)}i(void 0)}))}}function de(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(r),!0).forEach((function(t){de(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function be(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||je(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){if(e){if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_e(e,t):void 0}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(e){this.message=e}we.prototype=new Error,we.prototype.name="InvalidCharacterError";var Ee,Oe="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new we("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function ke(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Oe(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Oe(t)}}function Pe(e){this.message=e}Pe.prototype=new Error,Pe.prototype.name="InvalidTokenError";var Ae=["acl:Read","acl:Append","acl:Write","acl:Control"],Ce=["acl:Append","acl:Write","acl:Control"],Se=["acl:Append","acl:Write","acl:Control"],Ie=["acl:Write","acl:Control"],xe=["acl:Control"],Ue=(de(Ee={},"acl:Read","Lire"),de(Ee,"acl:Append","Enrichir"),de(Ee,"acl:Write","Modifier"),de(Ee,"acl:Control","Administrer"),Ee),Te={anon:"acl:agentClass",anyUser:"acl:agentClass",user:"acl:agent",group:"acl:group"},Ne={anon:{label:"Tous les utilisateurs",icon:e.createElement(u,null)},anyUser:{label:"Utilisateurs connectés",icon:e.createElement(l,null)},user:{icon:e.createElement(s,null)},group:{icon:e.createElement(f,null)}},ze="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Re(e,t){return e(t={exports:{}},t.exports),t.exports}var Le=Re((function(e){var t,r;t=ze,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),De=function(e){return e?Array.isArray(e)?e:[e]:void 0},Me=function(e,t){return Le(e,t.replace(e,"_acl/"))},We=function(e){var t,r,n,o=e.middlewareUri,a=e.httpClient,i=e.checkPermissions,c=e.resources;return{login:function(e){return window.location.href="".concat(o,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var e=new URL(window.location.href);return window.location.href="".concat(o,"auth/logout?redirectUrl=")+encodeURIComponent(e.origin+"/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:(n=me(regeneratorRuntime.mark((function e(t){var r,n,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",!0);case 2:return r=c[t]?c[t].containerUri:t,n=Me(o,r),e.next=6,a(n);case 6:return u=e.sent,l=u.json,e.abrupt("return",l["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),addPermission:(r=me(regeneratorRuntime.mark((function e(t,r,n,i){var u,l,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=c[t]?c[t].containerUri:t,l=Me(o,u),s={"@id":l+"#"+i.replace("acl:",""),"@type":"acl:Authorization","acl:accessTo":u,"acl:mode":i},e.t0=n,e.next="user"===e.t0?6:"group"===e.t0?8:"anon"===e.t0||"anyUser"===e.t0?10:12;break;case 6:return s["acl:agent"]=r,e.abrupt("break",13);case 8:return s["acl:agentGroup"]=r,e.abrupt("break",13);case 10:return s["acl:agentClass"]=r,e.abrupt("break",13);case 12:throw new Error("Unknown agent type: "+n);case 13:return e.next=15,a(l,{method:"PATCH",body:JSON.stringify({"@context":{acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/"},"@graph":[s]})});case 15:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)}),removePermission:(t=me(regeneratorRuntime.mark((function e(t,r,n,i){var u,l,s,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=c[t]?c[t].containerUri:t,l=Te[n],s=Me(o,u),e.next=5,a(s);case 5:return f=e.sent,p=f.json,m=p["@graph"].map((function(e){var t=De(e["acl:mode"]),n=De(e[l]);return i&&t.includes(i)&&n&&n.includes(r)&&(n=n.filter((function(e){return e!==r}))),ye(ye({},e),{},de({},l,n))})),e.next=10,a(s,{method:"PUT",body:JSON.stringify(ye(ye({},p),{},{"@graph":m}))});case 10:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new Pe("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(ke(e.split(".")[r]))}catch(e){throw new Pe("Invalid token specified: "+e.message)}}(e);return{id:t.webId,fullName:t.name}}}}},Fe=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasShow,c=be(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(p,he({className:n},c),a&&e.createElement(m,{basePath:r,record:o}),i&&e.createElement(d,{basePath:r,record:o}))},$e=L((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),Be=function(t){var r=t.hasDelete,n=be(t,["hasDelete"]),o=$e();return e.createElement(h,he({},n,{className:o.toolbar}),e.createElement(v,null),r&&e.createElement(y,{undoable:!1}))},Ve=function(t){var r=b(t.id).permissions;return e.createElement(g,he({actions:e.createElement(Fe,null)},t,{permissions:r}),e.cloneElement(t.children,{toolbar:e.createElement(Be,{hasDelete:r&&r.some((function(e){return Ie.includes(e["acl:mode"])}))})}))},Ge=ne((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),Je=function(e){var n=e.theme,o=e.history,a=e.location,i=e.buttons,c=Ge(),u=j(),l=_(),s=new URLSearchParams(a.search);return s.has("token")&&(localStorage.setItem("token",s.get("token")),u("Vous êtes maintenant connecté","info"),o.push("/")),s.has("logout")&&(localStorage.removeItem("token"),u("Vous êtes maintenant déconnecté","info"),o.push("/")),t(re,{theme:oe(n)},t("div",{className:c.main},t(D,{className:c.card},t("div",{className:c.lockIconAvatar},t(M,{className:c.lockIcon},t(ae,null))),i&&i.map((function(e){return t(W,null,r(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return l({},"/login")}}))})))),t(w,null))};Je.defaultProps={buttons:[t(F,{startIcon:t(M,{src:"/lescommuns.jpg"})},"Les Communs")]};var He=n((function(t,r){var n=E();return e.createElement(ie,{onClick:function(){return n()},ref:r},e.createElement(ce,null),"   Se déconnecter")})),qe=function(t){var r=t.name,n=t.list,o=t.create,a=be(t,["name","list","create"]),i=b(r).permissions;return e.createElement(O,he({},a,{name:r,list:i&&i.some((function(e){return Ae.includes(e["acl:mode"])}))?n:void 0,create:i&&i.some((function(e){return Ce.includes(e["acl:mode"])}))?o:void 0}))},Ke=L((function(){return{listItem:{paddingLeft:4,paddingRight:36},secondaryText:{textAlign:"center",width:"50%",fontStyle:"italic",color:"grey"}}})),Qe=function(t){var r=t.agent,n=t.addPermission,i=t.removePermission,c=Ke(),u=k(),l=ge(e.useState(null),2),s=l[0],f=l[1],p=ge(o(),2),m=p[0],d=p[1],h=ge(o(!0),2),v=h[0],y=h[1],b=ge(o(),2),g=b[0],j=b[1];if(a((function(){"user"===r.type?u.getOne("Person",{id:r.id}).then((function(e){var t=e.data;d(t),y(!1)})).catch((function(e){j(e),y(!1)})):y(!1)}),[r.id,r.type]),"group"===r.type)return null;var _=function(){return f(null)};return v?e.createElement(P,null):g?e.createElement(A,null):e.createElement($,{button:!0,className:c.listItem},e.createElement(B,null,e.createElement(M,{src:null==m?void 0:m.image},r.icon)),e.createElement(V,{primary:r.label||(null==m?void 0:m["pair:label"])}),e.createElement(V,{className:c.secondaryText,primary:r.permissions&&r.permissions.map((function(e){return Ue[e]})).join(", ")}),e.createElement(G,null,e.createElement(J,{onClick:function(e){return f(e.currentTarget)}},e.createElement(le,null)),e.createElement(H,{anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:_},Object.entries(Ue).map((function(t){var o=ge(t,2),a=o[0],c=o[1],u=r.permissions&&r.permissions.includes(a);return e.createElement(q,{onClick:function(){u?i(r.id,r.type,a):n(r.id,r.type,a),_()}},e.createElement(K,null,u?e.createElement(se,null):null),e.createElement(V,{primary:c}))})))))};var Xe=function(){this.__data__=[],this.size=0};var Ye=function(e,t){return e===t||e!=e&&t!=t};var Ze=function(e,t){for(var r=e.length;r--;)if(Ye(e[r][0],t))return r;return-1},et=Array.prototype.splice;var tt=function(e){var t=this.__data__,r=Ze(t,e);return!(r<0)&&(r==t.length-1?t.pop():et.call(t,r,1),--this.size,!0)};var rt=function(e){var t=this.__data__,r=Ze(t,e);return r<0?void 0:t[r][1]};var nt=function(e){return Ze(this.__data__,e)>-1};var ot=function(e,t){var r=this.__data__,n=Ze(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function at(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}at.prototype.clear=Xe,at.prototype.delete=tt,at.prototype.get=rt,at.prototype.has=nt,at.prototype.set=ot;var it=at;var ct=function(){this.__data__=new it,this.size=0};var ut=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var lt=function(e){return this.__data__.get(e)};var st=function(e){return this.__data__.has(e)},ft="object"==typeof ze&&ze&&ze.Object===Object&&ze,pt="object"==typeof self&&self&&self.Object===Object&&self,mt=ft||pt||Function("return this")(),dt=mt.Symbol,ht=Object.prototype,vt=ht.hasOwnProperty,yt=ht.toString,bt=dt?dt.toStringTag:void 0;var gt=function(e){var t=vt.call(e,bt),r=e[bt];try{e[bt]=void 0;var n=!0}catch(e){}var o=yt.call(e);return n&&(t?e[bt]=r:delete e[bt]),o},jt=Object.prototype.toString;var _t=function(e){return jt.call(e)},wt=dt?dt.toStringTag:void 0;var Et=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":wt&&wt in Object(e)?gt(e):_t(e)};var Ot=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var kt,Pt=function(e){if(!Ot(e))return!1;var t=Et(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},At=mt["__core-js_shared__"],Ct=(kt=/[^.]+$/.exec(At&&At.keys&&At.keys.IE_PROTO||""))?"Symbol(src)_1."+kt:"";var St=function(e){return!!Ct&&Ct in e},It=Function.prototype.toString;var xt=function(e){if(null!=e){try{return It.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Ut=/^\[object .+?Constructor\]$/,Tt=Function.prototype,Nt=Object.prototype,zt=Tt.toString,Rt=Nt.hasOwnProperty,Lt=RegExp("^"+zt.call(Rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Dt=function(e){return!(!Ot(e)||St(e))&&(Pt(e)?Lt:Ut).test(xt(e))};var Mt=function(e,t){return null==e?void 0:e[t]};var Wt=function(e,t){var r=Mt(e,t);return Dt(r)?r:void 0},Ft=Wt(mt,"Map"),$t=Wt(Object,"create");var Bt=function(){this.__data__=$t?$t(null):{},this.size=0};var Vt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gt=Object.prototype.hasOwnProperty;var Jt=function(e){var t=this.__data__;if($t){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Gt.call(t,e)?t[e]:void 0},Ht=Object.prototype.hasOwnProperty;var qt=function(e){var t=this.__data__;return $t?void 0!==t[e]:Ht.call(t,e)};var Kt=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=$t&&void 0===t?"__lodash_hash_undefined__":t,this};function Qt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Qt.prototype.clear=Bt,Qt.prototype.delete=Vt,Qt.prototype.get=Jt,Qt.prototype.has=qt,Qt.prototype.set=Kt;var Xt=Qt;var Yt=function(){this.size=0,this.__data__={hash:new Xt,map:new(Ft||it),string:new Xt}};var Zt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var er=function(e,t){var r=e.__data__;return Zt(t)?r["string"==typeof t?"string":"hash"]:r.map};var tr=function(e){var t=er(this,e).delete(e);return this.size-=t?1:0,t};var rr=function(e){return er(this,e).get(e)};var nr=function(e){return er(this,e).has(e)};var or=function(e,t){var r=er(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function ar(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ar.prototype.clear=Yt,ar.prototype.delete=tr,ar.prototype.get=rr,ar.prototype.has=nr,ar.prototype.set=or;var ir=ar;var cr=function(e,t){var r=this.__data__;if(r instanceof it){var n=r.__data__;if(!Ft||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ir(n)}return r.set(e,t),this.size=r.size,this};function ur(e){var t=this.__data__=new it(e);this.size=t.size}ur.prototype.clear=ct,ur.prototype.delete=ut,ur.prototype.get=lt,ur.prototype.has=st,ur.prototype.set=cr;var lr=ur;var sr=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var fr=function(e){return this.__data__.has(e)};function pr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ir;++t<r;)this.add(e[t])}pr.prototype.add=pr.prototype.push=sr,pr.prototype.has=fr;var mr=pr;var dr=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var hr=function(e,t){return e.has(t)};var vr=function(e,t,r,n,o,a){var i=1&r,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var s=-1,f=!0,p=2&r?new mr:void 0;for(a.set(e,t),a.set(t,e);++s<c;){var m=e[s],d=t[s];if(n)var h=i?n(d,m,s,t,e,a):n(m,d,s,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(p){if(!dr(t,(function(e,t){if(!hr(p,t)&&(m===e||o(m,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(m!==d&&!o(m,d,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},yr=mt.Uint8Array;var br=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var gr=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},jr=dt?dt.prototype:void 0,_r=jr?jr.valueOf:void 0;var wr=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new yr(e),new yr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ye(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=br;case"[object Set]":var u=1&n;if(c||(c=gr),e.size!=t.size&&!u)return!1;var l=i.get(e);if(l)return l==t;n|=2,i.set(e,t);var s=vr(c(e),c(t),n,o,a,i);return i.delete(e),s;case"[object Symbol]":if(_r)return _r.call(e)==_r.call(t)}return!1};var Er=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Or=Array.isArray;var kr=function(e,t,r){var n=t(e);return Or(e)?n:Er(n,r(e))};var Pr=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var Ar=function(){return[]},Cr=Object.prototype.propertyIsEnumerable,Sr=Object.getOwnPropertySymbols,Ir=Sr?function(e){return null==e?[]:(e=Object(e),Pr(Sr(e),(function(t){return Cr.call(e,t)})))}:Ar;var xr=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Ur=function(e){return null!=e&&"object"==typeof e};var Tr=function(e){return Ur(e)&&"[object Arguments]"==Et(e)},Nr=Object.prototype,zr=Nr.hasOwnProperty,Rr=Nr.propertyIsEnumerable,Lr=Tr(function(){return arguments}())?Tr:function(e){return Ur(e)&&zr.call(e,"callee")&&!Rr.call(e,"callee")};var Dr=function(){return!1},Mr=Re((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?mt.Buffer:void 0,a=(o?o.isBuffer:void 0)||Dr;e.exports=a})),Wr=/^(?:0|[1-9]\d*)$/;var Fr=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Wr.test(e))&&e>-1&&e%1==0&&e<t};var $r=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Br={};Br["[object Float32Array]"]=Br["[object Float64Array]"]=Br["[object Int8Array]"]=Br["[object Int16Array]"]=Br["[object Int32Array]"]=Br["[object Uint8Array]"]=Br["[object Uint8ClampedArray]"]=Br["[object Uint16Array]"]=Br["[object Uint32Array]"]=!0,Br["[object Arguments]"]=Br["[object Array]"]=Br["[object ArrayBuffer]"]=Br["[object Boolean]"]=Br["[object DataView]"]=Br["[object Date]"]=Br["[object Error]"]=Br["[object Function]"]=Br["[object Map]"]=Br["[object Number]"]=Br["[object Object]"]=Br["[object RegExp]"]=Br["[object Set]"]=Br["[object String]"]=Br["[object WeakMap]"]=!1;var Vr=function(e){return Ur(e)&&$r(e.length)&&!!Br[Et(e)]};var Gr=function(e){return function(t){return e(t)}},Jr=Re((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&ft.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),Hr=Jr&&Jr.isTypedArray,qr=Hr?Gr(Hr):Vr,Kr=Object.prototype.hasOwnProperty;var Qr=function(e,t){var r=Or(e),n=!r&&Lr(e),o=!r&&!n&&Mr(e),a=!r&&!n&&!o&&qr(e),i=r||n||o||a,c=i?xr(e.length,String):[],u=c.length;for(var l in e)!t&&!Kr.call(e,l)||i&&("length"==l||o&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Fr(l,u))||c.push(l);return c},Xr=Object.prototype;var Yr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Xr)};var Zr=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),en=Object.prototype.hasOwnProperty;var tn=function(e){if(!Yr(e))return Zr(e);var t=[];for(var r in Object(e))en.call(e,r)&&"constructor"!=r&&t.push(r);return t};var rn=function(e){return null!=e&&$r(e.length)&&!Pt(e)};var nn=function(e){return rn(e)?Qr(e):tn(e)};var on=function(e){return kr(e,nn,Ir)},an=Object.prototype.hasOwnProperty;var cn=function(e,t,r,n,o,a){var i=1&r,c=on(e),u=c.length;if(u!=on(t).length&&!i)return!1;for(var l=u;l--;){var s=c[l];if(!(i?s in t:an.call(t,s)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var m=i;++l<u;){var d=e[s=c[l]],h=t[s];if(n)var v=i?n(h,d,s,t,e,a):n(d,h,s,e,t,a);if(!(void 0===v?d===h||o(d,h,r,n,a):v)){p=!1;break}m||(m="constructor"==s)}if(p&&!m){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(p=!1)}return a.delete(e),a.delete(t),p},un=Wt(mt,"DataView"),ln=Wt(mt,"Promise"),sn=Wt(mt,"Set"),fn=Wt(mt,"WeakMap"),pn=xt(un),mn=xt(Ft),dn=xt(ln),hn=xt(sn),vn=xt(fn),yn=Et;(un&&"[object DataView]"!=yn(new un(new ArrayBuffer(1)))||Ft&&"[object Map]"!=yn(new Ft)||ln&&"[object Promise]"!=yn(ln.resolve())||sn&&"[object Set]"!=yn(new sn)||fn&&"[object WeakMap]"!=yn(new fn))&&(yn=function(e){var t=Et(e),r="[object Object]"==t?e.constructor:void 0,n=r?xt(r):"";if(n)switch(n){case pn:return"[object DataView]";case mn:return"[object Map]";case dn:return"[object Promise]";case hn:return"[object Set]";case vn:return"[object WeakMap]"}return t});var bn=yn,gn=Object.prototype.hasOwnProperty;var jn=function(e,t,r,n,o,a){var i=Or(e),c=Or(t),u=i?"[object Array]":bn(e),l=c?"[object Array]":bn(t),s="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l),p=u==l;if(p&&Mr(e)){if(!Mr(t))return!1;i=!0,s=!1}if(p&&!s)return a||(a=new lr),i||qr(e)?vr(e,t,r,n,o,a):wr(e,t,u,r,n,o,a);if(!(1&r)){var m=s&&gn.call(e,"__wrapped__"),d=f&&gn.call(t,"__wrapped__");if(m||d){var h=m?e.value():e,v=d?t.value():t;return a||(a=new lr),o(h,v,r,n,a)}}return!!p&&(a||(a=new lr),cn(e,t,r,n,o,a))};var _n=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Ur(t)&&!Ur(r)?t!=t&&r!=r:jn(t,r,n,o,e,a))};var wn=function(e,t){return _n(e,t)},En={},On={"{}":void 0},kn=L((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),Pn=function(e,t){return Array.isArray(e["acl:agentClass"])?e["acl:agentClass"].includes(t):e["acl:agentClass"]===t},An=function(e,t,r,n){e[t]?e[t].permissions.push(n):e[t]=ye(ye({id:t,type:r},Ne[r]),{},{permissions:[n]})},Cn=function(t){var r=t.resourceId,n=kn(),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:En,t=JSON.stringify(e),r=C({permissions:On[t]}),n=ge(r,2),o=n[0],c=n[1],u=S(),l=i((function(){return u(e).then((function(e){wn(e,o.permissions)||(On[t]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[t,e,u]);return a((function(){l()}),[t]),ye(ye({},o),{},{refetch:l})}(r),u=o.permissions,l=o.refetch,s=I(),f=c((function(){var e={};if(u){var t,r=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=je(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(u);try{var n=function(){var r=t.value;Pn(r,"foaf:Agent")&&An(e,"foaf:Agent","anon",r["acl:mode"]),Pn(r,"acl:AuthenticatedAgent")&&An(e,"acl:AuthenticatedAgent","anyUser",r["acl:mode"]),r["acl:agent"]&&De(r["acl:agent"]).forEach((function(t){return An(e,t,"user",r["acl:mode"])})),r["acl:agentGroup"]&&De(r["acl:agentGroup"]).forEach((function(t){return An(e,t,"group",r["acl:mode"])}))};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}return e}),[u]),p=i((function(e,t,n){s.addPermission(r,e,t,n).then((function(){return l()}))}),[r,s,l]),m=i((function(e,t,n){s.removePermission(r,e,t,n).then((function(){return l()}))}),[r,s,l]);return e.createElement(Q,{dense:!0,className:n.list},Object.entries(f).map((function(t){var r=ge(t,2),n=r[0],o=r[1];return e.createElement(Qe,{key:n,agent:o,addPermission:p,removePermission:m})})))},Sn=L((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),In=function(t){var r=t.open,n=t.onClose,o=t.resourceId,a=Sn();return e.createElement(X,{fullWidth:!0,open:r,onClose:n},e.createElement(Y,{className:a.title},"Permissions sur la ressource"),e.createElement(Z,{className:a.addForm},e.createElement(ee,{label:"Ajouter un utilisateur ou un groupe...",variant:"filled",margin:"dense",fullWidth:!0})),e.createElement(Z,{className:a.listForm},e.createElement(Cn,{resourceId:o})),e.createElement(te,{className:a.actions},e.createElement(x,{label:"ra.action.close",variant:"inlined",onClick:n})))},xn=function(t){var r=t.record,n=ge(o(!1),2),a=n[0],i=n[1];return r?e.createElement(e.Fragment,null,e.createElement(x,{label:"Permissions",onClick:function(){return i(!0)}},e.createElement(ue,null)),e.createElement(In,{resourceId:r.id||r["@id"],open:a,onClose:function(){return i(!1)}})):null},Un=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasEdit,c=t.hasControl,u=be(t,["basePath","className","data","hasList","hasEdit","hasControl"]);return e.createElement(p,he({className:n},u),a&&e.createElement(m,{basePath:r,record:o}),i&&e.createElement(U,{basePath:r,record:o}),c&&e.createElement(xn,{basePath:r,record:o}))},Tn=function(t){var r=b(t.id).permissions;return e.createElement(T,he({actions:e.createElement(Un,{hasControl:r&&r.some((function(e){return xe.includes(e["acl:mode"])}))})},t,{permissions:r,hasEdit:r&&r.some((function(e){return Se.includes(e["acl:mode"])}))}))},Nn=n((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(N,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:"Voir mon profil",leftIcon:e.createElement(fe,null),onClick:n})})),zn=n((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(N,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/edit"),primaryText:"Editer mon profil",leftIcon:e.createElement(le,null),onClick:n})})),Rn=n((function(t,r){var n=t.onClick;return e.createElement(N,{ref:r,to:"/login",primaryText:"Se connecter",onClick:n})})),Ln=function(t){var r=t.logout,n=be(t,["logout"]),o=z().identity;return e.createElement(R,n,o&&""!==o.id?[e.createElement(Nn,{webId:o.id,key:"view"}),e.createElement(zn,{webId:o.id,key:"edit"}),e.cloneElement(r,{key:"logout"})]:e.createElement(Rn,null))};export{Fe as EditActions,Ve as EditWithPermissions,Je as LoginPage,He as LogoutButton,qe as ResourceWithPermissions,Un as ShowActions,Tn as ShowWithPermissions,Ln as UserMenu,We as authProvider};
