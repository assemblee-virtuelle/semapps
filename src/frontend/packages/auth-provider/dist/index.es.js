import e,{createElement as t,cloneElement as r,forwardRef as n,useEffect as o,useState as a,useCallback as i,useMemo as c}from"react";import u from"@material-ui/icons/Public";import l from"@material-ui/icons/VpnLock";import s from"@material-ui/icons/Person";import f from"@material-ui/icons/Group";import{TopToolbar as p,ListButton as m,ShowButton as d,Toolbar as h,SaveButton as v,DeleteButton as b,usePermissionsOptimized as y,Edit as g,useNotify as j,useLogin as _,Notification as w,useLogout as E,Resource as O,useGetList as P,useDataProvider as k,Loading as A,Error as C,useSafeSetState as S,useGetPermissions as I,useAuthProvider as x,Button as U,EditButton as T,Show as N,MenuItemLink as z,useGetIdentity as R,UserMenu as L}from"react-admin";import{makeStyles as D,Card as M,Avatar as W,CardActions as F,Button as $,TextField as B,List as V,ListItem as G,ListItemAvatar as J,ListItemText as q,ListItemSecondaryAction as H,IconButton as K,Menu as Q,MenuItem as X,ListItemIcon as Y,Dialog as Z,DialogTitle as ee,DialogContent as te,DialogActions as re}from"@material-ui/core";import{ThemeProvider as ne}from"@material-ui/styles";import{makeStyles as oe,createMuiTheme as ae}from"@material-ui/core/styles";import ie from"@material-ui/icons/Lock";import ce from"@material-ui/core/MenuItem";import ue from"@material-ui/icons/PowerSettingsNew";import le from"@material-ui/icons/Share";import se from"@material-ui/lab/Autocomplete";import fe from"@material-ui/icons/Edit";import pe from"@material-ui/icons/Check";import me from"@material-ui/icons/AccountCircle";function de(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function he(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){de(a,n,o,i,c,"next",e)}function c(e){de(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function be(){return(be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach((function(t){ve(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function je(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(e,t){if(e){if("string"==typeof e)return Ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ee(e,t):void 0}}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Oe(e){this.message=e}Oe.prototype=new Error,Oe.prototype.name="InvalidCharacterError";var Pe,ke="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Oe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,a=0,i="";n=t.charAt(a++);~n&&(r=o%4?64*r+n:n,o++%4)?i+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return i};function Ae(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(ke(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return ke(t)}}function Ce(e){this.message=e}Ce.prototype=new Error,Ce.prototype.name="InvalidTokenError";var Se=["acl:Read","acl:Append","acl:Write","acl:Control"],Ie=["acl:Append","acl:Write","acl:Control"],xe=["acl:Append","acl:Write","acl:Control"],Ue=["acl:Write","acl:Control"],Te=["acl:Control"],Ne=(ve(Pe={},"acl:Read","Lire"),ve(Pe,"acl:Append","Enrichir"),ve(Pe,"acl:Write","Modifier"),ve(Pe,"acl:Control","Administrer"),Pe),ze={anon:"acl:agentClass",anyUser:"acl:agentClass",user:"acl:agent",group:"acl:group"},Re={anon:{label:"Tous les utilisateurs",icon:e.createElement(u,null)},anyUser:{label:"Utilisateurs connectés",icon:e.createElement(l,null)},user:{icon:e.createElement(s,null)},group:{icon:e.createElement(f,null)}},Le="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function De(e,t){return e(t={exports:{}},t.exports),t.exports}var Me=De((function(e){var t,r;t=Le,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var r=e.shift();e[0]=r+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<e.length;n++){var o=e[n];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(n>0&&(o=o.replace(/^[\/]+/,"")),o=n<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var a=t.join("/"),i=(a=a.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a=i.shift()+(i.length>0?"?":"")+i.join("&")}return function(){return e("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},e.exports?e.exports=r():t.urljoin=r()})),We=function(e){return e?Array.isArray(e)?e:[e]:void 0},Fe=function(e,t){return Me(e,t.replace(e,"_acl/"))},$e=function(e){var t,r,n,o=e.middlewareUri,a=e.httpClient,i=e.checkPermissions,c=e.resources;return{login:function(e){return window.location.href="".concat(o,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var e=new URL(window.location.href);return window.location.href="".concat(o,"auth/logout?redirectUrl=")+encodeURIComponent(e.origin+"/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:(n=he(regeneratorRuntime.mark((function e(t){var r,n,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",!0);case 2:return r=c[t]?c[t].containerUri:t,n=Fe(o,r),e.next=6,a(n);case 6:return u=e.sent,l=u.json,e.abrupt("return",l["@graph"]);case 9:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),addPermission:(r=he(regeneratorRuntime.mark((function e(t,r,n,i){var u,l,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=c[t]?c[t].containerUri:t,l=Fe(o,u),s={"@id":l+"#"+i.replace("acl:",""),"@type":"acl:Authorization","acl:accessTo":u,"acl:mode":i},e.t0=n,e.next="user"===e.t0?6:"group"===e.t0?8:"anon"===e.t0||"anyUser"===e.t0?10:12;break;case 6:return s["acl:agent"]=r,e.abrupt("break",13);case 8:return s["acl:agentGroup"]=r,e.abrupt("break",13);case 10:return s["acl:agentClass"]=r,e.abrupt("break",13);case 12:throw new Error("Unknown agent type: "+n);case 13:return e.next=15,a(l,{method:"PATCH",body:JSON.stringify({"@context":{acl:"http://www.w3.org/ns/auth/acl#",foaf:"http://xmlns.com/foaf/0.1/"},"@graph":[s]})});case 15:case"end":return e.stop()}}),e)}))),function(e,t,n,o){return r.apply(this,arguments)}),removePermission:(t=he(regeneratorRuntime.mark((function e(t,r,n,i){var u,l,s,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=c[t]?c[t].containerUri:t,l=ze[n],s=Fe(o,u),e.next=5,a(s);case 5:return f=e.sent,p=f.json,m=p["@graph"].map((function(e){var t=We(e["acl:mode"]),n=We(e[l]);return i&&t.includes(i)&&n&&n.includes(r)&&(n=n.filter((function(e){return e!==r}))),ge(ge({},e),{},ve({},l,n))})),e.next=10,a(s,{method:"PUT",body:JSON.stringify(ge(ge({},p),{},{"@graph":m}))});case 10:case"end":return e.stop()}}),e)}))),function(e,r,n,o){return t.apply(this,arguments)}),getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new Ce("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(Ae(e.split(".")[r]))}catch(e){throw new Ce("Invalid token specified: "+e.message)}}(e);return{id:t.webId,fullName:t.name}}}}},Be=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasShow,c=je(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(p,be({className:n},c),a&&e.createElement(m,{basePath:r,record:o}),i&&e.createElement(d,{basePath:r,record:o}))},Ve=D((function(){return{toolbar:{flex:1,display:"flex",justifyContent:"space-between"}}})),Ge=function(t){var r=t.hasDelete,n=je(t,["hasDelete"]),o=Ve();return e.createElement(h,be({},n,{className:o.toolbar}),e.createElement(v,null),r&&e.createElement(b,{undoable:!1}))},Je=function(t){var r=y(t.id).permissions;return e.createElement(g,be({actions:e.createElement(Be,null)},t,{permissions:r}),e.cloneElement(t.children,{toolbar:e.createElement(Ge,{hasDelete:r&&r.some((function(e){return Ue.includes(e["acl:mode"])}))})}))},qe=oe((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]}}})),He=function(e){var n=e.theme,o=e.history,a=e.location,i=e.buttons,c=qe(),u=j(),l=_(),s=new URLSearchParams(a.search);return s.has("token")&&(localStorage.setItem("token",s.get("token")),u("Vous êtes maintenant connecté","info"),o.push("/")),s.has("logout")&&(localStorage.removeItem("token"),u("Vous êtes maintenant déconnecté","info"),o.push("/")),t(ne,{theme:ae(n)},t("div",{className:c.main},t(M,{className:c.card},t("div",{className:c.lockIconAvatar},t(W,{className:c.lockIcon},t(ie,null))),i&&i.map((function(e){return t(F,null,r(e,{fullWidth:!0,variant:"outlined",type:"submit",onClick:function(){return l({},"/login")}}))})))),t(w,null))};He.defaultProps={buttons:[t($,{startIcon:t(W,{src:"/lescommuns.jpg"})},"Les Communs")]};var Ke=n((function(t,r){var n=E();return e.createElement(ce,{onClick:function(){return n()},ref:r},e.createElement(ue,null),"   Se déconnecter")})),Qe=function(t){var r=t.name,n=t.list,o=t.create,a=je(t,["name","list","create"]),i=y(r).permissions;return e.createElement(O,be({},a,{name:r,list:i&&i.some((function(e){return Se.includes(e["acl:mode"])}))?n:void 0,create:i&&i.some((function(e){return Ie.includes(e["acl:mode"])}))?o:void 0}))},Xe=D((function(){return{list:{padding:0,width:"100%"},option:{padding:0}}})),Ye=function(t){var r=t.addPermission,n=Xe(),a=_e(e.useState(null),2),i=a[0],c=a[1],u=_e(e.useState(""),2),l=u[0],f=u[1],p=_e(e.useState([]),2),m=p[0],d=p[1],h=P("Person",{page:1,perPage:100},{field:"pair:label",order:"ASC"},{q:l},{enabled:l.length>0}),v=h.ids,b=h.data;return o((function(){d(v.length>0?Object.values(b):[])}),[v,b]),e.createElement(se,{classes:{option:n.option},getOptionLabel:function(e){return e["pair:label"]},filterOptions:function(e){return e},options:m,noOptionsText:"Aucun résultat",autoComplete:!0,blurOnSelect:!0,clearOnBlur:!0,disableClearable:!0,value:i,onChange:function(e,t){r(t.id||t["@id"],"user","acl:Read"),c(null),f(""),d([])},onInputChange:function(e,t){f(t)},renderInput:function(t){return e.createElement(B,be({},t,{label:"Ajouter un utilisateur ou un groupe...",variant:"filled",margin:"dense",fullWidth:!0}))},renderOption:function(t){return e.createElement(V,{dense:!0,className:n.list},e.createElement(G,{button:!0},e.createElement(J,null,e.createElement(W,{src:t.image},e.createElement(s,null))),e.createElement(q,{primary:t["pair:label"]})))}})},Ze=D((function(){return{listItem:{paddingLeft:4,paddingRight:36},secondaryText:{textAlign:"center",width:"50%",fontStyle:"italic",color:"grey"}}})),et=function(t){var r=t.agent,n=t.addPermission,i=t.removePermission,c=Ze(),u=k(),l=_e(e.useState(null),2),s=l[0],f=l[1],p=_e(a(),2),m=p[0],d=p[1],h=_e(a(!0),2),v=h[0],b=h[1],y=_e(a(),2),g=y[0],j=y[1];if(o((function(){"user"===r.type?u.getOne("Person",{id:r.id}).then((function(e){var t=e.data;d(t),b(!1)})).catch((function(e){j(e),b(!1)})):b(!1)}),[r.id,r.type]),"group"===r.type)return null;var _=function(){return f(null)};return v?e.createElement(A,null):g?e.createElement(C,null):e.createElement(G,{button:!0,className:c.listItem},e.createElement(J,null,e.createElement(W,{src:null==m?void 0:m.image},r.icon)),e.createElement(q,{primary:r.label||(null==m?void 0:m["pair:label"])}),e.createElement(q,{className:c.secondaryText,primary:r.permissions&&r.permissions.map((function(e){return Ne[e]})).join(", ")}),e.createElement(H,null,e.createElement(K,{onClick:function(e){return f(e.currentTarget)}},e.createElement(fe,null)),e.createElement(Q,{anchorEl:s,keepMounted:!0,open:Boolean(s),onClose:_},Object.entries(Ne).map((function(t){var o=_e(t,2),a=o[0],c=o[1],u=r.permissions&&r.permissions.includes(a);return e.createElement(X,{onClick:function(){u?i(r.id,r.type,a):n(r.id,r.type,a),_()}},e.createElement(Y,null,u?e.createElement(pe,null):null),e.createElement(q,{primary:c}))})))))},tt=D((function(e){return{list:{width:"100%",maxWidth:"100%",backgroundColor:e.palette.background.paper}}})),rt=function(t){var r=t.agents,n=t.addPermission,o=t.removePermission,a=tt();return e.createElement(V,{dense:!0,className:a.list},Object.entries(r).map((function(t){var r=_e(t,2),a=r[0],i=r[1];return e.createElement(et,{key:a,agent:i,addPermission:n,removePermission:o})})))};var nt=function(){this.__data__=[],this.size=0};var ot=function(e,t){return e===t||e!=e&&t!=t};var at=function(e,t){for(var r=e.length;r--;)if(ot(e[r][0],t))return r;return-1},it=Array.prototype.splice;var ct=function(e){var t=this.__data__,r=at(t,e);return!(r<0)&&(r==t.length-1?t.pop():it.call(t,r,1),--this.size,!0)};var ut=function(e){var t=this.__data__,r=at(t,e);return r<0?void 0:t[r][1]};var lt=function(e){return at(this.__data__,e)>-1};var st=function(e,t){var r=this.__data__,n=at(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ft(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ft.prototype.clear=nt,ft.prototype.delete=ct,ft.prototype.get=ut,ft.prototype.has=lt,ft.prototype.set=st;var pt=ft;var mt=function(){this.__data__=new pt,this.size=0};var dt=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var ht=function(e){return this.__data__.get(e)};var vt=function(e){return this.__data__.has(e)},bt="object"==typeof Le&&Le&&Le.Object===Object&&Le,yt="object"==typeof self&&self&&self.Object===Object&&self,gt=bt||yt||Function("return this")(),jt=gt.Symbol,_t=Object.prototype,wt=_t.hasOwnProperty,Et=_t.toString,Ot=jt?jt.toStringTag:void 0;var Pt=function(e){var t=wt.call(e,Ot),r=e[Ot];try{e[Ot]=void 0;var n=!0}catch(e){}var o=Et.call(e);return n&&(t?e[Ot]=r:delete e[Ot]),o},kt=Object.prototype.toString;var At=function(e){return kt.call(e)},Ct=jt?jt.toStringTag:void 0;var St=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ct&&Ct in Object(e)?Pt(e):At(e)};var It=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var xt,Ut=function(e){if(!It(e))return!1;var t=St(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Tt=gt["__core-js_shared__"],Nt=(xt=/[^.]+$/.exec(Tt&&Tt.keys&&Tt.keys.IE_PROTO||""))?"Symbol(src)_1."+xt:"";var zt=function(e){return!!Nt&&Nt in e},Rt=Function.prototype.toString;var Lt=function(e){if(null!=e){try{return Rt.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Dt=/^\[object .+?Constructor\]$/,Mt=Function.prototype,Wt=Object.prototype,Ft=Mt.toString,$t=Wt.hasOwnProperty,Bt=RegExp("^"+Ft.call($t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Vt=function(e){return!(!It(e)||zt(e))&&(Ut(e)?Bt:Dt).test(Lt(e))};var Gt=function(e,t){return null==e?void 0:e[t]};var Jt=function(e,t){var r=Gt(e,t);return Vt(r)?r:void 0},qt=Jt(gt,"Map"),Ht=Jt(Object,"create");var Kt=function(){this.__data__=Ht?Ht(null):{},this.size=0};var Qt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Xt=Object.prototype.hasOwnProperty;var Yt=function(e){var t=this.__data__;if(Ht){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Xt.call(t,e)?t[e]:void 0},Zt=Object.prototype.hasOwnProperty;var er=function(e){var t=this.__data__;return Ht?void 0!==t[e]:Zt.call(t,e)};var tr=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Ht&&void 0===t?"__lodash_hash_undefined__":t,this};function rr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}rr.prototype.clear=Kt,rr.prototype.delete=Qt,rr.prototype.get=Yt,rr.prototype.has=er,rr.prototype.set=tr;var nr=rr;var or=function(){this.size=0,this.__data__={hash:new nr,map:new(qt||pt),string:new nr}};var ar=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var ir=function(e,t){var r=e.__data__;return ar(t)?r["string"==typeof t?"string":"hash"]:r.map};var cr=function(e){var t=ir(this,e).delete(e);return this.size-=t?1:0,t};var ur=function(e){return ir(this,e).get(e)};var lr=function(e){return ir(this,e).has(e)};var sr=function(e,t){var r=ir(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function fr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}fr.prototype.clear=or,fr.prototype.delete=cr,fr.prototype.get=ur,fr.prototype.has=lr,fr.prototype.set=sr;var pr=fr;var mr=function(e,t){var r=this.__data__;if(r instanceof pt){var n=r.__data__;if(!qt||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new pr(n)}return r.set(e,t),this.size=r.size,this};function dr(e){var t=this.__data__=new pt(e);this.size=t.size}dr.prototype.clear=mt,dr.prototype.delete=dt,dr.prototype.get=ht,dr.prototype.has=vt,dr.prototype.set=mr;var hr=dr;var vr=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var br=function(e){return this.__data__.has(e)};function yr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new pr;++t<r;)this.add(e[t])}yr.prototype.add=yr.prototype.push=vr,yr.prototype.has=br;var gr=yr;var jr=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var _r=function(e,t){return e.has(t)};var wr=function(e,t,r,n,o,a){var i=1&r,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var s=-1,f=!0,p=2&r?new gr:void 0;for(a.set(e,t),a.set(t,e);++s<c;){var m=e[s],d=t[s];if(n)var h=i?n(d,m,s,t,e,a):n(m,d,s,e,t,a);if(void 0!==h){if(h)continue;f=!1;break}if(p){if(!jr(t,(function(e,t){if(!_r(p,t)&&(m===e||o(m,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(m!==d&&!o(m,d,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f},Er=gt.Uint8Array;var Or=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var Pr=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},kr=jt?jt.prototype:void 0,Ar=kr?kr.valueOf:void 0;var Cr=function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Er(e),new Er(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ot(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=Or;case"[object Set]":var u=1&n;if(c||(c=Pr),e.size!=t.size&&!u)return!1;var l=i.get(e);if(l)return l==t;n|=2,i.set(e,t);var s=wr(c(e),c(t),n,o,a,i);return i.delete(e),s;case"[object Symbol]":if(Ar)return Ar.call(e)==Ar.call(t)}return!1};var Sr=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Ir=Array.isArray;var xr=function(e,t,r){var n=t(e);return Ir(e)?n:Sr(n,r(e))};var Ur=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var Tr=function(){return[]},Nr=Object.prototype.propertyIsEnumerable,zr=Object.getOwnPropertySymbols,Rr=zr?function(e){return null==e?[]:(e=Object(e),Ur(zr(e),(function(t){return Nr.call(e,t)})))}:Tr;var Lr=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Dr=function(e){return null!=e&&"object"==typeof e};var Mr=function(e){return Dr(e)&&"[object Arguments]"==St(e)},Wr=Object.prototype,Fr=Wr.hasOwnProperty,$r=Wr.propertyIsEnumerable,Br=Mr(function(){return arguments}())?Mr:function(e){return Dr(e)&&Fr.call(e,"callee")&&!$r.call(e,"callee")};var Vr=function(){return!1},Gr=De((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?gt.Buffer:void 0,a=(o?o.isBuffer:void 0)||Vr;e.exports=a})),Jr=/^(?:0|[1-9]\d*)$/;var qr=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Jr.test(e))&&e>-1&&e%1==0&&e<t};var Hr=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Kr={};Kr["[object Float32Array]"]=Kr["[object Float64Array]"]=Kr["[object Int8Array]"]=Kr["[object Int16Array]"]=Kr["[object Int32Array]"]=Kr["[object Uint8Array]"]=Kr["[object Uint8ClampedArray]"]=Kr["[object Uint16Array]"]=Kr["[object Uint32Array]"]=!0,Kr["[object Arguments]"]=Kr["[object Array]"]=Kr["[object ArrayBuffer]"]=Kr["[object Boolean]"]=Kr["[object DataView]"]=Kr["[object Date]"]=Kr["[object Error]"]=Kr["[object Function]"]=Kr["[object Map]"]=Kr["[object Number]"]=Kr["[object Object]"]=Kr["[object RegExp]"]=Kr["[object Set]"]=Kr["[object String]"]=Kr["[object WeakMap]"]=!1;var Qr=function(e){return Dr(e)&&Hr(e.length)&&!!Kr[St(e)]};var Xr=function(e){return function(t){return e(t)}},Yr=De((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&bt.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),Zr=Yr&&Yr.isTypedArray,en=Zr?Xr(Zr):Qr,tn=Object.prototype.hasOwnProperty;var rn=function(e,t){var r=Ir(e),n=!r&&Br(e),o=!r&&!n&&Gr(e),a=!r&&!n&&!o&&en(e),i=r||n||o||a,c=i?Lr(e.length,String):[],u=c.length;for(var l in e)!t&&!tn.call(e,l)||i&&("length"==l||o&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||qr(l,u))||c.push(l);return c},nn=Object.prototype;var on=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||nn)};var an=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),cn=Object.prototype.hasOwnProperty;var un=function(e){if(!on(e))return an(e);var t=[];for(var r in Object(e))cn.call(e,r)&&"constructor"!=r&&t.push(r);return t};var ln=function(e){return null!=e&&Hr(e.length)&&!Ut(e)};var sn=function(e){return ln(e)?rn(e):un(e)};var fn=function(e){return xr(e,sn,Rr)},pn=Object.prototype.hasOwnProperty;var mn=function(e,t,r,n,o,a){var i=1&r,c=fn(e),u=c.length;if(u!=fn(t).length&&!i)return!1;for(var l=u;l--;){var s=c[l];if(!(i?s in t:pn.call(t,s)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var m=i;++l<u;){var d=e[s=c[l]],h=t[s];if(n)var v=i?n(h,d,s,t,e,a):n(d,h,s,e,t,a);if(!(void 0===v?d===h||o(d,h,r,n,a):v)){p=!1;break}m||(m="constructor"==s)}if(p&&!m){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(p=!1)}return a.delete(e),a.delete(t),p},dn=Jt(gt,"DataView"),hn=Jt(gt,"Promise"),vn=Jt(gt,"Set"),bn=Jt(gt,"WeakMap"),yn=Lt(dn),gn=Lt(qt),jn=Lt(hn),_n=Lt(vn),wn=Lt(bn),En=St;(dn&&"[object DataView]"!=En(new dn(new ArrayBuffer(1)))||qt&&"[object Map]"!=En(new qt)||hn&&"[object Promise]"!=En(hn.resolve())||vn&&"[object Set]"!=En(new vn)||bn&&"[object WeakMap]"!=En(new bn))&&(En=function(e){var t=St(e),r="[object Object]"==t?e.constructor:void 0,n=r?Lt(r):"";if(n)switch(n){case yn:return"[object DataView]";case gn:return"[object Map]";case jn:return"[object Promise]";case _n:return"[object Set]";case wn:return"[object WeakMap]"}return t});var On=En,Pn=Object.prototype.hasOwnProperty;var kn=function(e,t,r,n,o,a){var i=Ir(e),c=Ir(t),u=i?"[object Array]":On(e),l=c?"[object Array]":On(t),s="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),f="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l),p=u==l;if(p&&Gr(e)){if(!Gr(t))return!1;i=!0,s=!1}if(p&&!s)return a||(a=new hr),i||en(e)?wr(e,t,r,n,o,a):Cr(e,t,u,r,n,o,a);if(!(1&r)){var m=s&&Pn.call(e,"__wrapped__"),d=f&&Pn.call(t,"__wrapped__");if(m||d){var h=m?e.value():e,v=d?t.value():t;return a||(a=new hr),o(h,v,r,n,a)}}return!!p&&(a||(a=new hr),mn(e,t,r,n,o,a))};var An=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Dr(t)&&!Dr(r)?t!=t&&r!=r:kn(t,r,n,o,e,a))};var Cn=function(e,t){return An(e,t)},Sn={},In={"{}":void 0},xn=D((function(){return{title:{paddingBottom:8},actions:{padding:15},addForm:{paddingTop:0},listForm:{paddingTop:0,paddingBottom:0,paddingRight:0,maxHeight:210}}})),Un=function(e,t){return Array.isArray(e["acl:agentClass"])?e["acl:agentClass"].includes(t):e["acl:agentClass"]===t},Tn=function(e,t,r,n){e[t]?e[t].permissions.push(n):e[t]=ge(ge({id:t,type:r},Re[r]),{},{permissions:[n]})},Nn=function(t){var r=t.open,n=t.onClose,a=t.resourceId,u=xn(),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sn,t=JSON.stringify(e),r=S({permissions:In[t]}),n=_e(r,2),a=n[0],c=n[1],u=I(),l=i((function(){return u(e).then((function(e){Cn(e,a.permissions)||(In[t]=e,c({permissions:e}))})).catch((function(e){c({error:e})}))}),[t,e,u]);return o((function(){l()}),[t]),ge(ge({},a),{},{refetch:l})}(a),s=l.permissions,f=l.refetch,p=x(),m=c((function(){var e={};if(s){var t,r=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=we(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(s);try{var n=function(){var r=t.value;Un(r,"foaf:Agent")&&Tn(e,"foaf:Agent","anon",r["acl:mode"]),Un(r,"acl:AuthenticatedAgent")&&Tn(e,"acl:AuthenticatedAgent","anyUser",r["acl:mode"]),r["acl:agent"]&&We(r["acl:agent"]).forEach((function(t){return Tn(e,t,"user",r["acl:mode"])})),r["acl:agentGroup"]&&We(r["acl:agentGroup"]).forEach((function(t){return Tn(e,t,"group",r["acl:mode"])}))};for(r.s();!(t=r.n()).done;)n()}catch(e){r.e(e)}finally{r.f()}}return e}),[s]),d=i((function(e,t,r){p.addPermission(a,e,t,r).then((function(){return f()}))}),[a,p,f]),h=i((function(e,t,r){p.removePermission(a,e,t,r).then((function(){return f()}))}),[a,p,f]);return e.createElement(Z,{fullWidth:!0,open:r,onClose:n},e.createElement(ee,{className:u.title},"Permissions sur la ressource"),e.createElement(te,{className:u.addForm},e.createElement(Ye,{addPermission:d})),e.createElement(te,{className:u.listForm},e.createElement(rt,{agents:m,addPermission:d,removePermission:h})),e.createElement(re,{className:u.actions},e.createElement(U,{label:"ra.action.close",variant:"inlined",onClick:n})))},zn=function(t){var r=t.record,n=_e(a(!1),2),o=n[0],i=n[1];return r?e.createElement(e.Fragment,null,e.createElement(U,{label:"Permissions",onClick:function(){return i(!0)}},e.createElement(le,null)),e.createElement(Nn,{resourceId:r.id||r["@id"],open:o,onClose:function(){return i(!1)}})):null},Rn=function(t){var r=t.basePath,n=t.className,o=t.data,a=t.hasList,i=t.hasEdit,c=t.hasControl,u=je(t,["basePath","className","data","hasList","hasEdit","hasControl"]);return e.createElement(p,be({className:n},u),a&&e.createElement(m,{basePath:r,record:o}),i&&e.createElement(T,{basePath:r,record:o}),c&&e.createElement(zn,{basePath:r,record:o}))},Ln=function(t){var r=y(t.id).permissions;return e.createElement(N,be({actions:e.createElement(Rn,{hasControl:r&&r.some((function(e){return Te.includes(e["acl:mode"])}))})},t,{permissions:r,hasEdit:r&&r.some((function(e){return xe.includes(e["acl:mode"])}))}))},Dn=n((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(z,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/show"),primaryText:"Voir mon profil",leftIcon:e.createElement(me,null),onClick:n})})),Mn=n((function(t,r){var n=t.onClick,o=t.webId;return e.createElement(z,{ref:r,to:"/Person/".concat(encodeURIComponent(o),"/edit"),primaryText:"Editer mon profil",leftIcon:e.createElement(fe,null),onClick:n})})),Wn=n((function(t,r){var n=t.onClick;return e.createElement(z,{ref:r,to:"/login",primaryText:"Se connecter",onClick:n})})),Fn=function(t){var r=t.logout,n=je(t,["logout"]),o=R().identity;return e.createElement(L,n,o&&""!==o.id?[e.createElement(Dn,{webId:o.id,key:"view"}),e.createElement(Mn,{webId:o.id,key:"edit"}),e.cloneElement(r,{key:"logout"})]:e.createElement(Wn,null))};export{Be as EditActions,Je as EditWithPermissions,He as LoginPage,Ke as LogoutButton,Qe as ResourceWithPermissions,Rn as ShowActions,Ln as ShowWithPermissions,Fn as UserMenu,$e as authProvider};
